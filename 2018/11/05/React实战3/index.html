<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>React实战3 | afei_ask</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一、路由1.1 路由和路由规则React中路由表示根据url的不同显示不同的内容 在安装react中安装路由 1npm install react-router-dom 进入APP.js，看到大的组件中只显示header，我们希望访问首页时不仅显示header，而且还显示首页。访问详情页时把详情页给显示出来。 首先从react-router-dom中引入BrowserHistory、Router。">
<meta name="keywords" content="React">
<meta property="og:type" content="article">
<meta property="og:title" content="React实战3">
<meta property="og:url" content="http://yoursite.com/2018/11/05/React实战3/index.html">
<meta property="og:site_name" content="afei_ask">
<meta property="og:description" content="一、路由1.1 路由和路由规则React中路由表示根据url的不同显示不同的内容 在安装react中安装路由 1npm install react-router-dom 进入APP.js，看到大的组件中只显示header，我们希望访问首页时不仅显示header，而且还显示首页。访问详情页时把详情页给显示出来。 首先从react-router-dom中引入BrowserHistory、Router。">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-12-24T13:40:49.455Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="React实战3">
<meta name="twitter:description" content="一、路由1.1 路由和路由规则React中路由表示根据url的不同显示不同的内容 在安装react中安装路由 1npm install react-router-dom 进入APP.js，看到大的组件中只显示header，我们希望访问首页时不仅显示header，而且还显示首页。访问详情页时把详情页给显示出来。 首先从react-router-dom中引入BrowserHistory、Router。">
  
    <link rel="alternate" href="/atom.xml" title="afei_ask" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">afei_ask</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-React实战3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/05/React实战3/" class="article-date">
  <time datetime="2018-11-05T14:36:42.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      React实战3
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、路由"><a href="#一、路由" class="headerlink" title="一、路由"></a>一、路由</h2><h4 id="1-1-路由和路由规则"><a href="#1-1-路由和路由规则" class="headerlink" title="1.1 路由和路由规则"></a>1.1 路由和路由规则</h4><p>React中路由表示根据url的不同显示不同的内容</p>
<p>在安装react中安装路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-router-dom</span><br></pre></td></tr></table></figure>
<p>进入APP.js，看到大的组件中只显示header，我们希望访问首页时不仅显示header，而且还显示首页。访问详情页时把详情页给显示出来。</p>
<p>首先从react-router-dom中引入BrowserHistory、Router。注意Proveder中只能有一个元素，所以它里面的内容需要用一个div包起来，对BrowserRouter也是只能包含一个要素。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Route &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'./common/header/index.js'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store/index.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    	&lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    		&lt;div&gt;</span><br><span class="line">	      		&lt;Header /&gt;</span><br><span class="line">	      		&lt;BrowserRouter&gt;</span><br><span class="line">	      			&lt;div&gt;</span><br><span class="line">		      			&lt;Route path=<span class="string">'/'</span> render=&#123;()=&gt;<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>home<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">		      			&lt;Route path=<span class="string">'/detail'</span> render=&#123;()=&gt;<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>detail<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">	      			&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">	      		&lt;/</span>BrowserRouter&gt;</span><br><span class="line">      		&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      	&lt;/</span>Provider&gt;</span><br><span class="line"></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>这时当我们访问<a href="http://localhost:3000和http://localhost:3000/detail时回出现home和homedetail。这时因为当访问http://localhost:3000时/也能匹配上/detail。如果我们访问http://localhost:3000/detail只想看到detail不想看到home怎么办？很简单，只需要加一个exact就可以了。" target="_blank" rel="noopener">http://localhost:3000和http://localhost:3000/detail时回出现home和homedetail。这时因为当访问http://localhost:3000时/也能匹配上/detail。如果我们访问http://localhost:3000/detail只想看到detail不想看到home怎么办？很简单，只需要加一个exact就可以了。</a></p>
<p>表示只有路径和指定的路径完完全全相等的时候才显示后面的内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">'/'</span> exact render=&#123;()=&gt;<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>home<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">&lt;Route path=<span class="string">'/detail'</span> exact render=&#123;()=&gt;<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>detail<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="1-2-拆分首页"><a href="#1-2-拆分首页" class="headerlink" title="1.2 拆分首页"></a>1.2 拆分首页</h4><p>首先在src目录下创建一个pages的文件夹，表示有多少个页面，然后在pages里面创建两个文件夹分别叫做home和detail。</p>
<p>在home文件夹下创建一个index.js的文件，这时react组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;Home&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">		);</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">export default Home;</span></span><br></pre></td></tr></table></figure>
<p>同理在detail文件夹下也创建一个index.js的文件。</p>
<p>然后在App.js文件中引入这两个文件，并在Route标签中引入这两个组件。在标签中引入组件使用compinent</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./pages/home'</span>;</span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">'./pages/detail'</span>;</span><br><span class="line">...</span><br><span class="line">&lt;Route path=<span class="string">'/'</span> exact component=&#123;Home&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">&lt;Route path=<span class="string">'/detail'</span> exact component=&#123;Detail&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>然后在home目录下创建一个style.js的文件，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HomeWrapper=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	width:960px;</span></span><br><span class="line"><span class="string">	margin:0, auto;</span></span><br><span class="line"><span class="string">	height:300px;</span></span><br><span class="line"><span class="string">	background:red;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>在<code>home/index.js</code>中引入HomeWrapper组件即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> &#123; HomeWrapper &#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;HomeWrapper&gt;<span class="xml"><span class="tag">&lt;/<span class="name">HomeWrapper</span>&gt;</span></span></span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在style.js中创建HomeLeft和HomeRight，并在home/index.js中引用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HomeWrapper=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	overflow:hidden;</span></span><br><span class="line"><span class="string">	width:960px;</span></span><br><span class="line"><span class="string">	margin:0, auto;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HomeLeft=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float:left;</span></span><br><span class="line"><span class="string">	margin-left:15px;</span></span><br><span class="line"><span class="string">	padding-top:30px;</span></span><br><span class="line"><span class="string">	width:625px;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HomeRight=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	width:240px;</span></span><br><span class="line"><span class="string">	float:right;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HomeWrapper , HomeLeft, HomeRight&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;HomeWrapper&gt;</span><br><span class="line">				&lt;HomeLeft&gt;left&lt;<span class="regexp">/HomeLeft&gt;</span></span><br><span class="line"><span class="regexp">				&lt;HomeRight&gt;right&lt;/</span>HomeRight&gt;</span><br><span class="line">			&lt;<span class="regexp">/HomeWrapper&gt;</span></span><br><span class="line"><span class="regexp">		);</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Home;</span></span><br></pre></td></tr></table></figure>
<p>如何在left中引入banner图呢？可以在HomeLeft中引入img标签并且在<code>home/style.js</code>文件中添加样式，这样图片就正常显示了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;HomeLeft&gt;</span><br><span class="line">	&lt;img className=<span class="string">'banner-img'</span> src=<span class="string">"//upload.jianshu.io/admin_banners/web_images/4516/cd9298634ca88ca71fc12752acf47917967a5d31.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/1250/h/540"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/HomeLeft&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HomeLeft=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float:left;</span></span><br><span class="line"><span class="string">	margin-left:15px;</span></span><br><span class="line"><span class="string">	padding-top:30px;</span></span><br><span class="line"><span class="string">	width:625px;</span></span><br><span class="line"><span class="string">	.banner-img &#123;</span></span><br><span class="line"><span class="string">		width:625px;</span></span><br><span class="line"><span class="string">		height:270px;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-划分首页组件"><a href="#1-3-划分首页组件" class="headerlink" title="1.3 划分首页组件"></a>1.3 划分首页组件</h4><p>可以把首页内容划分成几个组件</p>
<p>在home文件夹下创建一个名为components的文件夹，在里面创建Recommend.js、List.js、Writer.js、Topic.js的文件。</p>
<h6 id="1-3-1-Topic的编程"><a href="#1-3-1-Topic的编程" class="headerlink" title="1.3.1 Topic的编程"></a>1.3.1 Topic的编程</h6><p>由于我们首页的几个组件过于简单，如果给每一个小组件都设计一个style就显得过于设计。所以统一给它们上一层目录的style</p>
<p>进入到Topic.js文件，使用TopicWrapper标签，并且在<code>home/style.js</code>文件中创建该样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TopicWrapper , TopicItem&#125; <span class="keyword">from</span> <span class="string">'../style'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Topic</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;TopicWrapper&gt;</span><br><span class="line">				&lt;TopicItem&gt;</span><br><span class="line">					&lt;img className=<span class="string">'topic-pic'</span> src=<span class="string">"//upload.jianshu.io/collections/images/283250/%E6%BC%AB%E7%94%BB%E4%B8%93%E9%A2%98.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"</span> /&gt;</span><br><span class="line">					手绘手绘</span><br><span class="line">				&lt;<span class="regexp">/TopicItem&gt;</span></span><br><span class="line"><span class="regexp">			&lt;/</span>TopicWrapper&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Topic;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> TopicWrapper=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	overflow:hidden;</span></span><br><span class="line"><span class="string">	padding: 20px 0 10px 0;</span></span><br><span class="line"><span class="string">	margin-left:-18px;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> TopicItem=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float:left;</span></span><br><span class="line"><span class="string">	height:32px;</span></span><br><span class="line"><span class="string">	line-height:32px;</span></span><br><span class="line"><span class="string">	padding-right:10px;</span></span><br><span class="line"><span class="string">	margin-bottom:18px;</span></span><br><span class="line"><span class="string">	margin-left:18px;</span></span><br><span class="line"><span class="string">	background:#f7f7f7;</span></span><br><span class="line"><span class="string">	font-size:14px;</span></span><br><span class="line"><span class="string">	color:#000;</span></span><br><span class="line"><span class="string">	border:1px solid #dcdcdc;</span></span><br><span class="line"><span class="string">	border-radius:4px;</span></span><br><span class="line"><span class="string">	.topic-pic &#123;</span></span><br><span class="line"><span class="string">		display:block;</span></span><br><span class="line"><span class="string">		margin-right:10px;</span></span><br><span class="line"><span class="string">		float:left;</span></span><br><span class="line"><span class="string">		width:32px;</span></span><br><span class="line"><span class="string">		height:32px;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-2-创建reducer"><a href="#1-3-2-创建reducer" class="headerlink" title="1.3.2 创建reducer"></a>1.3.2 创建reducer</h6><p>在<code>src/store/reducer</code>中大的reducer将若干个小的reducer组合一起。所以home页面应该由自己的reducer管理自己的数据。</p>
<p>在home目录下创建一个store的文件夹，并且在里面创建reducer.js文件，参照header下的reducer</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们的topicItem肯定是一个数组来管理的，所以reducer中就需要定义一个数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	topicList:[</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">title</span>:<span class="string">'手绘'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/283250/%E6%BC%AB%E7%94%BB%E4%B8%93%E9%A2%98.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">title</span>:<span class="string">'读书'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/4/sy_20091020135145113016.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">3</span>,<span class="attr">title</span>:<span class="string">'自然科普'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/76/12.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">4</span>,<span class="attr">title</span>:<span class="string">'故事'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/95/1.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">5</span>,<span class="attr">title</span>:<span class="string">'简书电影'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/21/20120316041115481.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">6</span>,<span class="attr">title</span>:<span class="string">'摄影'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/83/1.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">7</span>,<span class="attr">title</span>:<span class="string">'旅行 在路上'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/13/%E5%95%8A.png?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		</span><br><span class="line">	]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并且在<code>src/store/reducer</code>中引入该ruducer,同理我们不想让外部直接饮用该reducer，需要在pages/home/store下创建index.js，来引入和导出该reducer</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;combineReducers&#125; <span class="keyword">from</span> <span class="string">'redux-immutable'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reducer <span class="keyword">as</span> headerReducer &#125; <span class="keyword">from</span> <span class="string">'../common/header/store'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reducer <span class="keyword">as</span> homeReducer &#125; <span class="keyword">from</span> <span class="string">'../pages/home/store'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">	header:headerReducer,</span><br><span class="line">	home:homeReducer</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pages/home/store下创建index.js</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; reducer &#125;;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-3-连接Topic和reducer"><a href="#1-3-3-连接Topic和reducer" class="headerlink" title="1.3.3 连接Topic和reducer"></a>1.3.3 连接Topic和reducer</h6><p>这时候就需要让Topic和store做连接了，怎么连接?在Topic.js中引入react-redux的connect即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TopicWrapper , TopicItem&#125; <span class="keyword">from</span> <span class="string">'../style'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Topic</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;TopicWrapper&gt;</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">this</span>.props.list.map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">						<span class="keyword">return</span> (</span><br><span class="line">							&lt;TopicItem key=&#123;item.get(<span class="string">'id'</span>)&#125;&gt;</span><br><span class="line">								&lt;img </span><br><span class="line">									className=<span class="string">'topic-pic'</span></span><br><span class="line">									src=&#123;item.get(<span class="string">'imgUrl'</span>)&#125; /&gt;</span><br><span class="line">									&#123;item.get(<span class="string">'title'</span>)&#125;</span><br><span class="line">							&lt;<span class="regexp">/TopicItem&gt;</span></span><br><span class="line"><span class="regexp">						);</span></span><br><span class="line"><span class="regexp">					&#125;)</span></span><br><span class="line"><span class="regexp">				&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">			&lt;/</span>TopicWrapper&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		list:state.get(<span class="string">'home'</span>).get(<span class="string">'topicList'</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,<span class="literal">null</span>)(Topic);</span><br></pre></td></tr></table></figure>
<h6 id="1-3-4-文章列表"><a href="#1-3-4-文章列表" class="headerlink" title="1.3.4 文章列表"></a>1.3.4 文章列表</h6><p>和Topic没什么区别，只是再走一遍流程，不再重复</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ListItem , ListInfo&#125; <span class="keyword">from</span> <span class="string">'../style'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">List</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">this</span>.props.list.map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">						<span class="keyword">return</span> (</span><br><span class="line">							&lt;ListItem key=&#123;item.get(<span class="string">'id'</span>)&#125;&gt;</span><br><span class="line">								&lt;img className=<span class="string">'list-pic'</span> src=&#123;item.get(<span class="string">'imgUrl'</span>)&#125; /&gt;</span><br><span class="line">								&lt;ListInfo&gt;</span><br><span class="line">									&lt;h3 className=<span class="string">'title'</span>&gt;&#123;item.get(<span class="string">'title'</span>)&#125;&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">									&lt;p className='desc'&gt;&#123;item.get('desc')&#125;&lt;/</span>p&gt;</span><br><span class="line">								&lt;<span class="regexp">/ListInfo&gt;</span></span><br><span class="line"><span class="regexp">							&lt;/</span>ListItem&gt;</span><br><span class="line">						)</span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;</span><br><span class="line">			&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">		);</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps=(state)=&gt;&#123;</span></span><br><span class="line"><span class="regexp">	return &#123;</span></span><br><span class="line"><span class="regexp">		list:state.get('home').get('articleList')</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps,null)(List);</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	...</span><br><span class="line">	articleList:[</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">title</span>:<span class="string">'全城百姓举牌欢迎，不料被将军看到牌后一字，悄悄对手下说：屠城'</span>,<span class="attr">desc</span>:<span class="string">'文/历史大农 简短一句话，剖析一段史。让“历史大农”用简洁的语言，为您讲述一段历史辛密。 军事家、战略家——“明太祖”朱元璋 明太祖朱元璋，作为...'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload-images.jianshu.io/upload_images/11919269-0a22c403002a1371?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">title</span>:<span class="string">'每天最重要的2小时：让自己成为高效的人'</span>,<span class="attr">desc</span>:<span class="string">'工作、加班、学习、运动、陪伴家人，当然还有娱乐，我们每天都被时间的脚步追赶着，每一刻都是忙碌的，而忙碌永远没有劲头。 当下，时间俨然已经成为最宝...'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload-images.jianshu.io/upload_images/10746568-26f4733a3ad87c62.png?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">3</span>,<span class="attr">title</span>:<span class="string">'是可忍，孰不可忍！｜140字微小说'</span>,<span class="attr">desc</span>:<span class="string">'多少个夜晚 你真心相伴 不离不弃 多少个夜晚 你亲昵纠缠 不眠不休 你已经在我心底留下了深深的印迹 我想你 魂牵梦萦 如今 我终于将你捧在了手心...'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload-images.jianshu.io/upload_images/12309992-4e21d79f92914f76.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">4</span>,<span class="attr">title</span>:<span class="string">'还在纠结秋冬穿什么？8套秋冬搭配轻松搞定'</span>,<span class="attr">desc</span>:<span class="string">'第一套： 杏色的针织荷叶边的垂感中长裙搭配同色系的折线宽松毛衣，视觉上看着很舒服，比较优雅的颜色搭配，适合皮肤中性偏白的女生，很显气质，同时竖条...'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload-images.jianshu.io/upload_images/12861608-90ae71664fbb9d99?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240'</span>&#125;,</span><br><span class="line"></span><br><span class="line">	]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>可是这时候控制台会报一些警告，这时由于使用img标签都要填一个alt属性，只需要给img添加一个alt标签即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alt=<span class="string">''</span></span><br></pre></td></tr></table></figure>
<h6 id="1-3-5-组件向样式传递属性"><a href="#1-3-5-组件向样式传递属性" class="headerlink" title="1.3.5 组件向样式传递属性"></a>1.3.5 组件向样式传递属性</h6><p>有时候我们希望在组件中定义一个属性，然后在style中使用，怎么办呢？</p>
<p>我们可以在组件RecommendItem中定义一个imgUrl的属性，然后在style中通过props来传递</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Recommend.js</span></span><br><span class="line">&lt;RecommendItem imgUrl=<span class="string">"http://cdn2.jianshu.io/assets/web/banner-s-3-7123fd94750759acf7eca05b871e9d17.png"</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/RecommendItem&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//style.js</span></span><br><span class="line"><span class="comment">//这时原始的</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RecommendItem=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	width:280px;</span></span><br><span class="line"><span class="string">	height:50px;</span></span><br><span class="line"><span class="string">	margin-bottom:6px;</span></span><br><span class="line"><span class="string">	background:url(http://cdn2.jianshu.io/assets/web/banner-s-3-7123fd94750759acf7eca05b871e9d17.png);</span></span><br><span class="line"><span class="string">	background-size:contain;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这时最新的</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RecommendItem=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	width:280px;</span></span><br><span class="line"><span class="string">	height:50px;</span></span><br><span class="line"><span class="string">	margin-bottom:6px;</span></span><br><span class="line"><span class="string">	background:url(<span class="subst">$&#123;(props)=&gt;props.imgUrl&#125;</span>);</span></span><br><span class="line"><span class="string">	background-size:contain;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-6-通过ajax获取数据"><a href="#1-3-6-通过ajax获取数据" class="headerlink" title="1.3.6 通过ajax获取数据"></a>1.3.6 通过ajax获取数据</h6><p>实际上我们hone页面的数据是从后台获取的，所以不能自reducer中把数据写死。</p>
<p>首先我们在<code>public/api/</code>下建立一个home.json文件，并写入home的数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="string">"data"</span>: &#123;</span><br><span class="line">		<span class="string">"topicList"</span>: [&#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">1</span>,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"社会热点"</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"//upload.jianshu.io/collections/images/261938/man-hands-reading-boy-large.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">2</span>,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"手手绘"</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"//upload.jianshu.io/collections/images/21/20120316041115481.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"</span></span><br><span class="line">		&#125;],</span><br><span class="line">		<span class="string">"articleList"</span>: [&#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">1</span>,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"胡歌12年后首谈车祸"</span>,</span><br><span class="line">			<span class="string">"desc"</span>: <span class="string">"文/麦大人 01 胡歌又刷屏了。 近日他上了《朗读者》，而这一期的主题是“生命”，他用磁性的嗓音，朗读了一段《哈姆雷特》中的经典独白，相当震撼：..."</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"//upload-images.jianshu.io/upload_images/2259045-2986b9be86b01f63?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240"</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">2</span>,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"胡歌12年后首谈车祸：既然活下来了，就不能白白活着"</span>,</span><br><span class="line">			<span class="string">"desc"</span>: <span class="string">"文/麦大人 01 胡歌又刷屏了。 近日他上了《朗读者》，而这一期的主题是“生命”，他用磁性的嗓音，朗读了一段《哈姆雷特》中的经典独白，相当震撼：..."</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"//upload-images.jianshu.io/upload_images/2259045-2986b9be86b01f63?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240"</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">3</span>,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"胡歌12年后首谈车祸：既然活下来了，就不能白白活着"</span>,</span><br><span class="line">			<span class="string">"desc"</span>: <span class="string">"文/麦大人 01 胡歌又刷屏了。 近日他上了《朗读者》，而这一期的主题是“生命”，他用磁性的嗓音，朗读了一段《哈姆雷特》中的经典独白，相当震撼：..."</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"//upload-images.jianshu.io/upload_images/2259045-2986b9be86b01f63?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240"</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">4</span>,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"胡歌12年后首谈车祸：既然活下来了，就不能白白活着"</span>,</span><br><span class="line">			<span class="string">"desc"</span>: <span class="string">"文/麦大人 01 胡歌又刷屏了。 近日他上了《朗读者》，而这一期的主题是“生命”，他用磁性的嗓音，朗读了一段《哈姆雷特》中的经典独白，相当震撼：..."</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"//upload-images.jianshu.io/upload_images/2259045-2986b9be86b01f63?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240"</span></span><br><span class="line">		&#125;],</span><br><span class="line">		<span class="string">"recommendList"</span>: [&#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">1</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"http://cdn2.jianshu.io/assets/web/banner-s-3-7123fd94750759acf7eca05b871e9d17.png"</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">2</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"http://cdn2.jianshu.io/assets/web/banner-s-5-4ba25cf5041931a0ed2062828b4064cb.png"</span></span><br><span class="line">		&#125;]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后将home/store/reducer中的defaultState各个数据设置为空</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	topicList:[],</span><br><span class="line">	articleList:[],</span><br><span class="line">	recommendList:[]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后在home/index.js中添加生命周期函数componentDidMound方法中发送ajax请求。表示当页面挂载完毕时发送请求；将获取的数据传给store，通过actioin来完成；这时候需要dispatch来发送，可是如何将home/index.js于store建立连接呢，使用connect</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mport axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line">...</span><br><span class="line">componentDidMount()&#123;</span><br><span class="line">		axios.get(<span class="string">'api/home.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">			<span class="keyword">const</span> result=res.data.data;</span><br><span class="line">			<span class="keyword">const</span> action=&#123;</span><br><span class="line">				type:<span class="string">'change_home_data'</span>,</span><br><span class="line">				topicList:result.topicList,</span><br><span class="line">				articleList:result.articleList,</span><br><span class="line">				recommendList:result.recommendList,</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">this</span>.props.changeHomeData(action);</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">(dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		changeHomeData(action)&#123;</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="literal">null</span>,mapDispatchToProps)(Home);</span><br></pre></td></tr></table></figure>
<p>这样就可以在/page/home/store/reducer.js中处理该action 了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">'change_home_data'</span>:</span><br><span class="line">			<span class="keyword">return</span> state.merge(&#123;</span><br><span class="line">				topicList:fromJS(action.topicList),</span><br><span class="line">				articleList:fromJS(action.articleList),</span><br><span class="line">				recommendList:fromJS(action.recommendList)</span><br><span class="line">			&#125;);</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-7-异步代码的拆分"><a href="#1-3-7-异步代码的拆分" class="headerlink" title="1.3.7 异步代码的拆分"></a>1.3.7 异步代码的拆分</h6><p>home/index.js应该是一个UI组件，它不应该有过多的逻辑处理，而componentDidMount中ui组件发ajax请求然后更新store，更新UI。这样不合适，可以将ajax请求直接放在changeHomeData,直接对返回结果进行派发，这样就将ui组件中逻辑剔除了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">		<span class="keyword">this</span>.props.changeHomeData();</span><br><span class="line">	&#125;</span><br><span class="line">。。。</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">(dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		changeHomeData(action)&#123;</span><br><span class="line">			axios.get(<span class="string">'api/home.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">				<span class="keyword">const</span> result=res.data.data;</span><br><span class="line">				<span class="keyword">const</span> action=&#123;</span><br><span class="line">					type:<span class="string">'change_home_data'</span>,</span><br><span class="line">					topicList:result.topicList,</span><br><span class="line">					articleList:result.articleList,</span><br><span class="line">					recommendList:result.recommendList,</span><br><span class="line">				&#125;</span><br><span class="line">				dispatch(action);</span><br><span class="line">			&#125;)</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>其实异步操作，这么放也不合理。我们可以使用redux-thunk，将它放在action中去管理</p>
<p>我们在home/store目录下创建一个actionCreators.js 的文件,并且在store/index.js中引入并输入，然后在home/index.js中修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//actionCreator.js</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getHomeInfo=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">		axios.get(<span class="string">'api/home.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">			<span class="keyword">const</span> result=res.data.data;</span><br><span class="line">			<span class="keyword">const</span> action=&#123;</span><br><span class="line">				type:<span class="string">'change_home_data'</span>,</span><br><span class="line">				topicList:result.topicList,</span><br><span class="line">				articleList:result.articleList,</span><br><span class="line">				recommendList:result.recommendList,</span><br><span class="line">			&#125;</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//home/store/index.js</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionCreators <span class="keyword">from</span> <span class="string">'./actionCreators.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; reducer , actionCreators&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//home/index.js</span></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">(dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		changeHomeData()&#123;</span><br><span class="line">			<span class="keyword">const</span> action=actionCreators.getHomeInfo();</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样我们就把home/index.js中的逻辑移动到actionCreators中去了，这里的getHomeInfo还可以进一步优化,将action提出来</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> changeHomeData=<span class="function">(<span class="params">result</span>)=&gt;</span>(&#123;</span><br><span class="line">	type:<span class="string">'change_home_data'</span>,</span><br><span class="line">	topicList:result.topicList,</span><br><span class="line">	articleList:result.articleList,</span><br><span class="line">	recommendList:result.recommendList,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getHomeInfo=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">		axios.get(<span class="string">'api/home.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">			<span class="keyword">const</span> result=res.data.data;</span><br><span class="line">			dispatch(changeHomeData(result));</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样可以创建一个constants.js文件，保存type常量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_HOME_DATA=<span class="string">'home/CHANGE_HOME_DATA'</span>;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-8-创建阅读更多"><a href="#1-3-8-创建阅读更多" class="headerlink" title="1.3.8 创建阅读更多"></a>1.3.8 创建阅读更多</h6><p>当将列表滑动到最下面时，会出现阅读更多的按钮，点击该按钮会在列表中加载更多内容。它既可以放在列表之内，也可以放在列表之外。我们将它放在列表之内</p>
<p>我们在List组件中添加一个LoadMore的组件，并在style中创建该样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">this</span>.props.list.map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">						<span class="keyword">return</span> (</span><br><span class="line">							&lt;ListItem key=&#123;item.get(<span class="string">'id'</span>)&#125;&gt;</span><br><span class="line">								&lt;img className=<span class="string">'list-pic'</span> src=&#123;item.get(<span class="string">'imgUrl'</span>)&#125; alt=<span class="string">''</span>/&gt;</span><br><span class="line">								&lt;ListInfo&gt;</span><br><span class="line">									&lt;h3 className=<span class="string">'title'</span>&gt;&#123;item.get(<span class="string">'title'</span>)&#125;&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">									&lt;p className='desc'&gt;&#123;item.get('desc')&#125;&lt;/</span>p&gt;</span><br><span class="line">								&lt;<span class="regexp">/ListInfo&gt;</span></span><br><span class="line"><span class="regexp">							&lt;/</span>ListItem&gt;</span><br><span class="line">						)</span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;</span><br><span class="line">				&lt;LoadMore&gt;更多内容&lt;<span class="regexp">/LoadMore&gt;</span></span><br><span class="line"><span class="regexp">			&lt;/</span>div&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//style</span></span><br><span class="line">export <span class="keyword">const</span> LoadMore=styled.div`</span><br><span class="line">    width: <span class="number">100</span>%;</span><br><span class="line">    height: <span class="number">40</span>px;</span><br><span class="line">    line-height:<span class="number">40</span>px;</span><br><span class="line">    margin: <span class="number">30</span>px <span class="number">0</span>;</span><br><span class="line">    text-align: center;</span><br><span class="line">    font-size: <span class="number">15</span>px;</span><br><span class="line">    border-radius: <span class="number">20</span>px;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background-color: #a5a5a5;</span><br><span class="line">    display: block;</span><br><span class="line">    cursor:pointer;</span><br><span class="line">`;</span><br></pre></td></tr></table></figure>
<p>然后给LoadMore添加点击事件,这时只需要创建mapDispatchToProps即可，创建action等不再赘述</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		getMoreList()&#123;</span><br><span class="line">			dispatch(actionCreators.getMoreList());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,mapDispatchToProps)(List);</span><br></pre></td></tr></table></figure>
<p>真实情况其实需需要翻页，只需要给reducer中添加一个articlePage的字段即可，每次getMoreList时，将该字段加1即可，不再详述。</p>
<h4 id="1-4-编写返回顶部"><a href="#1-4-编写返回顶部" class="headerlink" title="1.4 编写返回顶部"></a>1.4 编写返回顶部</h4><p>这代码量很小，单独写一个组件不合适。可以将它写在home的index.js中.</p>
<p>只需要在样式中定义该组件的样式；</p>
<p>然后添加点击事件，这里的点击事件和reducer关联不大，只是返回顶部</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">handlerScrollTop()&#123;</span><br><span class="line">		<span class="built_in">window</span>.scrollTo(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">...</span><br><span class="line">&lt;BackTop onClick=&#123;<span class="keyword">this</span>.handlerScrollTop&#125;&gt;回到顶部&lt;<span class="regexp">/BackTop&gt;</span></span><br></pre></td></tr></table></figure>
<p>而官网的效果时，当页面往下拖的时候才会出现，而首屏时是不会出现的，这时需要通过变量来保存了。在reducer中添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	topicList:[],</span><br><span class="line">	articleList:[],</span><br><span class="line">	recommendList:[],</span><br><span class="line">	articlePage:<span class="number">1</span>,</span><br><span class="line">	showScroll:<span class="literal">false</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后打开home下index.js，在里面拿showScroll数据，注意当组件移除时需要将该监听移出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="keyword">this</span>.props.showScroll?</span><br><span class="line">					&lt;BackTop onClick=&#123;<span class="keyword">this</span>.handlerScrollTop&#125;&gt;回到顶部&lt;<span class="regexp">/BackTop&gt;:</span></span><br><span class="line"><span class="regexp">				null&#125;</span></span><br><span class="line"><span class="regexp">...</span></span><br><span class="line"><span class="regexp">	componentDidMount()&#123;</span></span><br><span class="line"><span class="regexp">		this.props.changeHomeData();</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">		this.bindEvents();</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	componentWillUnmount()&#123;</span></span><br><span class="line"><span class="regexp">		this.removeEvents();</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">	bindEvents()&#123;</span></span><br><span class="line"><span class="regexp">		window.addEventListener("scroll",this.props.changeScrollShow);</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	removeEvents()&#123;</span></span><br><span class="line"><span class="regexp">		window.removeEventListener("scroll",this.props.changeScrollShow);</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br></pre></td></tr></table></figure>
<p>这个时候，它不显示了。</p>
<p>这时就需要监听滚动方法了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">	<span class="keyword">this</span>.props.changeHomeData();</span><br><span class="line">	<span class="keyword">this</span>.bindEvents();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bindEvents()&#123;</span><br><span class="line">	<span class="built_in">window</span>.addEventListener(<span class="string">"scroll"</span>,<span class="keyword">this</span>.props.changeScrollShow);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">(dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		changeHomeData()&#123;</span><br><span class="line">			<span class="keyword">const</span> action=actionCreators.getHomeInfo();</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;,</span><br><span class="line">		changeScrollShow(e)&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">document</span>.documentElement.scrollTop&gt;<span class="number">100</span>)&#123;</span><br><span class="line">				dispatch(actionCreators.toggleTopShow(<span class="literal">true</span>));</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				dispatch(actionCreators.toggleTopShow(<span class="literal">false</span>));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后就可以通过reducer来操作了.</p>
<p>此时reducer中switch代码好像有点多，可以将每个case中返回的内容提取出来</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> changeHomeData=<span class="function">(<span class="params">state,action</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> state.merge(&#123;</span><br><span class="line">		topicList:fromJS(action.topicList),</span><br><span class="line">		articleList:fromJS(action.articleList),</span><br><span class="line">		recommendList:fromJS(action.recommendList)</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> addArticleList=<span class="function">(<span class="params">state,action</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> state.merge(&#123;</span><br><span class="line">		<span class="string">'articleList'</span>:state.get(<span class="string">'articleList'</span>).concat(action.list),</span><br><span class="line">		<span class="string">'articlePage'</span>:action.nextPage</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line">		<span class="keyword">case</span> constants.CHANGE_HOME_DATA:</span><br><span class="line">			<span class="keyword">return</span> changeHomeData(state,action);</span><br><span class="line">		<span class="keyword">case</span> constants.ADD_ARTICLE_LIST:</span><br><span class="line">			<span class="keyword">return</span> addArticleList(state,action);</span><br><span class="line">		<span class="keyword">case</span> constants.TOGGLE_SCROLL_SHOW:</span><br><span class="line">			<span class="keyword">return</span> state.set(<span class="string">'showScroll'</span>,action.show)</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-5-路由跳转"><a href="#1-5-路由跳转" class="headerlink" title="1.5 路由跳转"></a>1.5 路由跳转</h4><p>由于页面很多时候并且不是所有的操作都要出发render。这时可以使用shouldComponentUpdate，来闭关频繁触发render，但是如果所有的子组件中都重写这个方法就太麻烦了，react内置了一个新的组件类型，叫做PureComponent，这个组件内部实现了shouldComponentUpdate，就不需要我们重复重写这个方法了。我们只要对List、Topic、Writer、Recommend组件都即成PureComponent就可以了。</p>
<p><strong>注意：</strong>这里之所以可以使用PureComponent，是因为这个项目中我们使用了框架immutable.js，PureComponent和immutable数据才能无缝对接，如果没使用immutable可能就会出现问题。所以当使用PureComponent时建议使用immutable来管理数据</p>
<p>接下来来实现首页跳转到详情页</p>
<p>可以通过添加a标签，来实现页面的跳转，这时每跳转一次都会加载一次html，这就比较耗性能。这里我们要使用react-router，因为它可以实现单页面跳转，但也面跳转是指在页面跳转过程中只会加载一次html。可以使用react-router-dom中的Link来代替a标签</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line">&lt;a key=&#123;index&#125; href=<span class="string">'/detail'</span>&gt;</span><br><span class="line">	&lt;ListItem&gt;</span><br><span class="line">	&lt;<span class="regexp">/ListItem&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>a&gt;</span><br><span class="line">--------</span><br><span class="line">&lt;Link key=&#123;index&#125; to=<span class="string">'/detail'</span>&gt;</span><br><span class="line">	&lt;ListItem&gt;</span><br><span class="line">	&lt;<span class="regexp">/ListItem&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Link&gt;</span><br></pre></td></tr></table></figure>
<p>同理我们对头部组件的logo组件也要使用Link,注意使用Link的组件必须在Router的内部，所以我们需要在App.js中，将Header组件放在Router的内部</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Link to=<span class="string">'/'</span>&gt;</span><br><span class="line">	&lt;Logo&gt;</span><br><span class="line">&lt;<span class="regexp">/Link&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    	&lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      		&lt;BrowserRouter&gt;</span><br><span class="line">	      			&lt;div&gt;</span><br><span class="line">                &lt;Header /&gt;</span><br><span class="line">		      			&lt;Route path=<span class="string">'/'</span> exact component=&#123;Home&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">		      			&lt;Route path=<span class="string">'/detail'</span> exact component=&#123;Detail&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">	      			&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">	      		&lt;/</span>BrowserRouter&gt;</span><br><span class="line">      	&lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/05/React实战3/" data-id="ck54081sl003itolrsa3v0u3b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/11/05/React实战4/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          React实战4
        
      </div>
    </a>
  
  
    <a href="/2018/10/18/react实战2/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">react实战2</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GIS/">GIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebAssembly/">WebAssembly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublime/">sublime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webgl/">webgl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/GIS/" style="font-size: 11.67px;">GIS</a> <a href="/tags/Gradle/" style="font-size: 10px;">Gradle</a> <a href="/tags/JavaScript/" style="font-size: 16.67px;">JavaScript</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/React/" style="font-size: 18.33px;">React</a> <a href="/tags/SpringBoot/" style="font-size: 11.67px;">SpringBoot</a> <a href="/tags/WebAssembly/" style="font-size: 10px;">WebAssembly</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/java/" style="font-size: 13.33px;">java</a> <a href="/tags/linux/" style="font-size: 11.67px;">linux</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/sublime/" style="font-size: 10px;">sublime</a> <a href="/tags/tomcat/" style="font-size: 11.67px;">tomcat</a> <a href="/tags/webgl/" style="font-size: 15px;">webgl</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/07/WebAssembly初体验/">WebAssembly初体验</a>
          </li>
        
          <li>
            <a href="/2019/12/24/webgl2基础/">webgl2基础</a>
          </li>
        
          <li>
            <a href="/2019/12/24/low-graphics-mode解决方法/">low-graphics mode解决方法</a>
          </li>
        
          <li>
            <a href="/2019/12/24/Ubuntu固定ip和软件愿/">Ubuntu固定ip和软件愿</a>
          </li>
        
          <li>
            <a href="/2019/12/24/浏览器跨域/">浏览器跨域</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 杨亚辉<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>