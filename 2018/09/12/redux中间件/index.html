<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>redux中间件 | afei_ask</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Redux中间件一、解决action类型太多的问题在之前的例子中，我们在TodoList文件中创建了多种action，并且在reducer文件中对多种action做了区分处理。如果action的数量变得多了以后，就很容易出现错误并且不好调试。如何解决这个问题呢？ 我们可以在store下创建一个actionType.js的文件。在里面将不同的action定义成常量，这样就可以在其他文件中直接使用了，">
<meta name="keywords" content="React">
<meta property="og:type" content="article">
<meta property="og:title" content="redux中间件">
<meta property="og:url" content="http://yoursite.com/2018/09/12/redux中间件/index.html">
<meta property="og:site_name" content="afei_ask">
<meta property="og:description" content="Redux中间件一、解决action类型太多的问题在之前的例子中，我们在TodoList文件中创建了多种action，并且在reducer文件中对多种action做了区分处理。如果action的数量变得多了以后，就很容易出现错误并且不好调试。如何解决这个问题呢？ 我们可以在store下创建一个actionType.js的文件。在里面将不同的action定义成常量，这样就可以在其他文件中直接使用了，">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/2018/09/12/redux中间件/redux-data-flow.png">
<meta property="og:updated_time" content="2019-12-24T13:40:49.462Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redux中间件">
<meta name="twitter:description" content="Redux中间件一、解决action类型太多的问题在之前的例子中，我们在TodoList文件中创建了多种action，并且在reducer文件中对多种action做了区分处理。如果action的数量变得多了以后，就很容易出现错误并且不好调试。如何解决这个问题呢？ 我们可以在store下创建一个actionType.js的文件。在里面将不同的action定义成常量，这样就可以在其他文件中直接使用了，">
<meta name="twitter:image" content="http://yoursite.com/2018/09/12/redux中间件/redux-data-flow.png">
  
    <link rel="alternate" href="/atom.xml" title="afei_ask" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">afei_ask</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-redux中间件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/12/redux中间件/" class="article-date">
  <time datetime="2018-09-12T15:44:33.000Z" itemprop="datePublished">2018-09-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      redux中间件
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Redux中间件"><a href="#Redux中间件" class="headerlink" title="Redux中间件"></a>Redux中间件</h2><h3 id="一、解决action类型太多的问题"><a href="#一、解决action类型太多的问题" class="headerlink" title="一、解决action类型太多的问题"></a>一、解决action类型太多的问题</h3><p>在之前的例子中，我们在TodoList文件中创建了多种action，并且在reducer文件中对多种action做了区分处理。如果action的数量变得多了以后，就很容易出现错误并且不好调试。如何解决这个问题呢？</p>
<p>我们可以在store下创建一个actionType.js的文件。在里面将不同的action定义成常量，这样就可以在其他文件中直接使用了，又不容易出现错误</p>
<p>actionType.js文件内容可以如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_INPUT_VALUE=<span class="string">"change_input_value"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_TODO_ITEM=<span class="string">"add_todo_item"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DELETE_TODO_ITEM=<span class="string">"delete_todo_item"</span>;</span><br></pre></td></tr></table></figure>
<p>然后在TodoList中引入这三个常量即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CHANGE_INPUT_VALUE,ADD_TODO_ITEM,DELETE_TODO_ITEM&#125; <span class="keyword">from</span> <span class="string">'./actionType.js'</span>;</span><br><span class="line">...</span><br><span class="line">	handleInputChange(event)&#123;</span><br><span class="line">		<span class="keyword">const</span> action=&#123;</span><br><span class="line">			type:CHANGE_INPUT_VALUE,</span><br><span class="line">			value:event.target.value,</span><br><span class="line">		&#125;;</span><br><span class="line">		store.dispatch(action);</span><br><span class="line">		&#125;</span><br><span class="line">	  </span><br><span class="line">	  <span class="comment">//当感知到数据发生变化时，就回去新的state数据</span></span><br><span class="line">	  handleStoreChange(event)&#123;</span><br><span class="line">	  	<span class="keyword">this</span>.setState(store.getState());</span><br><span class="line">	  &#125;</span><br><span class="line">	  </span><br><span class="line">	  handleBtnClick(event)&#123;</span><br><span class="line">	  	<span class="keyword">const</span> action=&#123;</span><br><span class="line">			type:ADD_TODO_ITEM,</span><br><span class="line">		&#125;;</span><br><span class="line">		store.dispatch(action);</span><br><span class="line">	  &#125;</span><br><span class="line">	  </span><br><span class="line">	  handleItemDelete(index)&#123;</span><br><span class="line">	  	<span class="keyword">const</span> action=&#123;</span><br><span class="line">			type:DELETE_TODO_ITEM,</span><br><span class="line">		    index,</span><br><span class="line">		&#125;;</span><br><span class="line">		store.dispatch(action);</span><br><span class="line">	  &#125;</span><br></pre></td></tr></table></figure>
<p>同理也需要对reducer中引入这些常量。</p>
<h3 id="二、创建action创建器"><a href="#二、创建action创建器" class="headerlink" title="二、创建action创建器"></a>二、创建action创建器</h3><p>在之前的例子中，我们都是直接创建action对象，虽然方便，但是这种方式却不便于管理。我们需要一个action创建器来统一创建相应的action。</p>
<p>在store下面创建一个actionCreators.js的文件</p>
<p>输入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CHANGE_INPUT_VALUE&#125; <span class="keyword">from</span> <span class="string">'./actionType.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getInputChangeAction=<span class="function">(<span class="params">value</span>)=&gt;</span>(&#123;</span><br><span class="line">    type=CHANGE_INPUT_VALUE,</span><br><span class="line">    value,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后我们在TodoList文件中修改该action的创建方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getInputChangeAction &#125; <span class="keyword">from</span> <span class="string">'./store/actionCreators.js'</span>;</span><br><span class="line">...</span><br><span class="line">handleInputChange(event)&#123;</span><br><span class="line">		<span class="keyword">const</span> action=getInputChangeAction(event.target.value);</span><br><span class="line">		store.dispatch(action);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p>同理对其他的action做同样的处理</p>
<h3 id="三、Redux使用三原则"><a href="#三、Redux使用三原则" class="headerlink" title="三、Redux使用三原则"></a>三、Redux使用三原则</h3><ul>
<li><strong>store唯一</strong>：整个工程只有一个store</li>
<li><strong>只有store能够改变自己的内容</strong>：很多同学认为是reducer改变的store中的内容，其实不是的，reducer只是拿到了之前的数据，然后创建一个新的数据，将新的数据返回给了store；其实还是store将数据进行更新</li>
<li><strong>Reducer必须是存函数</strong>：存函数给定固定的输入就一定会有固定的输出，而且不会有任何副作用（除了返回东西不会做任何改变）。</li>
</ul>
<p>store最常用的四个方法：</p>
<ul>
<li>createStore</li>
<li>store.dispatch</li>
<li>store.getState</li>
<li>store.subscribe</li>
</ul>
<h3 id="四、拆分UI组件和容器组件"><a href="#四、拆分UI组件和容器组件" class="headerlink" title="四、拆分UI组件和容器组件"></a>四、拆分UI组件和容器组件</h3><p>在之前的例子中我们在组件TodoList中既处理UI部分也处理逻辑部分，这样会造成很多混乱，可以考虑将组件拆分成UI组件和容器组件。</p>
<h4 id="4-1编写UI组件"><a href="#4-1编写UI组件" class="headerlink" title="4.1编写UI组件"></a>4.1编写UI组件</h4><p>在UI组件中只展示UI，容器部分只处理逻辑</p>
<p>我们可以新建一个TodoListUI.js;</p>
<p>将UI编写UI部分；</p>
<p>此时该组件中的设计的逻辑部分只能通过父组件传递过来,使用this.props.XXX的方式；</p>
<p>最后将该组件输出export</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Input , Button , List&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoListUI</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">	      &lt;div style=&#123;&#123;<span class="attr">marginTop</span>:<span class="string">'10px'</span> , <span class="attr">marginLeft</span>:<span class="string">'10px'</span>&#125;&#125;&gt;</span><br><span class="line">	        &lt;div&gt;</span><br><span class="line">	        		&lt;Input </span><br><span class="line">	        			value=&#123;<span class="keyword">this</span>.props.inputValue&#125; placeholder=<span class="string">"todo info"</span> </span><br><span class="line">	        			style=&#123;&#123;<span class="attr">width</span>:<span class="string">'300px'</span>,<span class="attr">marginRight</span>:<span class="string">'10px'</span>&#125;&#125; </span><br><span class="line">	        			onChange=&#123;<span class="keyword">this</span>.props.handleInputChange&#125;/&gt;</span><br><span class="line">	        		&lt;Button type=<span class="string">"primary"</span> onClick=&#123;<span class="keyword">this</span>.props.handleBtnClick&#125;&gt;提交&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">	        	&lt;/</span>div&gt;</span><br><span class="line">	        &lt;List</span><br><span class="line">	        	  style=&#123;&#123;<span class="attr">width</span>:<span class="string">'300px'</span>,<span class="attr">marginTop</span>:<span class="string">'10px'</span>&#125;&#125;</span><br><span class="line">	          bordered</span><br><span class="line">	          dataSource=&#123;<span class="keyword">this</span>.props.list&#125;</span><br><span class="line">	          renderItem=&#123;(item,index) =&gt; <span class="function">(<span class="params">&lt;List.Item onClick=&#123;(</span>)=&gt;</span>&#123;<span class="keyword">this</span>.props.handleItemDelete(index)&#125;&#125;&gt;&#123;item&#125;&lt;<span class="regexp">/List.Item&gt;)&#125;</span></span><br><span class="line"><span class="regexp">	        /</span>&gt;</span><br><span class="line">	      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">	    );</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default TodoListUI;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-2-修改逻辑组件部分"><a href="#4-2-修改逻辑组件部分" class="headerlink" title="4.2 修改逻辑组件部分"></a>4.2 修改逻辑组件部分</h4><p>在TodoList.js文件中，引入TodoListUI，直接添加到render方法中。</p>
<p>然后将TodoListUI需要用到的一些逻辑通过属性传递过去</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'antd/dist/antd.css'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store/index'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getInputChangeAction , getAddItemAction , getDeleteItemAction &#125; <span class="keyword">from</span> <span class="string">'./store/actionCreator.js'</span>;</span><br><span class="line"><span class="keyword">import</span> TodoListUI <span class="keyword">from</span> <span class="string">'./TodoListUI'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">		<span class="keyword">super</span>(props);</span><br><span class="line">		<span class="keyword">this</span>.state=store.getState();</span><br><span class="line">		<span class="keyword">this</span>.handleInputChange.bind(<span class="keyword">this</span>);</span><br><span class="line">		<span class="keyword">this</span>.handleStoreChange=<span class="keyword">this</span>.handleStoreChange.bind(<span class="keyword">this</span>);</span><br><span class="line">		<span class="keyword">this</span>.handleBtnClick=<span class="keyword">this</span>.handleBtnClick.bind(<span class="keyword">this</span>);</span><br><span class="line">		<span class="keyword">this</span>.handleItemDelete=<span class="keyword">this</span>.handleItemDelete.bind(<span class="keyword">this</span>);</span><br><span class="line">		</span><br><span class="line">		store.subscribe(<span class="keyword">this</span>.handleStoreChange);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	  render() &#123;</span><br><span class="line">	    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">TodoListUI</span> </span></span></span><br><span class="line"><span class="xml">	    				inputValue=&#123;this.state.inputValue&#125;</span></span><br><span class="line"><span class="xml">	    				list=&#123;this.state.list&#125;</span></span><br><span class="line"><span class="xml">	    				handleInputChange=&#123;this.handleInputChange&#125;</span></span><br><span class="line"><span class="xml">	    				handleStoreChange=&#123;this.handleStoreChange&#125;</span></span><br><span class="line"><span class="xml">	    				handleBtnClick=&#123;this.handleBtnClick&#125;</span></span><br><span class="line"><span class="xml">	    				handleItemDelete=&#123;this.handleItemDelete&#125;</span></span><br><span class="line"><span class="xml">	    			/&gt;;</span></span><br><span class="line"><span class="xml">	  &#125;</span></span><br><span class="line"><span class="xml">	  </span></span><br><span class="line"><span class="xml">	  handleInputChange(event)&#123;</span></span><br><span class="line"><span class="xml">		const action=getInputChangeAction(event.target.value);</span></span><br><span class="line"><span class="xml">		store.dispatch(action);</span></span><br><span class="line"><span class="xml">		&#125;</span></span><br><span class="line"><span class="xml">	  </span></span><br><span class="line"><span class="xml">	  //当感知到数据发生变化时，就回去新的state数据</span></span><br><span class="line"><span class="xml">	  handleStoreChange(event)&#123;</span></span><br><span class="line"><span class="xml">	  	this.setState(store.getState());</span></span><br><span class="line"><span class="xml">	  &#125;</span></span><br><span class="line"><span class="xml">	  </span></span><br><span class="line"><span class="xml">	  handleBtnClick(event)&#123;</span></span><br><span class="line"><span class="xml">	  	const action=getAddItemAction();</span></span><br><span class="line"><span class="xml">		store.dispatch(action);</span></span><br><span class="line"><span class="xml">	  &#125;</span></span><br><span class="line"><span class="xml">	  </span></span><br><span class="line"><span class="xml">	  handleItemDelete(index)&#123;</span></span><br><span class="line"><span class="xml">	  	const action=getDeleteItemAction(index);</span></span><br><span class="line"><span class="xml">		store.dispatch(action);</span></span><br><span class="line"><span class="xml">	  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">export default TodoList;</span></span><br></pre></td></tr></table></figure>
<p>此时UI组件和逻辑组件就分开了，功能同样实现</p>
<h3 id="五、无状态组件"><a href="#五、无状态组件" class="headerlink" title="五、无状态组件"></a>五、无状态组件</h3><p>一个组件如果没有构造函数，就可以把它写成无状态组件，比如我们上面的TodoListUI，可以改成下面的样式</p>
<p>这时使用props就不用使用this了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Input , Button , List&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoListUI=<span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">	      &lt;div style=&#123;&#123;<span class="attr">marginTop</span>:<span class="string">'10px'</span> , <span class="attr">marginLeft</span>:<span class="string">'10px'</span>&#125;&#125;&gt;</span><br><span class="line">	        &lt;div&gt;</span><br><span class="line">	        		&lt;Input </span><br><span class="line">	        			value=&#123;props.inputValue&#125; placeholder=<span class="string">"todo info"</span> </span><br><span class="line">	        			style=&#123;&#123;<span class="attr">width</span>:<span class="string">'300px'</span>,<span class="attr">marginRight</span>:<span class="string">'10px'</span>&#125;&#125; </span><br><span class="line">	        			onChange=&#123;props.handleInputChange&#125;/&gt;</span><br><span class="line">	        		&lt;Button type=<span class="string">"primary"</span> onClick=&#123;props.handleBtnClick&#125;&gt;提交&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">	        	&lt;/</span>div&gt;</span><br><span class="line">	        &lt;List</span><br><span class="line">	        	  style=&#123;&#123;<span class="attr">width</span>:<span class="string">'300px'</span>,<span class="attr">marginTop</span>:<span class="string">'10px'</span>&#125;&#125;</span><br><span class="line">	          bordered</span><br><span class="line">	          dataSource=&#123;props.list&#125;</span><br><span class="line">	          renderItem=&#123;(item,index) =&gt; <span class="function">(<span class="params">&lt;List.Item onClick=&#123;(</span>)=&gt;</span>&#123;props.handleItemDelete(index)&#125;&#125;&gt;&#123;item&#125;&lt;<span class="regexp">/List.Item&gt;)&#125;</span></span><br><span class="line"><span class="regexp">	        /</span>&gt;</span><br><span class="line">	      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">	    );</span></span><br><span class="line"><span class="regexp">&#125;；</span></span><br><span class="line"><span class="regexp">export default TodoListUI;</span></span><br></pre></td></tr></table></figure>
<p>这时候，就完成了，无状态组件性能比较高。因为它只是一个函数，而不需要一些生命周期函数.</p>
<h3 id="六、Redux发送ajax请求"><a href="#六、Redux发送ajax请求" class="headerlink" title="六、Redux发送ajax请求"></a>六、Redux发送ajax请求</h3><p>想初始化我们的列表，首先在actionType文件中添加一个action类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> INIT_LIST=<span class="string">"init_list"</span>;</span><br></pre></td></tr></table></figure>
<p>然后在actionCreator中创建该action</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CHANGE_INPUT_VALUE,ADD_TODO_ITEM,DELETE_TODO_ITEM,INIT_LIST&#125; <span class="keyword">from</span> <span class="string">'./actionType.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getInputChangeAction=<span class="function">(<span class="params">value</span>)=&gt;</span>(&#123;</span><br><span class="line">    type:CHANGE_INPUT_VALUE,</span><br><span class="line">    value,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getAddItemAction=<span class="function"><span class="params">()</span>=&gt;</span>(&#123;</span><br><span class="line">    type:ADD_TODO_ITEM,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getDeleteItemAction=<span class="function">(<span class="params">index</span>)=&gt;</span>(&#123;</span><br><span class="line">    type:DELETE_TODO_ITEM,</span><br><span class="line">    index,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> initListAction=<span class="function">(<span class="params">data</span>)=&gt;</span>(&#123;</span><br><span class="line">    type:INIT_LIST,</span><br><span class="line">    data,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在TodoList中引入该action，并且引入axios，添加componentDidMount生命周期函数,在该函数中创建action，然后将action传递给store</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getInputChangeAction , getAddItemAction , getDeleteItemAction,initListAction &#125; <span class="keyword">from</span> <span class="string">'./store/actionCreator.js'</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>; </span><br><span class="line">...</span><br><span class="line">componentDidMount()&#123;</span><br><span class="line">	  	axios.get(<span class="string">'/list.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">	  		<span class="keyword">const</span> data=res.data;</span><br><span class="line">	  		<span class="keyword">const</span> action=initListAction(data);</span><br><span class="line">	  		store.dispatch(action);</span><br><span class="line">	  	&#125;);</span><br><span class="line">	  &#125;</span><br></pre></td></tr></table></figure>
<p>最后写reducer，在reducer中完成对数据的处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CHANGE_INPUT_VALUE,ADD_TODO_ITEM,DELETE_TODO_ITEM,INIT_LIST&#125; <span class="keyword">from</span> <span class="string">'./actionType.js'</span>;</span><br><span class="line">。。。</span><br><span class="line"><span class="keyword">if</span>(action.type===INIT_LIST)&#123;</span><br><span class="line">		<span class="keyword">const</span> newState=<span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state));</span><br><span class="line">        newState.list=action.data;</span><br><span class="line">		<span class="keyword">return</span> newState;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="七、Redux-thunk中间件发送ajax请求"><a href="#七、Redux-thunk中间件发送ajax请求" class="headerlink" title="七、Redux-thunk中间件发送ajax请求"></a>七、Redux-thunk中间件发送ajax请求</h3><p>如果把过多的异步请求或逻辑放在一个组件中，会显得组件特别臃肿。我们希望将它们移除在其它地方进行统一管理。放在哪里呢？Redux-thunk可以将它们放在action 中去处理。Redux-thunk如何使用呢？</p>
<h4 id="7-1-安装redux-thunk"><a href="#7-1-安装redux-thunk" class="headerlink" title="7.1 安装redux-thunk"></a>7.1 安装redux-thunk</h4><p>首先在github<a href="https://github.com/reduxjs/redux-thunk" target="_blank" rel="noopener">官网</a>上查看，在工程目录下输入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install --save redux-thunk</span><br><span class="line"></span><br><span class="line"><span class="comment">//或</span></span><br><span class="line">yarn add redux-thunk</span><br></pre></td></tr></table></figure>
<p>那该如何使用中间件来创建store呢？</p>
<p>首先在store/index.js文件中，引入redux的applyMiddleware，并且引入thunk</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br></pre></td></tr></table></figure>
<p>然后在createStore中使用applyMiddleware方法，将thunk放在里面里面就行了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer,</span><br><span class="line">			applyMiddleware(thunk)</span><br><span class="line">			);</span><br></pre></td></tr></table></figure>
<h4 id="7-2-redux同时使用dev-tools和thunk中间件"><a href="#7-2-redux同时使用dev-tools和thunk中间件" class="headerlink" title="7.2 redux同时使用dev-tools和thunk中间件"></a>7.2 redux同时使用dev-tools和thunk中间件</h4><p>如果想将之前的<code>window.__REDUX_DEVTOOLS_EXTENSION__ &amp;&amp; window.__REDUX_DEVTOOLS_EXTENSION__()</code>和thunk同时使用该怎么办呢？它们全都是Redux的中间件，可以去github的<a href="https://github.com/zalmoxisus/redux-devtools-extension" target="_blank" rel="noopener">REDUX_DEVTOOLS</a>    中查看使用方式</p>
<ul>
<li><p>首先声明<code>window.__REDUX_DEVTOOLS_EXTENSION__ &amp;&amp; window.__REDUX_DEVTOOLS_EXTENSION__()</code>，</p>
</li>
<li><p>然后扩展thunk</p>
</li>
<li>最后使用即可</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore , applyMiddleware , compose&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> composeEnhancers =<span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ? <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__(&#123;&#125;) : compose;</span><br><span class="line"><span class="keyword">const</span> enhancer = composeEnhancers(</span><br><span class="line">  applyMiddleware(thunk),</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer,enhancer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<p>这样我们的代码就可以既支持devtools，又支持thunk了</p>
<h4 id="7-3-使用thunk编写代码"><a href="#7-3-使用thunk编写代码" class="headerlink" title="7.3 使用thunk编写代码"></a>7.3 使用thunk编写代码</h4><p>之前我们的aciton都是一个函数，函数返回的是一个对象，如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> initListAction=<span class="function">(<span class="params">data</span>)=&gt;</span>(&#123;</span><br><span class="line">    type:INIT_LIST,</span><br><span class="line">    data,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在使用thunk之后，我们action，函数返回的也可以是一个函数</p>
<p>首先我们将TodoList的componentDidMount函数中的异步代码删除。</p>
<p>然后在actionCreators.js中,放进来，注意这里不用在引入store了，因为返回的函数自动接收了store的dispatch方法，可以直接将里面创建的action派发出去了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getTodoList=<span class="function"><span class="params">()</span>=&gt;</span>(&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">    	axios.get(<span class="string">'/todolist.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">	  		<span class="keyword">const</span> data=res.data;</span><br><span class="line">	  		<span class="keyword">const</span> action=initListAction(data);</span><br><span class="line">	  		dispatch(action);</span><br><span class="line">	  	&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这里我们使用axios，所以需要在actionCreators.js文件中添加两个引用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br></pre></td></tr></table></figure>
<p>然后在TodoList.js组件的componentDidMount函数中创建getTodoList的action，注意需要先import</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getTodoList, getInputChangeAction , getAddItemAction , getDeleteItemAction,initListAction &#125; <span class="keyword">from</span> <span class="string">'./store/actionCreator.js'</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">componentDidMount()&#123;</span><br><span class="line">    <span class="keyword">const</span> action=getTodoList();</span><br><span class="line">    store.dispatch(action);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意这里之所以能将函数发送出去，就是因为使用了redux-thunk中间件</p>
<h3 id="八、什么是Redux的中间件"><a href="#八、什么是Redux的中间件" class="headerlink" title="八、什么是Redux的中间件"></a>八、什么是Redux的中间件</h3><p>已经使用redux中间件redux-thunk了，到底什么是中间件呢</p>
<p>redux的中间件指的是action和store之间，thunk就是对store的dispatch方法做了一个升级，之前的是只能接受一个对象，现在可以接收一个函数，当接受一个函数时先执行函数再分发</p>
<img src="/2018/09/12/redux中间件/redux-data-flow.png" title="redux-data-flow流程图">
<h3 id="九、Redux-saga中间件"><a href="#九、Redux-saga中间件" class="headerlink" title="九、Redux-saga中间件"></a>九、Redux-saga中间件</h3><p>这里再强调一下，中间件指的是action和store之间，因为只有redux才有store和action。之前我们学习的redux-thunk将异步过程封装到了action之中，这样有助于我们做自动化测试，以及异步代码拆分管理。redux-saga也是做这种异步代码拆分的工作，可以用redux-saga完全代替redux-thunk。</p>
<h4 id="9-1-安装Redux-saga"><a href="#9-1-安装Redux-saga" class="headerlink" title="9.1 安装Redux-saga"></a>9.1 安装Redux-saga</h4><p>首先进入<a href="https://github.com/redux-saga/redux-saga" target="_blank" rel="noopener">官网</a>，进行Redux-saga的安装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --save redux-saga</span><br><span class="line"><span class="comment">//或</span></span><br><span class="line">yarn add redux-saga</span><br></pre></td></tr></table></figure>
<p>然后在store/index.js组件中引入createSagaMiddleware，用于创建中间件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createSagaMiddleware <span class="keyword">from</span> <span class="string">'redux-saga'</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// create the saga middleware</span></span><br><span class="line"><span class="keyword">const</span> sagaMiddleware = createSagaMiddleware()</span><br></pre></td></tr></table></figure>
<p>之前在redux-thunk中是通过composeEnhancers将中间件传进入，redux-saga也一样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> composeEnhancers =<span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ? <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__(&#123;&#125;) : compose;</span><br><span class="line"><span class="keyword">const</span> enhancer = composeEnhancers(</span><br><span class="line">  applyMiddleware(sagaMiddleware),</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer,enhancer);</span><br></pre></td></tr></table></figure>
<p>在store文件夹下创建一个sagas.js的文件，然后在store/index.js文件中引入该文件，并执行saga文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> todoSagas <span class="keyword">from</span> <span class="string">'./sagas'</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// then run the saga</span></span><br><span class="line">sagaMiddleware.run(todoSagas)</span><br></pre></td></tr></table></figure>
<p>sagas.js文件中写什么呢？一定要导出一个generator函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">todoSagas</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> todoSagas;</span><br></pre></td></tr></table></figure>
<h4 id="9-2-使用redux-saga"><a href="#9-2-使用redux-saga" class="headerlink" title="9.2 使用redux-saga"></a>9.2 使用redux-saga</h4><p>在actionCreator.js创建一个action,是一个函数返回一个对象.</p>
<p>首先在actionType.js中创建GET_INIT_LIST</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> GET_INIT_LIST=<span class="string">"get_init_list"</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CHANGE_INPUT_VALUE,ADD_TODO_ITEM,DELETE_TODO_ITEM,GET_INIT_LIST&#125; <span class="keyword">from</span> <span class="string">'./actionType.js'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getInitList=<span class="function"><span class="params">()</span>=&gt;</span>(&#123;</span><br><span class="line">    type:GET_INIT_LIST</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后在TodoList中使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">	<span class="keyword">const</span> action=getInitList();</span><br><span class="line">    store.dispatch(action);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时我们不仅能在reducer中接收action了，还能在sagas.js中接收了，然后将异步过程放在这里。在这里将创建的action如何发布出去呢，可以使用redux-saga中的put</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; takeEvery , put&#125; <span class="keyword">from</span> <span class="string">'redux-saga/effects'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; GET_INIT_LIST &#125; <span class="keyword">from</span> <span class="string">'./actionType'</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; initListAction &#125; <span class="keyword">from</span> <span class="string">'./store/actionCreator.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//generator函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">todoSagas</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//takeEvery：捕捉每一个XX类型的action,然后调用fetchUser这个方法</span></span><br><span class="line">    <span class="keyword">yield</span> takeEvery(GET_INIT_LIST, getInitList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">getInitList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//这里无需使用promise了</span></span><br><span class="line">    <span class="keyword">const</span> res=<span class="keyword">yield</span> axios.get(<span class="string">'/todolist.json'</span>);</span><br><span class="line">    <span class="keyword">const</span> action=initListAction(res.data);</span><br><span class="line">    <span class="keyword">yield</span> put(action);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> todoSagas;</span><br></pre></td></tr></table></figure>
<p>注意：这是在getInitList函数中如果<code>yield axios.get(&#39;/todolist.json&#39;);</code>获取成功，肯定是没问题的，但是如果获取不成功呢，ajax失败情况怎么办呢，可以使用try-catch</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">getInitList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">//这里无需使用promise了</span></span><br><span class="line">        <span class="keyword">const</span> res=<span class="keyword">yield</span> axios.get(<span class="string">'/todolist.json'</span>);</span><br><span class="line">        <span class="keyword">const</span> action=initListAction(res.data);</span><br><span class="line">        <span class="keyword">yield</span> put(action);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"网络请求失败"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>redux-thunk基本没有api，它只是让我们在action不仅仅返回对象，还能返回函数；</p>
<p>而redux-saga又很多常用的API，在大型项目中很适合</p>
<h3 id="十、React-Redux的使用"><a href="#十、React-Redux的使用" class="headerlink" title="十、React-Redux的使用"></a>十、React-Redux的使用</h3><p>React-Redux是一个第三方的模块，可以帮助我们在react中更加方便的使用redux。首先我们先将我们的工程清空，只剩一个index文件。</p>
<h4 id="10-1-安装React-Redux"><a href="#10-1-安装React-Redux" class="headerlink" title="10.1 安装React-Redux"></a>10.1 安装React-Redux</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --save react-redux</span><br><span class="line"><span class="comment">//或</span></span><br><span class="line">yarn add react-redux</span><br></pre></td></tr></table></figure>
<p>然后编写TodoList.js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">        	&lt;div&gt;</span><br><span class="line">            	&lt;div&gt;</span><br><span class="line">                    &lt;input /&gt;</span><br><span class="line">                    &lt;button&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/</span>div&gt;</span><br><span class="line">            	&lt;ul&gt;</span><br><span class="line">            		&lt;li&gt;VUE&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/u</span>l&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default TodoList;</span></span><br></pre></td></tr></table></figure>
<h4 id="10-2-创建store"><a href="#10-2-创建store" class="headerlink" title="10.2 创建store"></a>10.2 创建store</h4><p>首先创建store文件夹，并在下面创建index.js文件，在里面输入创建store（管理员）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reducer &#125; <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store=createStore();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<p>并且在store目录下创建一个reducer.js（记事本），这是一个纯函数。并在里面定义一些初始值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState=&#123;</span><br><span class="line">    inputValue:<span class="string">''</span>,</span><br><span class="line">    list:[],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们redecer和store就创建好了。</p>
<h4 id="10-3-在TodoList-js中使用store中的数据"><a href="#10-3-在TodoList-js中使用store中的数据" class="headerlink" title="10.3 在TodoList.js中使用store中的数据"></a>10.3 在TodoList.js中使用store中的数据</h4><p>首先在TodoList.js中引入store;</p>
<p>并在构造函数中通过store设置setState;</p>
<p>然后在input中加入对state的引用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store/index'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state=store.getState();</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">        	&lt;div&gt;</span><br><span class="line">            	&lt;div&gt;</span><br><span class="line">                    &lt;input value=&#123;<span class="keyword">this</span>.state.inputValue&#125;/&gt;</span><br><span class="line">                    &lt;button&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/</span>div&gt;</span><br><span class="line">            	&lt;ul&gt;</span><br><span class="line">            		&lt;li&gt;VUE&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/u</span>l&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default TodoList;</span></span><br></pre></td></tr></table></figure>
<p>那我们该如何使用React-Redux呢？</p>
<h4 id="10-4-使用React-Redux"><a href="#10-4-使用React-Redux" class="headerlink" title="10.4 使用React-Redux"></a>10.4 使用React-Redux</h4><p>在index.js文件中，之前是直接渲染TodoList，现在我们引入react-redux，并且声明一个App，将TodoList传给App，最后将App传给RenderDom使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">'./TodoList'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App=（</span><br><span class="line">	&lt;Provider&gt;</span><br><span class="line">      &lt;TodoList /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">）；</span></span><br><span class="line"><span class="regexp">RenderDom.render(App, document.getElementById("root"));</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/RenderDom.render(&lt;TodoList /</span>&gt;, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure>
<p>这里将TodoList组件传给了Provider组件，Provider组件来自于react-redux。</p>
<p>provider组件可以做什么呢？provider可以提供链接store的能力</p>
<p>我们继续引入store，然后在provider组件中使用如下，这样Provider内的所有组件都有获取store的能力</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App=（</span><br><span class="line">	&lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;TodoList /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">）；</span></span><br></pre></td></tr></table></figure>
<p>此时TodoList组件有获取store的能力了，它怎么获取store呢？</p>
<p>此时我们在TodoList.js中就可以改变获取store的方式了，首先引入react-redux中的connnect，然后到处connect方法。connect的方法是让TodoList和store做连接</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">        	&lt;div&gt;</span><br><span class="line">            	&lt;div&gt;</span><br><span class="line">                    &lt;input value=&#123;<span class="keyword">this</span>.state.inputValue&#125;/&gt;</span><br><span class="line">                    &lt;button&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/</span>div&gt;</span><br><span class="line">            	&lt;ul&gt;</span><br><span class="line">            		&lt;li&gt;VUE&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/u</span>l&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(null,null)(TodoList);</span></span><br></pre></td></tr></table></figure>
<p>connect是怎么做连接的呢？首先我们可以创建一个mapStateToProps，然后将它放在connect的一个参数处</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将state中的数据映射给props</span></span><br><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        inputValue：state.inputValue,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,<span class="literal">null</span>)(TodoList);</span><br></pre></td></tr></table></figure>
<p>这时我们input中的value就不是等于{this.state.inputValue}了，不使用state了改为props，需要改为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input value=&#123;<span class="keyword">this</span>.props.inputValue&#125;/&gt;</span><br></pre></td></tr></table></figure>
<p>然后我们实现onChange方法，在input标签中添加该监听，并且编写一个mapDispatchToProps，将它放在connect的第二个参数处。然后</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;input value=&#123;<span class="keyword">this</span>.props.inputValue&#125; onChange=&#123;<span class="keyword">this</span>.props.changeInputValue)&#125;/&gt;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">handleInputChange(event)&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//store.dispatch 挂载到props上</span></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=(dispatch)=&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        changeInputValue(e)&#123;</span><br><span class="line">    		<span class="keyword">const</span> action=&#123;</span><br><span class="line">                type:<span class="string">'change_input_value'</span>,</span><br><span class="line">                value:e.target.value,</span><br><span class="line">            &#125;;</span><br><span class="line">			dispatch(action);</span><br><span class="line">    	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,mapDispatchToProps)(TodoList);</span><br></pre></td></tr></table></figure>
<p>然后就可以在reduce中做处理了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=&#123;</span><br><span class="line">    inputValue:<span class="string">''</span>,</span><br><span class="line">    list:[],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(action.type===<span class="string">'change_input_value'</span>)&#123;</span><br><span class="line">    	cost newState=<span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state));</span><br><span class="line">        newState.inputValue=action.value;</span><br><span class="line">        <span class="keyword">return</span> newState;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里对react-redux的使用就讲解的差不多了，</p>
<p>接下来我们给button添加一个监听，然后在mapDispatchToProps中添加这个监听函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="keyword">this</span>.props.handleClick&#125;&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">...</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapDispatchToProps=(dispatch)=&#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">        changeInputValue(e)&#123;</span></span><br><span class="line"><span class="regexp">    		const action=&#123;</span></span><br><span class="line"><span class="regexp">                type:'change_input_value',</span></span><br><span class="line"><span class="regexp">                value:e.target.value,</span></span><br><span class="line"><span class="regexp">            &#125;;</span></span><br><span class="line"><span class="regexp">			dispatch(action);</span></span><br><span class="line"><span class="regexp">    	&#125;，</span></span><br><span class="line"><span class="regexp">        handleClick(e)&#123;</span></span><br><span class="line"><span class="regexp">            /</span><span class="regexp">/...</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>然后在做action类型的处理即可，不再重复。</p>
<p>同理对于列表，可以这么处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="keyword">this</span>.props.list.map(<span class="function">(<span class="params">item,index</span>)=&gt;</span>(&#123;<span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>&#125;));</span><br><span class="line">	&#125;</span><br><span class="line">&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">...</span></span><br><span class="line"><span class="regexp">const mapStateToProps=(state)=&gt;&#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">        inputValue：state.inputValue,</span></span><br><span class="line"><span class="regexp">        list:state.list,</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<p>这是代码中出现太多的this.props.XXX，其实可以精简一下，在render函数中使用结构赋值，就可以在直接使用相应的函数了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">render()&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;inputValue,list,changeInputValue,handleClick&#125; =<span class="keyword">this</span>.props;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时的TodoList就是一个UI组件，可以改为无状态组件，因为无状态组件性能比较高，可以直接写成函数的形式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoList=<span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;inputValue,list,changeInputValue,handleClick&#125; =props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        	&lt;div&gt;</span><br><span class="line">            	&lt;div&gt;</span><br><span class="line">                    &lt;input value=&#123;inputValue&#125; onChange=&#123;changeInputValue&#125;/&gt;</span><br><span class="line">                    &lt;button onClick=&#123;handleClick&#125;&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/</span>div&gt;</span><br><span class="line">            	&lt;ul&gt;</span><br><span class="line">            		&#123;list.map(<span class="function">(<span class="params">item,index</span>)=&gt;</span>(&#123;<span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>&#125;));&#125;</span><br><span class="line">            	&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        inputValue：state.inputValue,</span><br><span class="line">        list:state.list,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=(dispatch)=&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        changeInputValue(e)&#123;</span><br><span class="line">    		<span class="keyword">const</span> action=&#123;</span><br><span class="line">                type:<span class="string">'change_input_value'</span>,</span><br><span class="line">                value:e.target.value,</span><br><span class="line">            &#125;;</span><br><span class="line">			dispatch(action);</span><br><span class="line">    	&#125;，</span><br><span class="line">        handleClick(e)&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,mapDispatchToProps)(TodoList);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/12/redux中间件/" data-id="ck54081s7003ftolrw6ld9bc3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/10/18/react实战1/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          react实战1
        
      </div>
    </a>
  
  
    <a href="/2018/09/06/react中Redux的使用/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">react中Redux的使用</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GIS/">GIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebAssembly/">WebAssembly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublime/">sublime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webgl/">webgl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/GIS/" style="font-size: 11.67px;">GIS</a> <a href="/tags/Gradle/" style="font-size: 10px;">Gradle</a> <a href="/tags/JavaScript/" style="font-size: 16.67px;">JavaScript</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/React/" style="font-size: 18.33px;">React</a> <a href="/tags/SpringBoot/" style="font-size: 11.67px;">SpringBoot</a> <a href="/tags/WebAssembly/" style="font-size: 10px;">WebAssembly</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/java/" style="font-size: 13.33px;">java</a> <a href="/tags/linux/" style="font-size: 11.67px;">linux</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/sublime/" style="font-size: 10px;">sublime</a> <a href="/tags/tomcat/" style="font-size: 11.67px;">tomcat</a> <a href="/tags/webgl/" style="font-size: 15px;">webgl</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/07/WebAssembly初体验/">WebAssembly初体验</a>
          </li>
        
          <li>
            <a href="/2019/12/24/webgl2基础/">webgl2基础</a>
          </li>
        
          <li>
            <a href="/2019/12/24/low-graphics-mode解决方法/">low-graphics mode解决方法</a>
          </li>
        
          <li>
            <a href="/2019/12/24/Ubuntu固定ip和软件愿/">Ubuntu固定ip和软件愿</a>
          </li>
        
          <li>
            <a href="/2019/12/24/浏览器跨域/">浏览器跨域</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 杨亚辉<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>