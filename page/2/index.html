<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>afei_ask</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="afei_ask">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="afei_ask">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="afei_ask">
  
    <link rel="alternate" href="/atom.xml" title="afei_ask" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">afei_ask</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-WebGL绑定多纹理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/24/WebGL绑定多纹理/" class="article-date">
  <time datetime="2019-12-24T14:03:48.000Z" itemprop="datePublished">2019-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/24/WebGL绑定多纹理/">WebGL绑定多纹理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我们的场景时实时渲染网络切片地图栅格数据。如果每次在渲染阶段进行数据的绑定，必定会降低帧率，什么卡顿。该如何优化呢</p>
<h3 id="一、思考"><a href="#一、思考" class="headerlink" title="一、思考"></a>一、思考</h3><p>对于非图片数据，我们的处理方式是：</p>
<ul>
<li>将各attribute数据绑定到vbo中；</li>
<li>将各vbos绑定给指定的vao中；</li>
<li>绘制时，切换vao即可。</li>
</ul>
<p>但是这个方式对绘制大量图片并不适用，原因是webgl中可绑定的纹理数量一定。这就导致对于有限树数量的纹理单元（textureUnit）我们必须要重复使用。</p>
<p>如何破解这个问题呢？</p>
<p>虽然可绑定的纹理单元数量有限，但是我们可创建的纹理却不受限制。</p>
<p>这样我们就可以继续将各vbo绑定给vao，然后在绘制时，实时将已经创建好纹理绑定给指定的纹理单元即可。</p>
<h3 id="二、方案"><a href="#二、方案" class="headerlink" title="二、方案"></a>二、方案</h3><ul>
<li>计算要渲染切片的position、textureCoord、index等数据</li>
<li>创建各个attribute的buffer</li>
<li>创建一个空纹理对象texture，可以是纯色</li>
<li>将各buffers绑定给vao，并且将空纹理texture与该vao关联起来</li>
<li>异步请求img的实际数据，然后更新纹理的真实数据，并给texture标记需update</li>
<li>绘制时，若texture的update为false，则直接绑定空纹理数据绘制；若update为true，则重新绑定纹理数据，进行绘制</li>
</ul>
<h3 id="三、其它"><a href="#三、其它" class="headerlink" title="三、其它"></a>三、其它</h3><p>需要注意：</p>
<ul>
<li>请求切片可以放在子线程中执行；</li>
<li>这个频繁切换的纹理，要使用可变纹理的方式</li>
</ul>
<h3 id="四、创建空纹理的代码"><a href="#四、创建空纹理的代码" class="headerlink" title="四、创建空纹理的代码"></a>四、创建空纹理的代码</h3><p>对于网络图片，首先需要先把图片数据下载下来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// creates a texture info &#123; width: w, height: h, texture: tex &#125;</span></span><br><span class="line"><span class="comment">// The texture will start with 1x1 pixels and be updated</span></span><br><span class="line"><span class="comment">// when the image has loaded</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadImageAndCreateTextureInfo</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//创建纹理对像，默认设置填充为蓝色</span></span><br><span class="line">  <span class="keyword">var</span> tex = gl.createTexture();</span><br><span class="line">  gl.bindTexture(gl.TEXTURE_2D, tex);</span><br><span class="line">  <span class="comment">// Fill the texture with a 1x1 blue pixel.</span></span><br><span class="line">  gl.texImage2D(gl.TEXTURE_2D, <span class="number">0</span>, gl.RGBA, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, gl.RGBA, gl.UNSIGNED_BYTE,</span><br><span class="line">                <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>]));</span><br><span class="line"> </span><br><span class="line">  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);</span><br><span class="line">  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> textureInfo = &#123;</span><br><span class="line">    width: <span class="number">1</span>,   <span class="comment">// we don't know the size until it loads</span></span><br><span class="line">    height: <span class="number">1</span>,</span><br><span class="line">    texture: tex,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">  img.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    textureInfo.width = img.width;</span><br><span class="line">    textureInfo.height = img.height;</span><br><span class="line"> </span><br><span class="line">    gl.bindTexture(gl.TEXTURE_2D, textureInfo.texture);</span><br><span class="line">    gl.texImage2D(gl.TEXTURE_2D, <span class="number">0</span>, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);</span><br><span class="line">    gl.generateMipmap(gl.TEXTURE_2D);</span><br><span class="line">  &#125;);</span><br><span class="line">  img.src = url;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> textureInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>思路1</p>
<p>先将顶点坐标、纹理坐标、纹理预处理好，可以直接绘制。并且绑定给vao。在绘制时，默认绘制vao，直到真实纹理加载完成，直接再次绑定新的纹理即可。</p>
</li>
</ul>
<p>课外：<a href="https://webgl2fundamentals.org/webgl/lessons/webgl-texture-units.html" target="_blank" rel="noopener"><a href="https://webgl2fundamentals.org/webgl/lessons/webgl-texture-units.html" target="_blank" rel="noopener">https://webgl2fundamentals.org/webgl/lessons/webgl-texture-units.html</a></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/24/WebGL绑定多纹理/" data-id="ck4jzi8nw000frflrgi0sddeu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webgl/">webgl</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/24/hello-world/" class="article-date">
  <time datetime="2019-12-24T14:02:24.849Z" itemprop="datePublished">2019-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/24/hello-world/">Hello again</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="前沿"><a href="#前沿" class="headerlink" title="前沿"></a>前沿</h3><p>作为程序员的悲哀，大家以我为鉴。</p>
<h3 id="缘由"><a href="#缘由" class="headerlink" title="缘由"></a>缘由</h3><p>使用vim莫名的创建一个“～”的文件夹，就想着删除它，执行代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm ~</span><br></pre></td></tr></table></figure></p>
<p>发现居然删不了，果断换成：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ~</span><br></pre></td></tr></table></figure></p>
<p>然后就是输入权限密码，然后就悲剧了，事情的结果是我的整个根目录几乎被删除殆尽。</p>
<h3 id="亡羊补牢"><a href="#亡羊补牢" class="headerlink" title="亡羊补牢"></a>亡羊补牢</h3><p>在mac中 “～”表示home目录，如果直接删除名为“～”的目录，相当于删除整个home目录下的所有文件（这也是为什么要管理员权限的原因），几乎无论这个“～”在什么位置都不要直接删除它。<br>如果非要删除，该怎么办呢？答案是使用绝对路径，比如我将“～”创建在了<em>“/home/afei/Desktop/”</em>下，那么执行下列命令即可：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /home/afei/Desktop/～</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/24/hello-world/" data-id="ck4jzi8of001crflrk4fxgoys" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-WebGL跨域图片" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/24/WebGL跨域图片/" class="article-date">
  <time datetime="2019-12-24T13:56:35.000Z" itemprop="datePublished">2019-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/24/WebGL跨域图片/">WebGL跨域图片</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="一、问题"><a href="#一、问题" class="headerlink" title="一、问题"></a>一、问题</h5><p>通常我们加载图片时使用这种方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url=<span class="string">'https://t6.tianditu.gov.cn/DataServer?T=img_w&amp;x=2&amp;y=1&amp;l=3&amp;tk=8971e4c7b3640d506c2dc111221af6a0'</span>;<span class="comment">//天地图的一张切片</span></span><br><span class="line"><span class="keyword">const</span> image = <span class="keyword">new</span> Image();</span><br><span class="line">image.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//拿到image，做纹理数据</span></span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br><span class="line">image.src=url;</span><br></pre></td></tr></table></figure>
<p>但是当图片为跨域图像时，就出现问题了。常规浏览器报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access to image at <span class="string">'https://t6.tianditu.gov.cn/DataServer?T=img_w&amp;x=2&amp;y=1&amp;l=3&amp;tk=8971e4c7b3640d506c2dc111221af6a0'</span> <span class="keyword">from</span> origin <span class="string">'http://localhost:3030'</span> has been blocked by CORS policy: The <span class="string">'Access-Control-Allow-Origin'</span> header has a value <span class="string">'https://map.tianditu.gov.cn'</span> that is not equal to the supplied origin.</span><br></pre></td></tr></table></figure>
<p>接下来将浏览器设置为可跨域模式（方法自行百度），此时控制台是不报错了，但是也没有任何图像展示出来。</p>
<p>？？？这他娘的不是说好的img标签允许跨域的吗？</p>
<h5 id="二、探索"><a href="#二、探索" class="headerlink" title="二、探索"></a>二、探索</h5><p>通过添加错误的监听，可以看到image没有进入到<code>load</code>回调中，而是进入到了<code>error</code>的回调中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">image.addEventListener(<span class="string">'error'</span>, ()=&gt;&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"error"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>直接使用<code>&lt;img src=&quot;private.jpg&quot;&gt;</code>是没什么问题的，因为图像尽管被浏览器显示， 便签对象并不能获取图像的内部数据。而Webgl使用的就是image的内部数据，就获取不到了。</p>
<p>有什么方法可以获取到跨域图像内部的数据呢？</p>
<h5 id="三、解决方式"><a href="#三、解决方式" class="headerlink" title="三、解决方式"></a>三、解决方式</h5><p>对于访问跨域资源必须同时满足两方面的许可：</p>
<ul>
<li>1 跨域站点允许跨域访问（需要服务器设置）</li>
<li>2 本地可以使用跨域的资源的内容（例如设置浏览器可跨域访问）</li>
</ul>
<p>下面所讲的都只是解决2的问题。</p>
<h6 id="3-1-设置crossOrigin"><a href="#3-1-设置crossOrigin" class="headerlink" title="3.1 设置crossOrigin"></a>3.1 设置crossOrigin</h6><p>最简单的方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url=<span class="string">''</span>;</span><br><span class="line"><span class="keyword">const</span> image = <span class="keyword">new</span> Image();</span><br><span class="line">image.crossOrigin = <span class="string">"anonymous"</span>; <span class="comment">//允许</span></span><br><span class="line">image.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//拿到image，做纹理数据</span></span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br><span class="line">image.src=url;</span><br></pre></td></tr></table></figure>
<p>crossOrigin的值有三个可选择：</p>
<ul>
<li>undefined：默认值，表示不需要请求许可；</li>
<li>anonymous：表示请求许可，但是不发送任何信息；</li>
<li>use-credentials：表示发送cookies和其它可能需要的信息，服务器会根据这些信息决定是否授予许可。</li>
</ul>
<p><strong>注意：设置为其他任意值则相当于 “anonymous”</strong></p>
<p>设置完<code>crossOrigin</code>属性后，浏览器从服务器请求图像时，对于不同域名，会请求CROS许可。由于请求需求需要2个http请求，资源消耗多一些。所以同域的不需要设置请求许可，只需对跨域的资源的img标签或canvas2d设置<code>crossDomain</code>属性，这样就不会使请求变慢了。</p>
<p>可以添加这个一个适配函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestCORSIfNotSameOrigin</span>(<span class="params">img, url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ((<span class="keyword">new</span> URL(url)).origin !== <span class="built_in">window</span>.location.origin) &#123;</span><br><span class="line">    img.crossOrigin = <span class="string">""</span>;<span class="comment">//相当于anonymous</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="3-2-使用canvas"><a href="#3-2-使用canvas" class="headerlink" title="3.2 使用canvas"></a>3.2 使用canvas</h6><p>第二种方法就是先将图片绘制在画布上，然后读取画布上的数据。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"display:none;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"source"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">src</span>=<span class="string">"https://mdn.mozillademos.org/files/5397/rhino.jpg"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">width</span>=<span class="string">"300"</span> <span class="attr">height</span>=<span class="string">"227"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> canvas=<span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>);</span><br><span class="line"><span class="keyword">const</span> ctx=canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line"><span class="keyword">const</span> image = <span class="built_in">document</span>.getElementById(<span class="string">'source'</span>);</span><br><span class="line">image.addEventListener(<span class="string">'load'</span>, e =&gt; &#123;</span><br><span class="line">  	ctx.drawImage(image, <span class="number">33</span>, <span class="number">71</span>, <span class="number">104</span>, <span class="number">124</span>, <span class="number">21</span>, <span class="number">20</span>, <span class="number">87</span>, <span class="number">104</span>);</span><br><span class="line">    <span class="comment">//ctx.drawImage(someImg, 0, 0);</span></span><br><span class="line">	<span class="comment">//const data = ctx.getImageData(0, 0, width, heigh);</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在WebGL中 <code>gl.readPixels</code> 和 <code>ctx.getImageData</code> 是相似的， 所以你可能以为把这个接口封闭就好了，但事实是即使不能直接获取像素值， 也可以创建一个基于图像颜色的着色器，虽然效率低但是可以等同于获取到了图像信息。</p>
<p>参考：</p>
<p><a href="https://webgl2fundamentals.org/webgl/lessons/webgl-cors-permission.html" target="_blank" rel="noopener"><a href="https://webgl2fundamentals.org/webgl/lessons/webgl-cors-permission.html" target="_blank" rel="noopener">https://webgl2fundamentals.org/webgl/lessons/webgl-cors-permission.html</a></a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage" target="_blank" rel="noopener"><a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage</a></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/24/WebGL跨域图片/" data-id="ck4jzi8nx000hrflrinl4eo9v" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webgl/">webgl</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-闭包" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/28/闭包/" class="article-date">
  <time datetime="2019-01-28T00:30:47.000Z" itemprop="datePublished">2019-01-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/28/闭包/">闭包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><h4 id="一、什么是闭包"><a href="#一、什么是闭包" class="headerlink" title="一、什么是闭包"></a>一、什么是闭包</h4><p>闭包是指有权访问另一个函数作用域中变量的函数，创建闭包的常用方式就是在一个函数内部创建另一个函数。 </p>
<p>首先来对比一下下面的代码，理解一下闭包</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outer</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> temp=<span class="number">10</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(a);</span><br><span class="line">    &#125;;</span><br><span class="line">    bar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//上面的函数inner对temp的引用是词法作用域的查找规则，这些规则只是闭包的一部分</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outer</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> temp=<span class="number">10</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params">arg1</span>)</span>&#123;</span><br><span class="line">        temp--;</span><br><span class="line">        <span class="keyword">if</span>(arg1&lt;temp)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> inner;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> test=outer();</span><br><span class="line">test(<span class="number">8</span>);<span class="comment">//0</span></span><br><span class="line">test(<span class="number">8</span>);<span class="comment">//1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//上面的函数inner的词法作用域能够访问outer内部的作用域，然后将inner()函数本身当作一个值类型进行传递。在outer()执行后，其返回值赋值给test并调用test(),实际上只是通过不同的标识符引用调用了内部的函数inner()</span></span><br></pre></td></tr></table></figure>
<p>一个普通函数outer()，通常会期待在outer()执行后，整个内部作用域都被销毁，因为引擎右垃圾回收器来释放不再使用的内存空间。outer()的内容不会再被使用，所以很自然的会考虑将其回收。</p>
<p><strong>而闭包的神奇之处就是可以阻止这件事情的发生，实际上outer内部作用域依然被引用着，因此没有被回收。是谁在 引用呢，就是inner本身。inner拥有涵盖outer内部作用域的闭包，使得该作用域一直存活，inner的这个引用就是闭包。</strong></p>
<p>由于闭包会携带包含它的函数的作用域，因此会比其它函数占用更多的内存。过度使用闭包可能会导致内存占用过多，我们建议只在绝对必要的时刻载考虑使用闭包</p>
<h4 id="二、闭包与变量"><a href="#二、闭包与变量" class="headerlink" title="二、闭包与变量"></a>二、闭包与变量</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFunction</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result=<span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">        result[i]=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> test=createFunction();</span><br><span class="line">test[<span class="number">0</span>]();<span class="comment">//10</span></span><br><span class="line">test[<span class="number">1</span>]();<span class="comment">//10</span></span><br></pre></td></tr></table></figure>
<h4 id="三、函数的类型"><a href="#三、函数的类型" class="headerlink" title="三、函数的类型"></a>三、函数的类型</h4><p>创建函数的几种方式</p>
<ol>
<li><p>声明函数 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>匿名函数表达式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn1=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">getFunctionName(fn1).length;<span class="comment">//这种方式创建的函数为匿名函数，没有函数name</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：在对象内定义函数如var o={ fn : function (){…} }，也属于函数表达式</strong></p>
</li>
<li><p>具名函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn2=<span class="function"><span class="keyword">function</span> <span class="title">XXX</span>(<span class="params"></span>)</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：具名函数表达式的函数名只能在创建函数内部使用</strong></p>
</li>
<li><p>Function构造函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以给 Function 构造函数传一个函数字符串，返回包含这个字符串命令的函数，此种方法创建的是匿名函数。</span></span><br><span class="line"><span class="built_in">Function</span>(<span class="string">"alert(1)"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>自执行函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//让匿名函数自执行</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="number">1</span>);&#125;)();</span><br></pre></td></tr></table></figure>
</li>
<li><p>其它方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>\setTimeout\setInterval</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="四、注意"><a href="#四、注意" class="headerlink" title="四、注意"></a>四、注意</h3><ol>
<li>全局函数中的this等于window</li>
<li>当函数被某个对象的方法调用时，this等于哪个对象</li>
<li>匿名函数的执行环境具有全局性，this通常指向window</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/28/闭包/" data-id="ck4jzi8or001yrflrc09u7t9y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-JS原型" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/09/JS原型/" class="article-date">
  <time datetime="2019-01-08T23:29:33.000Z" itemprop="datePublished">2019-01-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/09/JS原型/">JS原型</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>前端面试题永远少不了js的原型和原型链。解释起来有点拗口，可以用一张图来讲解：</p>
<img src="/2019/01/09/JS原型/js_proto.png" title="js原型示例图">
<h3 id="一、Function和Object"><a href="#一、Function和Object" class="headerlink" title="一、Function和Object"></a>一、Function和Object</h3><p>首先说一下，js中自带两个函数Object和Function，Object继承自己，Funtion继承自己，Object和Function互相是继承对方，也就是说Object和Function都既是函数也是对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>;<span class="comment">//true</span></span><br><span class="line"><span class="built_in">Object</span> <span class="keyword">instanceof</span> <span class="built_in">Function</span>;<span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>也就是说Object是Function的实例，Function是自己的实例</p>
<h3 id="二、普通对象和普通函数"><a href="#二、普通对象和普通函数" class="headerlink" title="二、普通对象和普通函数"></a>二、普通对象和普通函数</h3><p>js中万物皆对象，函数是对象，函数创建出来的实例也是对象，我们将函数成为函数对象，将实例成为普通对象。</p>
<p>注意<strong>函数对象本身又是Function的实例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sample</span>(<span class="params"></span>)</span>&#123;&#125;;<span class="comment">//Sample是一个函数对象</span></span><br><span class="line"><span class="keyword">var</span> s=<span class="keyword">new</span> Sample();<span class="comment">//s是一个普通对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//function Sample()&#123;&#125;等同于</span></span><br><span class="line"><span class="keyword">var</span> Sample=<span class="keyword">new</span> <span class="built_in">Function</span>();<span class="comment">//所以Sample又是Function的实例</span></span><br></pre></td></tr></table></figure>
<h3 id="三、隐式原型和显示原型"><a href="#三、隐式原型和显示原型" class="headerlink" title="三、隐式原型和显示原型"></a>三、隐式原型和显示原型</h3><ul>
<li>每个对象都有一个名为<code>__proto__</code>的内部属性（隐式原型），它指向所对应构造函数的原型对象</li>
<li>每个函数对象都有一个prototype的属性（显示原型）prototype与<code>__proto__</code>都指向构造函数的原型对象，原型对象下面又有一个constructor属性，指向这个函数对象</li>
</ul>
<h3 id="四、原型链"><a href="#四、原型链" class="headerlink" title="四、原型链"></a>四、原型链</h3><p>js中，每个对象都会在内部生成一个<code>__proto__</code>属性，当我们访问一个对象属性时，如果这个对象不存在就会去<code>__proto__</code> 指向的对象里面找，一层一层找下去，这就是javascript原型链的概念。</p>
<p><strong>JS中所有的东西都是对象,所有的东西都由Object衍生而来, 即所有东西原型链的终点指向null</strong></p>
<h3 id="五、继承"><a href="#五、继承" class="headerlink" title="五、继承"></a>五、继承</h3><p>js中的普通对象是由构造函数（即函数对象）new出来的，这个对象产生于原型却不等于原型；这个普通对象是如何与原型产生联系的呢？就是通过这个叫<code>__proto__</code>完成的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">method</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">new</span> method();</span><br><span class="line">m===m.prototype;<span class="comment">//false</span></span><br><span class="line"></span><br><span class="line">m.__proto__====method.prototype;<span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>参考：<a href="http://baijiahao.baidu.com/s?id=1585354841830289519&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">http://baijiahao.baidu.com/s?id=1585354841830289519&amp;wfr=spider&amp;for=pc</a></p>
<p><a href="https://www.jb51.net/article/123976.htm" target="_blank" rel="noopener">https://www.jb51.net/article/123976.htm</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/01/09/JS原型/" data-id="ck4jzi8nj0003rflrfrpas6p4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-React实战4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/05/React实战4/" class="article-date">
  <time datetime="2018-11-05T14:38:00.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/05/React实战4/">React实战4</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="详情页面的布局"><a href="#详情页面的布局" class="headerlink" title="详情页面的布局"></a>详情页面的布局</h3><p>1、首先在detail下面创建布局组件style.js</p>
<p>2、然后在detail/index.js中引入上面的布局组件</p>
<p>3、在style.js中编写详情页的标题组件、内容组件，在内容组件中放置img和p等标签；</p>
<p>4、给详情页面添加redux</p>
<ul>
<li><p>在detail文件夹下创建store文件夹，并在里面创建actionCreators.js、constants.js、index.js、reducer.js</p>
</li>
<li><p>在reducer.js中添加defaultState    ,需要将带html标签的内容全部包进去</p>
</li>
<li><p>在src/store/reducer.js中，引入详情页的reducer</p>
</li>
<li><p>在detail的index.js中引入reducer，并展示内容，注意当需要展示带有html标签内容时需要使用<code>dangerouslySetInnerHTML</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;DetailContent dangerouslySetInnerHTML=&#123;&#123;<span class="attr">__html</span>:<span class="keyword">this</span>.props.content&#125;&#125;&gt;</span><br><span class="line"><span class="comment">//在DetailContent组件中展示html格式的内容</span></span><br><span class="line">&lt;DetailContent dangerouslySetInnerHTML=&#123;&#123;<span class="attr">__html</span>:<span class="keyword">this</span>.props.content&#125;&#125;&gt;</span><br><span class="line">&lt;<span class="regexp">/DetailContent&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用活数据代替死数据，componentDidMount触发请求行为，在actionCreators中引入axios发送请求</p>
</li>
<li><p>通过路由，点击不通的item，实现不同详情页的跳转</p>
</li>
</ul>
<p>两种方式：<br><strong>动态路由</strong></p>
<ul>
<li><p>在home的List页面中，将<code>&lt;Link key={index} to=&#39;/detail&#39;&gt;</code>改为<code>&lt;Link key={index} to={&#39;/detail/&#39;+item.get(&#39;id&#39;)}&gt;</code></p>
</li>
<li><p>进入APP.js，为了匹配所有的detail，将<code>&lt;Route path=&#39;/detail&#39; exact component={Detail}&gt;&lt;/Route&gt;</code>改为<code>&lt;Route path=&#39;/detail/:id&#39; exact component={Detail}&gt;&lt;/Route&gt;</code></p>
</li>
<li><p>在detail的index.js页面获取页面ID <code>this.props.match.params.id</code>,传递给getDetail方法</p>
</li>
</ul>
<h3 id="React中的异步组件"><a href="#React中的异步组件" class="headerlink" title="React中的异步组件"></a>React中的异步组件</h3><p>之前我们的代码，在控制台可以看到无论我们查看哪个页面，访问的js都没有改变。说明所有的js代码全部在一个文件里面，这样会影响速度，我们希望当我们家在首页时只加载首页代码，当我们访问详情页时只加载详情页的代码。</p>
<p>这就需要使用异步组件，就会非常简单。可以使用react-loadable组件</p>
<p>安装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-loadable</span><br><span class="line"><span class="comment">//或</span></span><br><span class="line">npm install react-loadable</span><br></pre></td></tr></table></figure>
<p>我们想要家在详情页时，再家在详情页的代码，应该怎么做呢？在detail文件夹下创建loadable.js的文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> Loadable <span class="keyword">from</span> <span class="string">'react-loadable'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> LoadableComponent = Loadable(&#123;</span><br><span class="line">  loader: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./'</span>),</span><br><span class="line">  loading()&#123;</span><br><span class="line">  	<span class="keyword">return</span> &lt;div&gt;正在加载&lt;/div&gt;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ()=&gt; &lt;LoadableComponent/&gt;</span><br></pre></td></tr></table></figure>
<p>然后来到App.js中，将饮用Detail的引用改为loadable</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">'./pages/detail'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//改为</span></span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">'./pages/detail/loadable.js'</span>;</span><br></pre></td></tr></table></figure>
<p>这时，会报错TypeError: Cannot read property ‘params’ of undefined</p>
<p>这是由于原先我们是直接使用Detail组件，现在变成了使用loadable.js了，而router是跟Detail对应的，现在对不上了，怎么办呢？</p>
<p>在detail的index.js文件中从react-router-dom引入withRouter，然后在使用connect中加入withRouter</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line">。。。</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,mapDispatchToProps)(withRouter(Detail));</span><br></pre></td></tr></table></figure>
<p>它就是让detail有能力获取到router中的内容。</p>
<p>这时就实现了对详情页的异步加载</p>
<h3 id="项目上线"><a href="#项目上线" class="headerlink" title="项目上线"></a>项目上线</h3><p>将项目打包</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>
<p>就会生成项目代码，放在后端即可</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/05/React实战4/" data-id="ck4jzi8ns000brflrs7s0lwas" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-React实战3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/05/React实战3/" class="article-date">
  <time datetime="2018-11-05T14:36:42.000Z" itemprop="datePublished">2018-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/05/React实战3/">React实战3</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、路由"><a href="#一、路由" class="headerlink" title="一、路由"></a>一、路由</h2><h4 id="1-1-路由和路由规则"><a href="#1-1-路由和路由规则" class="headerlink" title="1.1 路由和路由规则"></a>1.1 路由和路由规则</h4><p>React中路由表示根据url的不同显示不同的内容</p>
<p>在安装react中安装路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-router-dom</span><br></pre></td></tr></table></figure>
<p>进入APP.js，看到大的组件中只显示header，我们希望访问首页时不仅显示header，而且还显示首页。访问详情页时把详情页给显示出来。</p>
<p>首先从react-router-dom中引入BrowserHistory、Router。注意Proveder中只能有一个元素，所以它里面的内容需要用一个div包起来，对BrowserRouter也是只能包含一个要素。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter, Route &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'./common/header/index.js'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store/index.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    	&lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    		&lt;div&gt;</span><br><span class="line">	      		&lt;Header /&gt;</span><br><span class="line">	      		&lt;BrowserRouter&gt;</span><br><span class="line">	      			&lt;div&gt;</span><br><span class="line">		      			&lt;Route path=<span class="string">'/'</span> render=&#123;()=&gt;<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>home<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">		      			&lt;Route path=<span class="string">'/detail'</span> render=&#123;()=&gt;<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>detail<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">	      			&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">	      		&lt;/</span>BrowserRouter&gt;</span><br><span class="line">      		&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      	&lt;/</span>Provider&gt;</span><br><span class="line"></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>这时当我们访问<a href="http://localhost:3000和http://localhost:3000/detail时回出现home和homedetail。这时因为当访问http://localhost:3000时/也能匹配上/detail。如果我们访问http://localhost:3000/detail只想看到detail不想看到home怎么办？很简单，只需要加一个exact就可以了。" target="_blank" rel="noopener">http://localhost:3000和http://localhost:3000/detail时回出现home和homedetail。这时因为当访问http://localhost:3000时/也能匹配上/detail。如果我们访问http://localhost:3000/detail只想看到detail不想看到home怎么办？很简单，只需要加一个exact就可以了。</a></p>
<p>表示只有路径和指定的路径完完全全相等的时候才显示后面的内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">'/'</span> exact render=&#123;()=&gt;<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>home<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">&lt;Route path=<span class="string">'/detail'</span> exact render=&#123;()=&gt;<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>detail<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="1-2-拆分首页"><a href="#1-2-拆分首页" class="headerlink" title="1.2 拆分首页"></a>1.2 拆分首页</h4><p>首先在src目录下创建一个pages的文件夹，表示有多少个页面，然后在pages里面创建两个文件夹分别叫做home和detail。</p>
<p>在home文件夹下创建一个index.js的文件，这时react组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;Home&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">		);</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">export default Home;</span></span><br></pre></td></tr></table></figure>
<p>同理在detail文件夹下也创建一个index.js的文件。</p>
<p>然后在App.js文件中引入这两个文件，并在Route标签中引入这两个组件。在标签中引入组件使用compinent</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./pages/home'</span>;</span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">'./pages/detail'</span>;</span><br><span class="line">...</span><br><span class="line">&lt;Route path=<span class="string">'/'</span> exact component=&#123;Home&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">&lt;Route path=<span class="string">'/detail'</span> exact component=&#123;Detail&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>然后在home目录下创建一个style.js的文件，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HomeWrapper=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	width:960px;</span></span><br><span class="line"><span class="string">	margin:0, auto;</span></span><br><span class="line"><span class="string">	height:300px;</span></span><br><span class="line"><span class="string">	background:red;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>在<code>home/index.js</code>中引入HomeWrapper组件即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> &#123; HomeWrapper &#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;HomeWrapper&gt;<span class="xml"><span class="tag">&lt;/<span class="name">HomeWrapper</span>&gt;</span></span></span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在style.js中创建HomeLeft和HomeRight，并在home/index.js中引用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HomeWrapper=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	overflow:hidden;</span></span><br><span class="line"><span class="string">	width:960px;</span></span><br><span class="line"><span class="string">	margin:0, auto;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HomeLeft=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float:left;</span></span><br><span class="line"><span class="string">	margin-left:15px;</span></span><br><span class="line"><span class="string">	padding-top:30px;</span></span><br><span class="line"><span class="string">	width:625px;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HomeRight=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	width:240px;</span></span><br><span class="line"><span class="string">	float:right;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HomeWrapper , HomeLeft, HomeRight&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;HomeWrapper&gt;</span><br><span class="line">				&lt;HomeLeft&gt;left&lt;<span class="regexp">/HomeLeft&gt;</span></span><br><span class="line"><span class="regexp">				&lt;HomeRight&gt;right&lt;/</span>HomeRight&gt;</span><br><span class="line">			&lt;<span class="regexp">/HomeWrapper&gt;</span></span><br><span class="line"><span class="regexp">		);</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Home;</span></span><br></pre></td></tr></table></figure>
<p>如何在left中引入banner图呢？可以在HomeLeft中引入img标签并且在<code>home/style.js</code>文件中添加样式，这样图片就正常显示了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;HomeLeft&gt;</span><br><span class="line">	&lt;img className=<span class="string">'banner-img'</span> src=<span class="string">"//upload.jianshu.io/admin_banners/web_images/4516/cd9298634ca88ca71fc12752acf47917967a5d31.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/1250/h/540"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/HomeLeft&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HomeLeft=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float:left;</span></span><br><span class="line"><span class="string">	margin-left:15px;</span></span><br><span class="line"><span class="string">	padding-top:30px;</span></span><br><span class="line"><span class="string">	width:625px;</span></span><br><span class="line"><span class="string">	.banner-img &#123;</span></span><br><span class="line"><span class="string">		width:625px;</span></span><br><span class="line"><span class="string">		height:270px;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-划分首页组件"><a href="#1-3-划分首页组件" class="headerlink" title="1.3 划分首页组件"></a>1.3 划分首页组件</h4><p>可以把首页内容划分成几个组件</p>
<p>在home文件夹下创建一个名为components的文件夹，在里面创建Recommend.js、List.js、Writer.js、Topic.js的文件。</p>
<h6 id="1-3-1-Topic的编程"><a href="#1-3-1-Topic的编程" class="headerlink" title="1.3.1 Topic的编程"></a>1.3.1 Topic的编程</h6><p>由于我们首页的几个组件过于简单，如果给每一个小组件都设计一个style就显得过于设计。所以统一给它们上一层目录的style</p>
<p>进入到Topic.js文件，使用TopicWrapper标签，并且在<code>home/style.js</code>文件中创建该样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TopicWrapper , TopicItem&#125; <span class="keyword">from</span> <span class="string">'../style'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Topic</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;TopicWrapper&gt;</span><br><span class="line">				&lt;TopicItem&gt;</span><br><span class="line">					&lt;img className=<span class="string">'topic-pic'</span> src=<span class="string">"//upload.jianshu.io/collections/images/283250/%E6%BC%AB%E7%94%BB%E4%B8%93%E9%A2%98.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"</span> /&gt;</span><br><span class="line">					手绘手绘</span><br><span class="line">				&lt;<span class="regexp">/TopicItem&gt;</span></span><br><span class="line"><span class="regexp">			&lt;/</span>TopicWrapper&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Topic;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> TopicWrapper=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	overflow:hidden;</span></span><br><span class="line"><span class="string">	padding: 20px 0 10px 0;</span></span><br><span class="line"><span class="string">	margin-left:-18px;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> TopicItem=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float:left;</span></span><br><span class="line"><span class="string">	height:32px;</span></span><br><span class="line"><span class="string">	line-height:32px;</span></span><br><span class="line"><span class="string">	padding-right:10px;</span></span><br><span class="line"><span class="string">	margin-bottom:18px;</span></span><br><span class="line"><span class="string">	margin-left:18px;</span></span><br><span class="line"><span class="string">	background:#f7f7f7;</span></span><br><span class="line"><span class="string">	font-size:14px;</span></span><br><span class="line"><span class="string">	color:#000;</span></span><br><span class="line"><span class="string">	border:1px solid #dcdcdc;</span></span><br><span class="line"><span class="string">	border-radius:4px;</span></span><br><span class="line"><span class="string">	.topic-pic &#123;</span></span><br><span class="line"><span class="string">		display:block;</span></span><br><span class="line"><span class="string">		margin-right:10px;</span></span><br><span class="line"><span class="string">		float:left;</span></span><br><span class="line"><span class="string">		width:32px;</span></span><br><span class="line"><span class="string">		height:32px;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-2-创建reducer"><a href="#1-3-2-创建reducer" class="headerlink" title="1.3.2 创建reducer"></a>1.3.2 创建reducer</h6><p>在<code>src/store/reducer</code>中大的reducer将若干个小的reducer组合一起。所以home页面应该由自己的reducer管理自己的数据。</p>
<p>在home目录下创建一个store的文件夹，并且在里面创建reducer.js文件，参照header下的reducer</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们的topicItem肯定是一个数组来管理的，所以reducer中就需要定义一个数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	topicList:[</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">title</span>:<span class="string">'手绘'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/283250/%E6%BC%AB%E7%94%BB%E4%B8%93%E9%A2%98.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">title</span>:<span class="string">'读书'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/4/sy_20091020135145113016.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">3</span>,<span class="attr">title</span>:<span class="string">'自然科普'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/76/12.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">4</span>,<span class="attr">title</span>:<span class="string">'故事'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/95/1.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">5</span>,<span class="attr">title</span>:<span class="string">'简书电影'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/21/20120316041115481.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">6</span>,<span class="attr">title</span>:<span class="string">'摄影'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/83/1.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">7</span>,<span class="attr">title</span>:<span class="string">'旅行 在路上'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload.jianshu.io/collections/images/13/%E5%95%8A.png?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64'</span>&#125;,</span><br><span class="line">		</span><br><span class="line">	]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并且在<code>src/store/reducer</code>中引入该ruducer,同理我们不想让外部直接饮用该reducer，需要在pages/home/store下创建index.js，来引入和导出该reducer</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;combineReducers&#125; <span class="keyword">from</span> <span class="string">'redux-immutable'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reducer <span class="keyword">as</span> headerReducer &#125; <span class="keyword">from</span> <span class="string">'../common/header/store'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reducer <span class="keyword">as</span> homeReducer &#125; <span class="keyword">from</span> <span class="string">'../pages/home/store'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">	header:headerReducer,</span><br><span class="line">	home:homeReducer</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pages/home/store下创建index.js</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; reducer &#125;;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-3-连接Topic和reducer"><a href="#1-3-3-连接Topic和reducer" class="headerlink" title="1.3.3 连接Topic和reducer"></a>1.3.3 连接Topic和reducer</h6><p>这时候就需要让Topic和store做连接了，怎么连接?在Topic.js中引入react-redux的connect即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TopicWrapper , TopicItem&#125; <span class="keyword">from</span> <span class="string">'../style'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Topic</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;TopicWrapper&gt;</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">this</span>.props.list.map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">						<span class="keyword">return</span> (</span><br><span class="line">							&lt;TopicItem key=&#123;item.get(<span class="string">'id'</span>)&#125;&gt;</span><br><span class="line">								&lt;img </span><br><span class="line">									className=<span class="string">'topic-pic'</span></span><br><span class="line">									src=&#123;item.get(<span class="string">'imgUrl'</span>)&#125; /&gt;</span><br><span class="line">									&#123;item.get(<span class="string">'title'</span>)&#125;</span><br><span class="line">							&lt;<span class="regexp">/TopicItem&gt;</span></span><br><span class="line"><span class="regexp">						);</span></span><br><span class="line"><span class="regexp">					&#125;)</span></span><br><span class="line"><span class="regexp">				&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">			&lt;/</span>TopicWrapper&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		list:state.get(<span class="string">'home'</span>).get(<span class="string">'topicList'</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,<span class="literal">null</span>)(Topic);</span><br></pre></td></tr></table></figure>
<h6 id="1-3-4-文章列表"><a href="#1-3-4-文章列表" class="headerlink" title="1.3.4 文章列表"></a>1.3.4 文章列表</h6><p>和Topic没什么区别，只是再走一遍流程，不再重复</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ListItem , ListInfo&#125; <span class="keyword">from</span> <span class="string">'../style'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">List</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">this</span>.props.list.map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">						<span class="keyword">return</span> (</span><br><span class="line">							&lt;ListItem key=&#123;item.get(<span class="string">'id'</span>)&#125;&gt;</span><br><span class="line">								&lt;img className=<span class="string">'list-pic'</span> src=&#123;item.get(<span class="string">'imgUrl'</span>)&#125; /&gt;</span><br><span class="line">								&lt;ListInfo&gt;</span><br><span class="line">									&lt;h3 className=<span class="string">'title'</span>&gt;&#123;item.get(<span class="string">'title'</span>)&#125;&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">									&lt;p className='desc'&gt;&#123;item.get('desc')&#125;&lt;/</span>p&gt;</span><br><span class="line">								&lt;<span class="regexp">/ListInfo&gt;</span></span><br><span class="line"><span class="regexp">							&lt;/</span>ListItem&gt;</span><br><span class="line">						)</span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;</span><br><span class="line">			&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">		);</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps=(state)=&gt;&#123;</span></span><br><span class="line"><span class="regexp">	return &#123;</span></span><br><span class="line"><span class="regexp">		list:state.get('home').get('articleList')</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps,null)(List);</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	...</span><br><span class="line">	articleList:[</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">title</span>:<span class="string">'全城百姓举牌欢迎，不料被将军看到牌后一字，悄悄对手下说：屠城'</span>,<span class="attr">desc</span>:<span class="string">'文/历史大农 简短一句话，剖析一段史。让“历史大农”用简洁的语言，为您讲述一段历史辛密。 军事家、战略家——“明太祖”朱元璋 明太祖朱元璋，作为...'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload-images.jianshu.io/upload_images/11919269-0a22c403002a1371?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">title</span>:<span class="string">'每天最重要的2小时：让自己成为高效的人'</span>,<span class="attr">desc</span>:<span class="string">'工作、加班、学习、运动、陪伴家人，当然还有娱乐，我们每天都被时间的脚步追赶着，每一刻都是忙碌的，而忙碌永远没有劲头。 当下，时间俨然已经成为最宝...'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload-images.jianshu.io/upload_images/10746568-26f4733a3ad87c62.png?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">3</span>,<span class="attr">title</span>:<span class="string">'是可忍，孰不可忍！｜140字微小说'</span>,<span class="attr">desc</span>:<span class="string">'多少个夜晚 你真心相伴 不离不弃 多少个夜晚 你亲昵纠缠 不眠不休 你已经在我心底留下了深深的印迹 我想你 魂牵梦萦 如今 我终于将你捧在了手心...'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload-images.jianshu.io/upload_images/12309992-4e21d79f92914f76.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240'</span>&#125;,</span><br><span class="line">		&#123;<span class="attr">id</span>:<span class="number">4</span>,<span class="attr">title</span>:<span class="string">'还在纠结秋冬穿什么？8套秋冬搭配轻松搞定'</span>,<span class="attr">desc</span>:<span class="string">'第一套： 杏色的针织荷叶边的垂感中长裙搭配同色系的折线宽松毛衣，视觉上看着很舒服，比较优雅的颜色搭配，适合皮肤中性偏白的女生，很显气质，同时竖条...'</span>,<span class="attr">imgUrl</span>:<span class="string">'//upload-images.jianshu.io/upload_images/12861608-90ae71664fbb9d99?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240'</span>&#125;,</span><br><span class="line"></span><br><span class="line">	]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>可是这时候控制台会报一些警告，这时由于使用img标签都要填一个alt属性，只需要给img添加一个alt标签即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alt=<span class="string">''</span></span><br></pre></td></tr></table></figure>
<h6 id="1-3-5-组件向样式传递属性"><a href="#1-3-5-组件向样式传递属性" class="headerlink" title="1.3.5 组件向样式传递属性"></a>1.3.5 组件向样式传递属性</h6><p>有时候我们希望在组件中定义一个属性，然后在style中使用，怎么办呢？</p>
<p>我们可以在组件RecommendItem中定义一个imgUrl的属性，然后在style中通过props来传递</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Recommend.js</span></span><br><span class="line">&lt;RecommendItem imgUrl=<span class="string">"http://cdn2.jianshu.io/assets/web/banner-s-3-7123fd94750759acf7eca05b871e9d17.png"</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/RecommendItem&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//style.js</span></span><br><span class="line"><span class="comment">//这时原始的</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RecommendItem=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	width:280px;</span></span><br><span class="line"><span class="string">	height:50px;</span></span><br><span class="line"><span class="string">	margin-bottom:6px;</span></span><br><span class="line"><span class="string">	background:url(http://cdn2.jianshu.io/assets/web/banner-s-3-7123fd94750759acf7eca05b871e9d17.png);</span></span><br><span class="line"><span class="string">	background-size:contain;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这时最新的</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RecommendItem=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	width:280px;</span></span><br><span class="line"><span class="string">	height:50px;</span></span><br><span class="line"><span class="string">	margin-bottom:6px;</span></span><br><span class="line"><span class="string">	background:url(<span class="subst">$&#123;(props)=&gt;props.imgUrl&#125;</span>);</span></span><br><span class="line"><span class="string">	background-size:contain;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-6-通过ajax获取数据"><a href="#1-3-6-通过ajax获取数据" class="headerlink" title="1.3.6 通过ajax获取数据"></a>1.3.6 通过ajax获取数据</h6><p>实际上我们hone页面的数据是从后台获取的，所以不能自reducer中把数据写死。</p>
<p>首先我们在<code>public/api/</code>下建立一个home.json文件，并写入home的数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="string">"data"</span>: &#123;</span><br><span class="line">		<span class="string">"topicList"</span>: [&#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">1</span>,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"社会热点"</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"//upload.jianshu.io/collections/images/261938/man-hands-reading-boy-large.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">2</span>,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"手手绘"</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"//upload.jianshu.io/collections/images/21/20120316041115481.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"</span></span><br><span class="line">		&#125;],</span><br><span class="line">		<span class="string">"articleList"</span>: [&#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">1</span>,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"胡歌12年后首谈车祸"</span>,</span><br><span class="line">			<span class="string">"desc"</span>: <span class="string">"文/麦大人 01 胡歌又刷屏了。 近日他上了《朗读者》，而这一期的主题是“生命”，他用磁性的嗓音，朗读了一段《哈姆雷特》中的经典独白，相当震撼：..."</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"//upload-images.jianshu.io/upload_images/2259045-2986b9be86b01f63?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240"</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">2</span>,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"胡歌12年后首谈车祸：既然活下来了，就不能白白活着"</span>,</span><br><span class="line">			<span class="string">"desc"</span>: <span class="string">"文/麦大人 01 胡歌又刷屏了。 近日他上了《朗读者》，而这一期的主题是“生命”，他用磁性的嗓音，朗读了一段《哈姆雷特》中的经典独白，相当震撼：..."</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"//upload-images.jianshu.io/upload_images/2259045-2986b9be86b01f63?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240"</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">3</span>,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"胡歌12年后首谈车祸：既然活下来了，就不能白白活着"</span>,</span><br><span class="line">			<span class="string">"desc"</span>: <span class="string">"文/麦大人 01 胡歌又刷屏了。 近日他上了《朗读者》，而这一期的主题是“生命”，他用磁性的嗓音，朗读了一段《哈姆雷特》中的经典独白，相当震撼：..."</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"//upload-images.jianshu.io/upload_images/2259045-2986b9be86b01f63?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240"</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">4</span>,</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"胡歌12年后首谈车祸：既然活下来了，就不能白白活着"</span>,</span><br><span class="line">			<span class="string">"desc"</span>: <span class="string">"文/麦大人 01 胡歌又刷屏了。 近日他上了《朗读者》，而这一期的主题是“生命”，他用磁性的嗓音，朗读了一段《哈姆雷特》中的经典独白，相当震撼：..."</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"//upload-images.jianshu.io/upload_images/2259045-2986b9be86b01f63?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240"</span></span><br><span class="line">		&#125;],</span><br><span class="line">		<span class="string">"recommendList"</span>: [&#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">1</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"http://cdn2.jianshu.io/assets/web/banner-s-3-7123fd94750759acf7eca05b871e9d17.png"</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="string">"id"</span>: <span class="number">2</span>,</span><br><span class="line">			<span class="string">"imgUrl"</span>: <span class="string">"http://cdn2.jianshu.io/assets/web/banner-s-5-4ba25cf5041931a0ed2062828b4064cb.png"</span></span><br><span class="line">		&#125;]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后将home/store/reducer中的defaultState各个数据设置为空</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	topicList:[],</span><br><span class="line">	articleList:[],</span><br><span class="line">	recommendList:[]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后在home/index.js中添加生命周期函数componentDidMound方法中发送ajax请求。表示当页面挂载完毕时发送请求；将获取的数据传给store，通过actioin来完成；这时候需要dispatch来发送，可是如何将home/index.js于store建立连接呢，使用connect</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mport axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line">...</span><br><span class="line">componentDidMount()&#123;</span><br><span class="line">		axios.get(<span class="string">'api/home.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">			<span class="keyword">const</span> result=res.data.data;</span><br><span class="line">			<span class="keyword">const</span> action=&#123;</span><br><span class="line">				type:<span class="string">'change_home_data'</span>,</span><br><span class="line">				topicList:result.topicList,</span><br><span class="line">				articleList:result.articleList,</span><br><span class="line">				recommendList:result.recommendList,</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">this</span>.props.changeHomeData(action);</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">(dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		changeHomeData(action)&#123;</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="literal">null</span>,mapDispatchToProps)(Home);</span><br></pre></td></tr></table></figure>
<p>这样就可以在/page/home/store/reducer.js中处理该action 了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">'change_home_data'</span>:</span><br><span class="line">			<span class="keyword">return</span> state.merge(&#123;</span><br><span class="line">				topicList:fromJS(action.topicList),</span><br><span class="line">				articleList:fromJS(action.articleList),</span><br><span class="line">				recommendList:fromJS(action.recommendList)</span><br><span class="line">			&#125;);</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-7-异步代码的拆分"><a href="#1-3-7-异步代码的拆分" class="headerlink" title="1.3.7 异步代码的拆分"></a>1.3.7 异步代码的拆分</h6><p>home/index.js应该是一个UI组件，它不应该有过多的逻辑处理，而componentDidMount中ui组件发ajax请求然后更新store，更新UI。这样不合适，可以将ajax请求直接放在changeHomeData,直接对返回结果进行派发，这样就将ui组件中逻辑剔除了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">		<span class="keyword">this</span>.props.changeHomeData();</span><br><span class="line">	&#125;</span><br><span class="line">。。。</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">(dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		changeHomeData(action)&#123;</span><br><span class="line">			axios.get(<span class="string">'api/home.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">				<span class="keyword">const</span> result=res.data.data;</span><br><span class="line">				<span class="keyword">const</span> action=&#123;</span><br><span class="line">					type:<span class="string">'change_home_data'</span>,</span><br><span class="line">					topicList:result.topicList,</span><br><span class="line">					articleList:result.articleList,</span><br><span class="line">					recommendList:result.recommendList,</span><br><span class="line">				&#125;</span><br><span class="line">				dispatch(action);</span><br><span class="line">			&#125;)</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>其实异步操作，这么放也不合理。我们可以使用redux-thunk，将它放在action中去管理</p>
<p>我们在home/store目录下创建一个actionCreators.js 的文件,并且在store/index.js中引入并输入，然后在home/index.js中修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//actionCreator.js</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getHomeInfo=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">		axios.get(<span class="string">'api/home.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">			<span class="keyword">const</span> result=res.data.data;</span><br><span class="line">			<span class="keyword">const</span> action=&#123;</span><br><span class="line">				type:<span class="string">'change_home_data'</span>,</span><br><span class="line">				topicList:result.topicList,</span><br><span class="line">				articleList:result.articleList,</span><br><span class="line">				recommendList:result.recommendList,</span><br><span class="line">			&#125;</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//home/store/index.js</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionCreators <span class="keyword">from</span> <span class="string">'./actionCreators.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; reducer , actionCreators&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//home/index.js</span></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">(dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		changeHomeData()&#123;</span><br><span class="line">			<span class="keyword">const</span> action=actionCreators.getHomeInfo();</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样我们就把home/index.js中的逻辑移动到actionCreators中去了，这里的getHomeInfo还可以进一步优化,将action提出来</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> changeHomeData=<span class="function">(<span class="params">result</span>)=&gt;</span>(&#123;</span><br><span class="line">	type:<span class="string">'change_home_data'</span>,</span><br><span class="line">	topicList:result.topicList,</span><br><span class="line">	articleList:result.articleList,</span><br><span class="line">	recommendList:result.recommendList,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getHomeInfo=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">		axios.get(<span class="string">'api/home.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">			<span class="keyword">const</span> result=res.data.data;</span><br><span class="line">			dispatch(changeHomeData(result));</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样可以创建一个constants.js文件，保存type常量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_HOME_DATA=<span class="string">'home/CHANGE_HOME_DATA'</span>;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-8-创建阅读更多"><a href="#1-3-8-创建阅读更多" class="headerlink" title="1.3.8 创建阅读更多"></a>1.3.8 创建阅读更多</h6><p>当将列表滑动到最下面时，会出现阅读更多的按钮，点击该按钮会在列表中加载更多内容。它既可以放在列表之内，也可以放在列表之外。我们将它放在列表之内</p>
<p>我们在List组件中添加一个LoadMore的组件，并在style中创建该样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;div&gt;</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">this</span>.props.list.map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">						<span class="keyword">return</span> (</span><br><span class="line">							&lt;ListItem key=&#123;item.get(<span class="string">'id'</span>)&#125;&gt;</span><br><span class="line">								&lt;img className=<span class="string">'list-pic'</span> src=&#123;item.get(<span class="string">'imgUrl'</span>)&#125; alt=<span class="string">''</span>/&gt;</span><br><span class="line">								&lt;ListInfo&gt;</span><br><span class="line">									&lt;h3 className=<span class="string">'title'</span>&gt;&#123;item.get(<span class="string">'title'</span>)&#125;&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">									&lt;p className='desc'&gt;&#123;item.get('desc')&#125;&lt;/</span>p&gt;</span><br><span class="line">								&lt;<span class="regexp">/ListInfo&gt;</span></span><br><span class="line"><span class="regexp">							&lt;/</span>ListItem&gt;</span><br><span class="line">						)</span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;</span><br><span class="line">				&lt;LoadMore&gt;更多内容&lt;<span class="regexp">/LoadMore&gt;</span></span><br><span class="line"><span class="regexp">			&lt;/</span>div&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//style</span></span><br><span class="line">export <span class="keyword">const</span> LoadMore=styled.div`</span><br><span class="line">    width: <span class="number">100</span>%;</span><br><span class="line">    height: <span class="number">40</span>px;</span><br><span class="line">    line-height:<span class="number">40</span>px;</span><br><span class="line">    margin: <span class="number">30</span>px <span class="number">0</span>;</span><br><span class="line">    text-align: center;</span><br><span class="line">    font-size: <span class="number">15</span>px;</span><br><span class="line">    border-radius: <span class="number">20</span>px;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background-color: #a5a5a5;</span><br><span class="line">    display: block;</span><br><span class="line">    cursor:pointer;</span><br><span class="line">`;</span><br></pre></td></tr></table></figure>
<p>然后给LoadMore添加点击事件,这时只需要创建mapDispatchToProps即可，创建action等不再赘述</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		getMoreList()&#123;</span><br><span class="line">			dispatch(actionCreators.getMoreList());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,mapDispatchToProps)(List);</span><br></pre></td></tr></table></figure>
<p>真实情况其实需需要翻页，只需要给reducer中添加一个articlePage的字段即可，每次getMoreList时，将该字段加1即可，不再详述。</p>
<h4 id="1-4-编写返回顶部"><a href="#1-4-编写返回顶部" class="headerlink" title="1.4 编写返回顶部"></a>1.4 编写返回顶部</h4><p>这代码量很小，单独写一个组件不合适。可以将它写在home的index.js中.</p>
<p>只需要在样式中定义该组件的样式；</p>
<p>然后添加点击事件，这里的点击事件和reducer关联不大，只是返回顶部</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">handlerScrollTop()&#123;</span><br><span class="line">		<span class="built_in">window</span>.scrollTo(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">...</span><br><span class="line">&lt;BackTop onClick=&#123;<span class="keyword">this</span>.handlerScrollTop&#125;&gt;回到顶部&lt;<span class="regexp">/BackTop&gt;</span></span><br></pre></td></tr></table></figure>
<p>而官网的效果时，当页面往下拖的时候才会出现，而首屏时是不会出现的，这时需要通过变量来保存了。在reducer中添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	topicList:[],</span><br><span class="line">	articleList:[],</span><br><span class="line">	recommendList:[],</span><br><span class="line">	articlePage:<span class="number">1</span>,</span><br><span class="line">	showScroll:<span class="literal">false</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后打开home下index.js，在里面拿showScroll数据，注意当组件移除时需要将该监听移出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="keyword">this</span>.props.showScroll?</span><br><span class="line">					&lt;BackTop onClick=&#123;<span class="keyword">this</span>.handlerScrollTop&#125;&gt;回到顶部&lt;<span class="regexp">/BackTop&gt;:</span></span><br><span class="line"><span class="regexp">				null&#125;</span></span><br><span class="line"><span class="regexp">...</span></span><br><span class="line"><span class="regexp">	componentDidMount()&#123;</span></span><br><span class="line"><span class="regexp">		this.props.changeHomeData();</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">		this.bindEvents();</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	componentWillUnmount()&#123;</span></span><br><span class="line"><span class="regexp">		this.removeEvents();</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">	bindEvents()&#123;</span></span><br><span class="line"><span class="regexp">		window.addEventListener("scroll",this.props.changeScrollShow);</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">	removeEvents()&#123;</span></span><br><span class="line"><span class="regexp">		window.removeEventListener("scroll",this.props.changeScrollShow);</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br></pre></td></tr></table></figure>
<p>这个时候，它不显示了。</p>
<p>这时就需要监听滚动方法了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">	<span class="keyword">this</span>.props.changeHomeData();</span><br><span class="line">	<span class="keyword">this</span>.bindEvents();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bindEvents()&#123;</span><br><span class="line">	<span class="built_in">window</span>.addEventListener(<span class="string">"scroll"</span>,<span class="keyword">this</span>.props.changeScrollShow);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">(dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		changeHomeData()&#123;</span><br><span class="line">			<span class="keyword">const</span> action=actionCreators.getHomeInfo();</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;,</span><br><span class="line">		changeScrollShow(e)&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">document</span>.documentElement.scrollTop&gt;<span class="number">100</span>)&#123;</span><br><span class="line">				dispatch(actionCreators.toggleTopShow(<span class="literal">true</span>));</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				dispatch(actionCreators.toggleTopShow(<span class="literal">false</span>));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后就可以通过reducer来操作了.</p>
<p>此时reducer中switch代码好像有点多，可以将每个case中返回的内容提取出来</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> changeHomeData=<span class="function">(<span class="params">state,action</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> state.merge(&#123;</span><br><span class="line">		topicList:fromJS(action.topicList),</span><br><span class="line">		articleList:fromJS(action.articleList),</span><br><span class="line">		recommendList:fromJS(action.recommendList)</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> addArticleList=<span class="function">(<span class="params">state,action</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> state.merge(&#123;</span><br><span class="line">		<span class="string">'articleList'</span>:state.get(<span class="string">'articleList'</span>).concat(action.list),</span><br><span class="line">		<span class="string">'articlePage'</span>:action.nextPage</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line">		<span class="keyword">case</span> constants.CHANGE_HOME_DATA:</span><br><span class="line">			<span class="keyword">return</span> changeHomeData(state,action);</span><br><span class="line">		<span class="keyword">case</span> constants.ADD_ARTICLE_LIST:</span><br><span class="line">			<span class="keyword">return</span> addArticleList(state,action);</span><br><span class="line">		<span class="keyword">case</span> constants.TOGGLE_SCROLL_SHOW:</span><br><span class="line">			<span class="keyword">return</span> state.set(<span class="string">'showScroll'</span>,action.show)</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-5-路由跳转"><a href="#1-5-路由跳转" class="headerlink" title="1.5 路由跳转"></a>1.5 路由跳转</h4><p>由于页面很多时候并且不是所有的操作都要出发render。这时可以使用shouldComponentUpdate，来闭关频繁触发render，但是如果所有的子组件中都重写这个方法就太麻烦了，react内置了一个新的组件类型，叫做PureComponent，这个组件内部实现了shouldComponentUpdate，就不需要我们重复重写这个方法了。我们只要对List、Topic、Writer、Recommend组件都即成PureComponent就可以了。</p>
<p><strong>注意：</strong>这里之所以可以使用PureComponent，是因为这个项目中我们使用了框架immutable.js，PureComponent和immutable数据才能无缝对接，如果没使用immutable可能就会出现问题。所以当使用PureComponent时建议使用immutable来管理数据</p>
<p>接下来来实现首页跳转到详情页</p>
<p>可以通过添加a标签，来实现页面的跳转，这时每跳转一次都会加载一次html，这就比较耗性能。这里我们要使用react-router，因为它可以实现单页面跳转，但也面跳转是指在页面跳转过程中只会加载一次html。可以使用react-router-dom中的Link来代替a标签</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line">&lt;a key=&#123;index&#125; href=<span class="string">'/detail'</span>&gt;</span><br><span class="line">	&lt;ListItem&gt;</span><br><span class="line">	&lt;<span class="regexp">/ListItem&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>a&gt;</span><br><span class="line">--------</span><br><span class="line">&lt;Link key=&#123;index&#125; to=<span class="string">'/detail'</span>&gt;</span><br><span class="line">	&lt;ListItem&gt;</span><br><span class="line">	&lt;<span class="regexp">/ListItem&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Link&gt;</span><br></pre></td></tr></table></figure>
<p>同理我们对头部组件的logo组件也要使用Link,注意使用Link的组件必须在Router的内部，所以我们需要在App.js中，将Header组件放在Router的内部</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Link to=<span class="string">'/'</span>&gt;</span><br><span class="line">	&lt;Logo&gt;</span><br><span class="line">&lt;<span class="regexp">/Link&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    	&lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      		&lt;BrowserRouter&gt;</span><br><span class="line">	      			&lt;div&gt;</span><br><span class="line">                &lt;Header /&gt;</span><br><span class="line">		      			&lt;Route path=<span class="string">'/'</span> exact component=&#123;Home&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">		      			&lt;Route path=<span class="string">'/detail'</span> exact component=&#123;Detail&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">	      			&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">	      		&lt;/</span>BrowserRouter&gt;</span><br><span class="line">      	&lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/11/05/React实战3/" data-id="ck4jzi8qe003frflrmzzxx5jx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-react实战2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/18/react实战2/" class="article-date">
  <time datetime="2018-10-18T14:21:56.000Z" itemprop="datePublished">2018-10-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/18/react实战2/">react实战2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、修改搜索框"><a href="#一、修改搜索框" class="headerlink" title="一、修改搜索框"></a>一、修改搜索框</h3><h4 id="1-1、修改搜索框文字颜色和间距"><a href="#1-1、修改搜索框文字颜色和间距" class="headerlink" title="1.1、修改搜索框文字颜色和间距"></a>1.1、修改搜索框文字颜色和间距</h4><p>当在搜索框填写的内容过长时，间距就不够了，并且输入的文字颜色有点深。我们首先调整一下文字颜色，在<code>common/header/style.js</code>中修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> NavSearch=styled.input.attrs(&#123;</span><br><span class="line">	placeholder:<span class="string">'搜索'</span></span><br><span class="line">&#125;)<span class="string">`</span></span><br><span class="line"><span class="string">	width:160px;</span></span><br><span class="line"><span class="string">	height:38px;</span></span><br><span class="line"><span class="string">		padding:0 30px 0 20px;</span></span><br><span class="line"><span class="string">	box-sizing:border-box;</span></span><br><span class="line"><span class="string">	border:none;</span></span><br><span class="line"><span class="string">	outline:none;</span></span><br><span class="line"><span class="string">	margin-top:9px;</span></span><br><span class="line"><span class="string">	margin-left:20px;</span></span><br><span class="line"><span class="string">	border-radius:19px;</span></span><br><span class="line"><span class="string">	background:#eee;</span></span><br><span class="line"><span class="string">	font-size:14px;</span></span><br><span class="line"><span class="string">		color:#666;</span></span><br><span class="line"><span class="string">	&amp;::placeholder&#123;</span></span><br><span class="line"><span class="string">		color:#999;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-2、修改搜索框鼠标动画"><a href="#1-2、修改搜索框鼠标动画" class="headerlink" title="1.2、修改搜索框鼠标动画"></a>1.2、修改搜索框鼠标动画</h4><p>下面我们来添加一下鼠标的移入移出效果，搜过框的宽度锁着鼠标的变化会自动的变化。当聚焦的时候，搜索框就会变长。</p>
<p>react不建议我们直接操作dom，所以我们可以通过定义数据来实现，首先我们在<code>common/header/index.js</code>中添加constructor函数，并在里面定义state；并且在NavSearch标签中添加className={this.state.focused},</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state=&#123;</span><br><span class="line">        focused:<span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&lt;SearchWrapper&gt;</span><br><span class="line">	&lt;NavSearch className=&#123;<span class="keyword">this</span>.state.focused ? <span class="string">'focused'</span>:<span class="string">''</span>&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">NavSearch</span>&gt;</span></span></span><br><span class="line">	&lt;i className='iconfont'&gt;&amp;#xe6dd;&lt;/i&gt;</span><br><span class="line">&lt;<span class="regexp">/SearchWrapper&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后我们在<code>common/header/style.js</code>中添加focused的样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> NavSearch=styled.input.attrs(&#123;</span><br><span class="line">	placeholder:<span class="string">'搜索'</span></span><br><span class="line">&#125;)<span class="string">`</span></span><br><span class="line"><span class="string">	width:160px;</span></span><br><span class="line"><span class="string">	height:38px;</span></span><br><span class="line"><span class="string">	padding:0 35px 0 20px;</span></span><br><span class="line"><span class="string">	box-sizing:border-box;</span></span><br><span class="line"><span class="string">	border:none;</span></span><br><span class="line"><span class="string">	outline:none;</span></span><br><span class="line"><span class="string">	margin-top:9px;</span></span><br><span class="line"><span class="string">	margin-left:20px;</span></span><br><span class="line"><span class="string">	border-radius:19px;</span></span><br><span class="line"><span class="string">	background:#eee;</span></span><br><span class="line"><span class="string">	font-size:14px;</span></span><br><span class="line"><span class="string">	color:#666;</span></span><br><span class="line"><span class="string">	&amp;::placeholder&#123;</span></span><br><span class="line"><span class="string">		color:#999;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">        &amp;.focused &#123;</span></span><br><span class="line"><span class="string">            width:200px;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>并且注意当搜索框变长时，右边搜索按钮背景色也发生了变化，此时需要修改<code>common/header/index.js</code>中的i标签中添加新的className，并且在<code>common/header/style.js</code>中SearchWrapper标签的样式中设置iconfont搜索按钮的背景颜色</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;SearchWrapper&gt;</span><br><span class="line">&lt;NavSearch className=&#123;<span class="keyword">this</span>.state.focused ? <span class="string">'focused'</span>:<span class="string">''</span>&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">NavSearch</span>&gt;</span></span></span><br><span class="line">&lt;i className='iconfont'&gt;&amp;#xe6dd;&lt;/i&gt;</span><br><span class="line">&lt;<span class="regexp">/SearchWrapper&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/改为</span></span><br><span class="line"><span class="regexp">&lt;SearchWrapper&gt;</span></span><br><span class="line"><span class="regexp">&lt;NavSearch className=&#123;this.state.focused ? 'focused':''&#125;&gt;&lt;/</span>NavSearch&gt;</span><br><span class="line">&lt;i className=&#123;this.state.focused ? 'focused iconfont':'iconfont'&#125;&gt;&amp;#xe6dd;&lt;/i&gt;</span><br><span class="line">&lt;<span class="regexp">/SearchWrapper&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchWrapper=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float:left;</span></span><br><span class="line"><span class="string">	position:relative;</span></span><br><span class="line"><span class="string">	.iconfont &#123;</span></span><br><span class="line"><span class="string">		position:absolute;</span></span><br><span class="line"><span class="string">		right:5px;</span></span><br><span class="line"><span class="string">		bottom:5px;</span></span><br><span class="line"><span class="string">		width:30px;</span></span><br><span class="line"><span class="string">		line-height:30px;</span></span><br><span class="line"><span class="string">		border-radius:15px;</span></span><br><span class="line"><span class="string">		text-align:center;</span></span><br><span class="line"><span class="string">        &amp;.focused&#123;</span></span><br><span class="line"><span class="string">			background:#777;</span></span><br><span class="line"><span class="string">			color: #fff;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="1-3、实现搜索框事件绑定"><a href="#1-3、实现搜索框事件绑定" class="headerlink" title="1.3、实现搜索框事件绑定"></a>1.3、实现搜索框事件绑定</h4><p>接下来实现，通过事件来实现长短切换，首先focused默认时false，然后在NavSearch标签中添加onFocus属性，在constructor实现对this的绑定，然后就可以添加handleInputFocus函数了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">	<span class="keyword">super</span>(props);</span><br><span class="line">	<span class="keyword">this</span>.state=&#123;</span><br><span class="line">		focused:<span class="literal">false</span>,</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">this</span>.handleInputFocus=<span class="keyword">this</span>.handleInputFocus.bind(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&lt;NavSearch </span><br><span class="line">	className=&#123;<span class="keyword">this</span>.state.focused ? <span class="string">'focused'</span>:<span class="string">''</span>&#125;</span><br><span class="line">	onFocus=&#123;<span class="keyword">this</span>.handleInputFocus&#125;&gt;</span><br><span class="line">&lt;<span class="regexp">/NavSearch&gt;</span></span><br><span class="line"><span class="regexp">...</span></span><br><span class="line"><span class="regexp">handleInputFocus()&#123;</span></span><br><span class="line"><span class="regexp">    this.setState(&#123;</span></span><br><span class="line"><span class="regexp">    	focused:true</span></span><br><span class="line"><span class="regexp">    &#125;);</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>这时就实现了当搜索框聚焦时，就会变长，并且搜索按钮背景色变暗。可以失焦时，却没有变短，这很好办，只需添加onBlur属性即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">constructor(props)&#123;</span><br><span class="line">	<span class="keyword">super</span>(props);</span><br><span class="line">	<span class="keyword">this</span>.state=&#123;</span><br><span class="line">		focused:<span class="keyword">false</span>,</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">this</span>.handleInputFocus=<span class="keyword">this</span>.handleInputFocus.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.handleInputBlur=<span class="keyword">this</span>.handleInputBlur.bind(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&lt;NavSearch </span><br><span class="line">	className=&#123;<span class="keyword">this</span>.state.focused ? <span class="string">'focused'</span>:<span class="string">''</span>&#125;</span><br><span class="line">	onFocus=&#123;<span class="keyword">this</span>.handleInputFocus&#125;</span><br><span class="line">	onBlur=&#123;<span class="keyword">this</span>.handleInputBlur&#125;&gt;</span><br><span class="line">&lt;/NavSearch&gt;</span><br><span class="line">...</span><br><span class="line">handleInputFocus()&#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    	focused:<span class="keyword">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">handleInputBlur()&#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    	focused:<span class="keyword">false</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时就实现了聚焦和失焦的效果，但是此时还没有动画的效果，下面添加动画。</p>
<h4 id="1-4、添加动画变长变短"><a href="#1-4、添加动画变长变短" class="headerlink" title="1.4、添加动画变长变短"></a>1.4、添加动画变长变短</h4><p>首先在控制台，进入jianshu项目，安装react-transition-group的插件，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-transition-group --save</span><br></pre></td></tr></table></figure>
<p>然后在<code>common/header/index.js</code>中引入CSSTransition，然后用CSSTransition将NavSearch包裹起来</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CSSTransition &#125; <span class="keyword">from</span> <span class="string">'react-transition-group'</span>;</span><br><span class="line">。。。</span><br><span class="line">&lt;CSSTransition</span><br><span class="line">	<span class="keyword">in</span>=&#123;<span class="keyword">this</span>.state.focused&#125; <span class="comment">//入场动画</span></span><br><span class="line">	timeout=&#123;<span class="number">200</span>&#125; <span class="comment">//动画时长</span></span><br><span class="line">	classNames=<span class="string">"slide"</span></span><br><span class="line">	&gt;</span><br><span class="line">    &lt;NavSearch </span><br><span class="line">        className=&#123;<span class="keyword">this</span>.state.focused ? <span class="string">'focused'</span>:<span class="string">''</span>&#125;</span><br><span class="line">        onFocus=&#123;<span class="keyword">this</span>.handleInputFocus&#125;</span><br><span class="line">        onBlur=&#123;<span class="keyword">this</span>.handleInputBlur&#125;&gt;</span><br><span class="line">    &lt;<span class="regexp">/NavSearch&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>CSSTransition&gt;</span><br></pre></td></tr></table></figure>
<p>此时就会在外层挂载几个样式，然后找到SearchWrapper标签的样式，在<code>common/header/style.js</code>中SearchWrapper标签的样式中设置slide-enter和slide-enter-active设置展开效果，通过slide-exit和slide-exit-active设置缩回效果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchWrapper=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float:left;</span></span><br><span class="line"><span class="string">	position:relative;</span></span><br><span class="line"><span class="string">    .slide-enter &#123;</span></span><br><span class="line"><span class="string">		width:160px;</span></span><br><span class="line"><span class="string">		transition:all .2s ease-out;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    .slide-enter-active &#123;</span></span><br><span class="line"><span class="string">		width:240px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">	.slide-exit &#123;</span></span><br><span class="line"><span class="string">		width:240px;</span></span><br><span class="line"><span class="string">		transition:all .2s ease-out;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    .slide-exit-active &#123;</span></span><br><span class="line"><span class="string">		width:160px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">	.iconfont &#123;</span></span><br><span class="line"><span class="string">		position:absolute;</span></span><br><span class="line"><span class="string">		right:5px;</span></span><br><span class="line"><span class="string">		bottom:5px;</span></span><br><span class="line"><span class="string">		width:30px;</span></span><br><span class="line"><span class="string">		line-height:30px;</span></span><br><span class="line"><span class="string">		border-radius:15px;</span></span><br><span class="line"><span class="string">		text-align:center;</span></span><br><span class="line"><span class="string">		&amp;.focused&#123;</span></span><br><span class="line"><span class="string">			background:#777;</span></span><br><span class="line"><span class="string">			color: #fff;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h3 id="二、使用React-Redux管理数据"><a href="#二、使用React-Redux管理数据" class="headerlink" title="二、使用React-Redux管理数据"></a>二、使用React-Redux管理数据</h3><p>首先我们看CSSTransition标签，它会给内部的NavSearch标签自动添加样式，这些样式在它外层样式（SearchWrapper）中定义，包含slide-enter和slide-enter-active、slide-exit和slide-exit-active。而实际中，应该将这些样式写在NavSearch标签上。</p>
<p>首先我们将SearchWrapper样式中的slide-enter和slide-enter-active、slide-exit和slide-exit-active样式剪切到NavSearch样式中，注意在前面添加<code>&amp;</code>表示同级样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> NavSearch=styled.input.attrs(&#123;</span><br><span class="line">	placeholder:<span class="string">'搜索'</span></span><br><span class="line">&#125;)<span class="string">`</span></span><br><span class="line"><span class="string">	width:160px;</span></span><br><span class="line"><span class="string">	height:38px;</span></span><br><span class="line"><span class="string">	padding:0 35px 0 20px;</span></span><br><span class="line"><span class="string">	box-sizing:border-box;</span></span><br><span class="line"><span class="string">	border:none;</span></span><br><span class="line"><span class="string">	outline:none;</span></span><br><span class="line"><span class="string">	margin-top:9px;</span></span><br><span class="line"><span class="string">	margin-left:20px;</span></span><br><span class="line"><span class="string">	border-radius:19px;</span></span><br><span class="line"><span class="string">	background:#eee;</span></span><br><span class="line"><span class="string">	font-size:14px;</span></span><br><span class="line"><span class="string">	color:#666;</span></span><br><span class="line"><span class="string">	&amp;::placeholder&#123;</span></span><br><span class="line"><span class="string">		color:#999;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	&amp;.focused &#123;</span></span><br><span class="line"><span class="string">        width:240px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">	&amp;.slide-enter &#123;</span></span><br><span class="line"><span class="string">		width:160px;</span></span><br><span class="line"><span class="string">		transition:all .2s ease-out;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &amp;.slide-enter-active &#123;</span></span><br><span class="line"><span class="string">		width:240px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">	&amp;.slide-exit &#123;</span></span><br><span class="line"><span class="string">		width:240px;</span></span><br><span class="line"><span class="string">		transition:all .2s ease-out;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &amp;.slide-exit-active &#123;</span></span><br><span class="line"><span class="string">		width:160px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>这里用到了state来管理数据，如果是小型项目这么写没问题，但是大型项目时需要使用redux来管理数据。为了便于维护，所有的数据尽量放在redux中</p>
<h4 id="2-1-安装使用redux"><a href="#2-1-安装使用redux" class="headerlink" title="2.1 安装使用redux"></a>2.1 安装使用redux</h4><p>首先在jianshu目录先安装redus和react-redux</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//安装redux数据框架</span></span><br><span class="line">npm install --save redux</span><br><span class="line"><span class="comment">//方便在react中使用redux</span></span><br><span class="line">npm install --save react-redux</span><br></pre></td></tr></table></figure>
<p>然后在src目录下创建一个store的文件夹，在store文件夹下创建一个index.js的文件；并且创建一个reducer(<code>src/store/reducer.js</code>)给它</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store=createStore(reducer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这时就创建好了store，就需要往store中存数据和取数据 。</p>
<h4 id="2-2-使用store存取数据"><a href="#2-2-使用store存取数据" class="headerlink" title="2.2 使用store存取数据"></a>2.2 使用store存取数据</h4><p>打开<code>src/App.js</code>,引入store，并且从react-redux中引入Provider，然后在reder</p>
<p>函数句将Header标签用Provider包裹起来，设置store属性，表示Provider把store中的数据都提供给了它内部的组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'./common/header/index.js'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    	&lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      		&lt;Header /&gt;</span><br><span class="line">      	&lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>
<p>然后在<code>src/common/header/index.js</code>文件中，做一下数据的连接，首先从react-redux引入connect，并且利用connect进行输出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React , &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line">。。。</span><br><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,mapDispatchToProps)(Header);</span><br></pre></td></tr></table></figure>
<p>然后就可以清理<code>src/common/header/index.js</code>文件中的数据了，删除里面的数据定义</p>
<p><del>this.state={<br>    focused:false,<br>};</del></p>
<p>在<code>src/store/index.js</code>文件中定义默认的state，包含focus</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=&#123;</span><br><span class="line">	focused:<span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样就把focused的数据放在了redux的仓库里。接着就应该将仓库里的focused映射到props中去，可以在mapStateToProps中操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        focused:state.focused</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时就可以将<code>src/common/header/index.js</code>中涉及focus的数据，改为this.props.focused了。</p>
<p>这时也可以把之前的handle函数全部删除了，因为不直接操作state了。修改onFocus和onBlur，并在mapDispatchToProps中创建相应的action，然后做分发</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;NavSearch </span><br><span class="line">	className=&#123;<span class="keyword">this</span>.props.focused ? <span class="string">'focused'</span>:<span class="string">''</span>&#125;</span><br><span class="line">	onFocus=&#123;<span class="keyword">this</span>.props.handleInputFocus&#125;</span><br><span class="line">	onBlur=&#123;<span class="keyword">this</span>.props.handleInputBlur&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">NavSearch</span>&gt;</span></span></span><br><span class="line">。。。</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		handleInputFocus()&#123;</span><br><span class="line">			<span class="keyword">const</span> action=&#123;</span><br><span class="line">				type:<span class="string">'search_focus'</span></span><br><span class="line">			&#125;;</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;,</span><br><span class="line">		handleInputBlur()&#123;</span><br><span class="line">			<span class="keyword">const</span> action=&#123;</span><br><span class="line">				type:<span class="string">'search_blur'</span></span><br><span class="line">			&#125;;</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>src/store/reducer.js</code>中对action类型进行判断，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=&#123;</span><br><span class="line">	focused:<span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">if</span>(action.type===<span class="string">'search_focus'</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			focused:<span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(action.type===<span class="string">'search_blur'</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			focused:<span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时，我们的页面又有聚焦和失焦功能了。 </p>
<p>此时我们也就没必要使用构造函数了，header组件就变成了无状态组件，可以将它变成无状态组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HeaderWrapper , Logo , Nav , NavItem , NavSearch, Addition,Button,SearchWrapper&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CSSTransition &#125; <span class="keyword">from</span> <span class="string">'react-transition-group'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Header= <span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">			&lt;HeaderWrapper&gt;</span><br><span class="line">				&lt;Logo href=<span class="string">'/'</span>/&gt;</span><br><span class="line">				&lt;Nav&gt;</span><br><span class="line">				    &lt;NavItem className=<span class="string">'left active'</span>&gt;首页&lt;<span class="regexp">/NavItem&gt;</span></span><br><span class="line"><span class="regexp">				    &lt;NavItem className='left'&gt;下载App&lt;/</span>NavItem&gt;</span><br><span class="line">				    &lt;NavItem className=<span class="string">'right'</span>&gt;登陆&lt;<span class="regexp">/NavItem&gt;</span></span><br><span class="line"><span class="regexp">				    &lt;NavItem className='right'&gt;</span></span><br><span class="line"><span class="regexp">				    	&lt;i className='iconfont'&gt;&amp;#xe636;&lt;/i</span>&gt;</span><br><span class="line">				    &lt;<span class="regexp">/NavItem&gt;</span></span><br><span class="line"><span class="regexp">				    &lt;SearchWrapper&gt;</span></span><br><span class="line"><span class="regexp">				    	&lt;CSSTransition</span></span><br><span class="line"><span class="regexp">							in=&#123; props.focused &#125;</span></span><br><span class="line"><span class="regexp">							timeout=&#123;200&#125;</span></span><br><span class="line"><span class="regexp">							classNames="slide"</span></span><br><span class="line"><span class="regexp">							&gt;</span></span><br><span class="line"><span class="regexp">						    &lt;NavSearch </span></span><br><span class="line"><span class="regexp">						    	className=&#123;props.focused ? 'focused':''&#125;</span></span><br><span class="line"><span class="regexp">						    	onFocus=&#123;props.handleInputFocus&#125;</span></span><br><span class="line"><span class="regexp">						    	onBlur=&#123;props.handleInputBlur&#125;&gt;&lt;/</span>NavSearch&gt;</span><br><span class="line">					    &lt;<span class="regexp">/CSSTransition&gt;</span></span><br><span class="line"><span class="regexp">					    &lt;i className=&#123;props.focused ? 'focused iconfont':'iconfont'&#125;&gt;&amp;#xe6dd;&lt;/i</span>&gt;</span><br><span class="line">				    &lt;<span class="regexp">/SearchWrapper&gt;</span></span><br><span class="line"><span class="regexp">				&lt;/</span>Nav&gt;</span><br><span class="line">				&lt;Addition&gt;</span><br><span class="line">					&lt;Button className=<span class="string">'writting'</span>&gt;</span><br><span class="line">						&lt;i className='iconfont'&gt;&amp;#xe60e;&lt;/i&gt;</span><br><span class="line">						写文章</span><br><span class="line">					&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">					&lt;Button className='reg'&gt;注册&lt;/</span>Button&gt;</span><br><span class="line">				&lt;<span class="regexp">/Addition&gt;</span></span><br><span class="line"><span class="regexp">			&lt;/</span>HeaderWrapper&gt;</span><br><span class="line">	);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		focused:state.focused</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		handleInputFocus()&#123;</span><br><span class="line">			<span class="keyword">const</span> action=&#123;</span><br><span class="line">				type:<span class="string">'search_focus'</span></span><br><span class="line">			&#125;;</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;,</span><br><span class="line">		handleInputBlur()&#123;</span><br><span class="line">			<span class="keyword">const</span> action=&#123;</span><br><span class="line">				type:<span class="string">'search_blur'</span></span><br><span class="line">			&#125;;</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,mapDispatchToProps)(Header);</span><br></pre></td></tr></table></figure>
<p>这时我们还不能使用redux开发者工具，怎么办呢，使用<strong>redux-devtools-extension</strong>,这时需哟啊对store对什么处理呢？从redux中引入compose，然后使用composeEnhancers增强功能即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, compose &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> composeEnhancers = <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;</span><br><span class="line"><span class="keyword">const</span> store=createStore(reducer,composeEnhancers());</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<p>####2.3 reducer分类 </p>
<p>reducer可以看作管理员手册，但是当手册管理内容增多时，怎么办呢？可以对手册作个分类，这样图书馆管理员再次查找手册时，就可以先找分类，然后再找内容。redux就可以将一个reducer拆分成很多小的reducer。</p>
<p>因为focused就是header的数据，我们可以在<code>src/common/header/</code>下创建文件夹store，并在里面创建reducer.js的文件，然后将<code>src/store/reducer</code>中的数据剪切到<code>src/common/header/store/reducer.js</code>之中。</p>
<p>这时<code>src/store/reducer</code>已经为空，项目也会报错，相当于把<code>src/store/reducer</code>中的笔记本拆分出去了，这里如何将拆分出去的笔记本整合起来呢？Redux提供了combineReducers使用，它可以将很多小的reducer合并成大的reducer，可以在<code>src/store/reducer</code>中如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;combineReducers&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> headerReducer <span class="keyword">from</span> <span class="string">'../common/header/store/reducer.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">	header:headerReducer</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此时页面也恢复正常了，通过<strong>redux-devtools-extension</strong>工具可以看到focused位于了header下，而不再是顶层。但是这时搜索框的动画却没了，怎么回事呢</p>
<p>因为我们在<code>src/common/header/index.js</code>中的mapStateToProps是直接使用state 下的focused，这里需要将它们改造成state.header.focused</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		focused:state.header.focused</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这时我们的页面就恢复正常了</p>
<h4 id="2-3-总结1"><a href="#2-3-总结1" class="headerlink" title="2.3 总结1"></a>2.3 总结1</h4><p>我们可以对每一部分，创建自己的reducer，然后在总的reducer中引入各个部分的reducer，并利用redex的combineReducers来创建一个总的reducer，并输出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;combineReducers&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> headerReducer <span class="keyword">from</span> <span class="string">'../common/header/store/reducer.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer=combineReducers(&#123;</span><br><span class="line">	header:headerReducer</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer;</span><br></pre></td></tr></table></figure>
<p>这里还有一个可优化的地方，我们看到在引入headerReducer时路径非常长，我们可以在<code>src/common/header/store</code>下新建一个index.js的文件，然后在里面引入自己的reducer，并且输出；然后我们在总的reducer文件中就可以直接引用该<code>src/common/header/store</code>就可以，它会自动寻找该路径下的index.js文件；为了避免命名冲突可以使用as关键字。</p>
<p><code>src/common/header/store/index.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; reducer &#125;;</span><br></pre></td></tr></table></figure>
<p><code>src/store/index.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;combineReducers&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line">~~<span class="keyword">import</span> headerReducer <span class="keyword">from</span> <span class="string">'../common/header/store/reducer.js'</span>;~~</span><br><span class="line"><span class="keyword">import</span> &#123; reducer <span class="keyword">as</span> headerReducer &#125; <span class="keyword">from</span> <span class="string">'../common/header/store'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">	header:headerReducer</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-4-使用actionCreator创建action"><a href="#2-4-使用actionCreator创建action" class="headerlink" title="2.4 使用actionCreator创建action"></a>2.4 使用actionCreator创建action</h4><p>这里还要注意，创建action时尽量不要使用字符串，我们使用actionCreator来通过常量创建action。</p>
<p>我们在<code>src/common/header/store/</code>下创建一个名为<code>actionCreators.js</code>的文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> searchFocus=<span class="function"><span class="params">()</span>=&gt;</span>(&#123;</span><br><span class="line">    type:<span class="string">'search_focus'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> searchBlur=<span class="function"><span class="params">()</span>=&gt;</span>(&#123;</span><br><span class="line">    type:<span class="string">'search_blur'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后在<code>src/common/header/index.js</code>中引入该creator，然后修改mapDispatchToProps中相应ation的创建</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionCreators <span class="keyword">from</span> <span class="string">'./store/actionCreators'</span>;</span><br><span class="line">。。。</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		handleInputFocus()&#123;</span><br><span class="line">			<span class="keyword">const</span> action=actionCreators.searchFocus();</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;,</span><br><span class="line">		handleInputBlur()&#123;</span><br><span class="line">			<span class="keyword">const</span> action=actionCreators.searchBlur();</span><br><span class="line">			dispatch(action);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更进一步，将<code>src/common/header/store/actionCreator.js</code>中的type用常量给替换掉。在</p>
<p><code>src/common/header/store/</code>下创建一个constants.js的文件；并且在<code>src/common/header/store/actionCreator.js</code>和在<code>src/common/header/store/reducer.js</code>文件中 中引用该常量；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SEARCH_FOCUS=<span class="string">'header/SEARCH_FOCUS'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SEARCH_BLUR=<span class="string">'header/SEARCH_BLUR'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> constants <span class="keyword">from</span> <span class="string">'./constants.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> searchFocus=<span class="function"><span class="params">()</span>=&gt;</span>(&#123;</span><br><span class="line">    type:constants.SEARCH_FOCUS</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> searchBlur=<span class="function"><span class="params">()</span>=&gt;</span>(&#123;</span><br><span class="line">    type:constants.SEARCH_BLUR</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> constants <span class="keyword">from</span> <span class="string">'./constants.js'</span>;</span><br><span class="line"><span class="keyword">const</span> defaultState=&#123;</span><br><span class="line">	focused:<span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">if</span>(action.type===constants.SEARCH_FOCUS)&#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			focused:<span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(action.type===constants.SEARCH_BLUR)&#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			focused:<span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，这里我们在<code>src/common/header/index.js</code>中引用了<code>src/common/header/store/actionCreator.js</code>文件中的内容，而我们希望store下只有一个出口文件，而不是一个一个引入store下具体的文件，我们在<code>src/common/header/store/index.js</code>中作统一处理,这样这个index文件就引入了store文件夹下的所有内容，在外部只需引入这一个index文件即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer.js'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionCreators <span class="keyword">from</span> <span class="string">'./actionCreators.js'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> constants <span class="keyword">from</span> <span class="string">'./constants.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; reducer , actionCreators , constants&#125;;</span><br></pre></td></tr></table></figure>
<p>这时也需要将<code>src/common/header/index.js</code>中引入的creator换一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~~import * as actionCreators from &apos;./store/actionCreators&apos;;~~</span><br><span class="line">improt &#123;actionCreators&#125; from &apos;./store/index.js&apos;;</span><br></pre></td></tr></table></figure>
<h4 id="2-5-总结2"><a href="#2-5-总结2" class="headerlink" title="2.5 总结2"></a>2.5 总结2</h4><p>这时，store文件夹下的内容就非常清晰了，将所有输出都通过index.js作统一处理，外部只需要引用index.js文件就可以。</p>
<h4 id="2-6-使用immutable来管理store中的数据"><a href="#2-6-使用immutable来管理store中的数据" class="headerlink" title="2.6 使用immutable来管理store中的数据"></a>2.6 使用immutable来管理store中的数据</h4><p>reducer只能获取state中的数据，而不能改变原始state中的数据，而时创建一个新的state返回。这样很容易出错，immutable就是解决这个问题。</p>
<p>immutable就是不可变更的，如果将state设成immutable，那么这个state就是不可改变的，这样reducer就不会出现问题 ，</p>
<p>首先安装immutable.js，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install immutable</span><br><span class="line"><span class="comment">//或</span></span><br><span class="line">yarn add immutable</span><br></pre></td></tr></table></figure>
<p>接下来就需要将state变成immutable对象了，来到<code>src/common/header/store/reducer.js</code>,引入immutable中的fromJS，他可以帮助我们把一个js对象转化为一个immutable对象，然后就可以将defaultState转化为immutable对象了 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">    focused:<span class="literal">false</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后打开<code>src/common/header/index.js</code>文件，修改里面mapStateToProps方法中的数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ~~focused:state.header.focused~~</span><br><span class="line">        focused:state.header.get(<span class="string">'focused '</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是此时，点击搜索框还是会报错，这是由于这时在reducer中返回的是普通对象，需要使用immutable的set方法来做更改，immutable对象set方法会结合之前immutable对象的值和设置的值返回一个全新的对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">if</span>(action.type===constants.SEARCH_FOCUS)&#123;</span><br><span class="line">		<span class="keyword">return</span> state.set(<span class="string">'focused'</span>,<span class="literal">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(action.type===constants.SEARCH_BLUR)&#123;</span><br><span class="line">		<span class="keyword">return</span> state.set(<span class="string">'focused'</span>,<span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样就可以避免不小心更改state的错误了。</p>
<h4 id="2-7-使用redux-immutable统一数据格式"><a href="#2-7-使用redux-immutable统一数据格式" class="headerlink" title="2.7 使用redux-immutable统一数据格式"></a>2.7 使用redux-immutable统一数据格式</h4><p>我们注意看一下 focused:state.header.get(‘focused ‘)这个代码，state是一个js对象，而state.header是一个immutable对象，所以要调用focused的时候需要xian 调用.再调用.get()。这种混在的方式不是很好。</p>
<p>我们可以考虑将state变成immutable对象，也就是对<code>src/store/reduce.js</code>，这时我们需要依赖一个第三方的模块，redux-immutable，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install redux-immutable</span><br></pre></td></tr></table></figure>
<p>之前我们redux从redux中来，赖在我们修改它从redux-immutable中来</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~~<span class="keyword">import</span> &#123;combineReducers&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;~~</span><br><span class="line"><span class="keyword">import</span> &#123;combineReducers&#125; <span class="keyword">from</span> <span class="string">'redux-immutable'</span>;</span><br></pre></td></tr></table></figure>
<p>但是此时页面会报错，我们需要改变一下<code>src/common/header/index.js</code>，里面的state方法就不能用.了，需要用get()方法了，这样整个对数据的操作就统一了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        focused:state.get(<span class="string">'header'</span>).get(<span class="string">'focused '</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>immutable中还有很多写法，比如可以将<code>focused:state.get(&#39;header&#39;).get(&#39;focused &#39;)</code>用getIn方法改写<code>focused:state.getIn([&#39;header&#39;,&#39;focused&#39;])</code>，数组表示取header下面的focused项。</p>
<h3 id="三、热门搜索布局"><a href="#三、热门搜索布局" class="headerlink" title="三、热门搜索布局"></a>三、热门搜索布局</h3><p>当我们鼠标聚焦在搜索框时，会弹出热门搜索框，，接下来我们做搜索部分的热门搜索的布局。</p>
<h4 id="3-1-添加SearchInfo"><a href="#3-1-添加SearchInfo" class="headerlink" title="3.1 添加SearchInfo"></a>3.1 添加SearchInfo</h4><p>首先我们需要在<code>src/common/header/index.js</code>中添加一个SearchInfo组件，并且在style中添加这个组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeaderWrapper , Logo , Nav , NavItem , NavSearch, Addition,Button,SearchWrapper,SearchInfo&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line">...</span><br><span class="line">				&lt;SearchWrapper&gt;</span><br><span class="line">				    	&lt;CSSTransition</span><br><span class="line">							<span class="keyword">in</span>=&#123; props.focused &#125;</span><br><span class="line">							timeout=&#123;<span class="number">200</span>&#125;</span><br><span class="line">							classNames=<span class="string">"slide"</span></span><br><span class="line">							&gt;</span><br><span class="line">						    &lt;NavSearch </span><br><span class="line">						    	className=&#123;props.focused ? <span class="string">'focused'</span>:<span class="string">''</span>&#125;</span><br><span class="line">						    	onFocus=&#123;props.handleInputFocus&#125;</span><br><span class="line">						    	onBlur=&#123;props.handleInputBlur&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">NavSearch</span>&gt;</span></span></span><br><span class="line">					    &lt;<span class="regexp">/CSSTransition&gt;</span></span><br><span class="line"><span class="regexp">					    &lt;i className=&#123;props.focused ? 'focused iconfont':'iconfont'&#125;&gt;&amp;#xe6dd;&lt;/i</span>&gt;</span><br><span class="line">				    	&lt;SearchInfo&gt;<span class="xml"><span class="tag">&lt;/<span class="name">SearchInfo</span>&gt;</span></span></span><br><span class="line">				    &lt;<span class="regexp">/SearchWrapper&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后打开<code>src/common/header/style.js</code>中编写SearchInfo</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfo=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	position:absolute;</span></span><br><span class="line"><span class="string">	left:0;</span></span><br><span class="line"><span class="string">	top:50px;</span></span><br><span class="line"><span class="string">	width:240px;</span></span><br><span class="line"><span class="string">	height:100px;</span></span><br><span class="line"><span class="string">	padding:0 20px;</span></span><br><span class="line"><span class="string">	background:green;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>然后设置阴影，从简书官网获取，添加阴影，就可以去掉background了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfo=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	position:absolute;</span></span><br><span class="line"><span class="string">	left:0;</span></span><br><span class="line"><span class="string">	top:50px;</span></span><br><span class="line"><span class="string">	width:240px;</span></span><br><span class="line"><span class="string">	height:100px;</span></span><br><span class="line"><span class="string">	padding:0 20px;</span></span><br><span class="line"><span class="string">	box-shadow: 0 0 8px rgba(0,0,0,.2);</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-添加SearchInfoTitle"><a href="#3-2-添加SearchInfoTitle" class="headerlink" title="3.2 添加SearchInfoTitle"></a>3.2 添加SearchInfoTitle</h4><p>然后在SearchInfo里面添加新标签SearchInfoTitle了</p>
<p>首先在<code>src/common/header/index.js</code>SearchInfo组件内添加SearchInfoTitle，并且引入SearchInfoTitle，然后在style中定义该title</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeaderWrapper , Logo , Nav , NavItem , NavSearch, Addition,Button,SearchWrapper,SearchInfo,SearchInfoTitle&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line">。。。</span><br><span class="line">&lt;SearchInfo&gt;</span><br><span class="line">	&lt;SearchInfoTitle&gt;热门搜索&lt;<span class="regexp">/SearchInfoTitle&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>SearchInfo&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfoTitle=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	margin-top:20px;</span></span><br><span class="line"><span class="string">	margin-bottom:15px;</span></span><br><span class="line"><span class="string">	line-height:20px;</span></span><br><span class="line"><span class="string">	font-size:14px;</span></span><br><span class="line"><span class="string">	color: #969696;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-添加写换一批"><a href="#3-3-添加写换一批" class="headerlink" title="3.3 添加写换一批"></a>3.3 添加写换一批</h4><p>我们在SearchInfoTitle中添加组件SearchInfoSwitch组件，同样引入并定义该样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeaderWrapper , Logo , Nav , NavItem , NavSearch, Addition,Button,SearchWrapper,SearchInfo,SearchInfoTitle, SearchInfoSwitch&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line">。。。</span><br><span class="line">&lt;SearchInfo&gt;</span><br><span class="line">	&lt;SearchInfoTitle&gt;热门搜索</span><br><span class="line">	&lt;SearchInfoSwitch&gt;换一批&lt;<span class="regexp">/SearchInfoSwitch&gt;</span></span><br><span class="line"><span class="regexp">	&lt;/</span>SearchInfoTitle&gt;</span><br><span class="line">&lt;<span class="regexp">/SearchInfo&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfoSwitch=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float: right;</span></span><br><span class="line"><span class="string">    font-size: 13px;</span></span><br><span class="line"><span class="string">    color: #969696;</span></span><br><span class="line"><span class="string">    background-color: transparent;</span></span><br><span class="line"><span class="string">    border-width: 0;</span></span><br><span class="line"><span class="string">    padding: 0;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-4-添加提示内容"><a href="#3-4-添加提示内容" class="headerlink" title="3.4 添加提示内容"></a>3.4 添加提示内容</h4><p>然后在SearchInfoTitle下方添加一个div，并且在里面添加组件SearchInfoItem，同样引入并创建该样式，它是一个a标签</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeaderWrapper , Logo , Nav , NavItem , NavSearch, Addition,Button,SearchWrapper,SearchInfo,SearchInfoTitle, SearchInfoSwitch, SearchInfoItem&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line">。。。</span><br><span class="line">&lt;SearchInfo&gt;</span><br><span class="line">	&lt;SearchInfoTitle&gt;热门搜索</span><br><span class="line">	&lt;SearchInfoSwitch&gt;换一批&lt;<span class="regexp">/SearchInfoSwitch&gt;</span></span><br><span class="line"><span class="regexp">	&lt;/</span>SearchInfoTitle&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">		&lt;SearchInfoItem&gt;教育&lt;<span class="regexp">/SearchInfoItem&gt;</span></span><br><span class="line"><span class="regexp">		&lt;SearchInfoItem&gt;教育&lt;/</span>SearchInfoItem&gt;</span><br><span class="line">		&lt;SearchInfoItem&gt;教育&lt;<span class="regexp">/SearchInfoItem&gt;</span></span><br><span class="line"><span class="regexp">		&lt;SearchInfoItem&gt;教育&lt;/</span>SearchInfoItem&gt;</span><br><span class="line">		&lt;SearchInfoItem&gt;教育&lt;<span class="regexp">/SearchInfoItem&gt;</span></span><br><span class="line"><span class="regexp">		&lt;SearchInfoItem&gt;教育&lt;/</span>SearchInfoItem&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>SearchInfo&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfoItem=styled.a<span class="string">`</span></span><br><span class="line"><span class="string">	display:block;</span></span><br><span class="line"><span class="string">	float:left;</span></span><br><span class="line"><span class="string">	line-height:20px;</span></span><br><span class="line"><span class="string">	padding:0 5px;</span></span><br><span class="line"><span class="string">	margin-right:10px;</span></span><br><span class="line"><span class="string">	margin-bottom:15px;</span></span><br><span class="line"><span class="string">	font-size:12px;</span></span><br><span class="line"><span class="string">	border:1px solid #ddd;</span></span><br><span class="line"><span class="string">	color:#333;</span></span><br><span class="line"><span class="string">	border-radius:3px;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-5-添加SearchInfoList"><a href="#3-5-添加SearchInfoList" class="headerlink" title="3.5 添加SearchInfoList"></a>3.5 添加SearchInfoList</h4><p>这时发现item越界了，这时由于在外层SearchInfo中把高度写死了，去掉下面的height就可以了。这时就可以了 。</p>
<p>这时我们将外层的div改为SearchInfoList，引入并创建该样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeaderWrapper , Logo , Nav , NavItem , NavSearch, Addition,Button,SearchWrapper,SearchInfo,SearchInfoTitle, SearchInfoSwitch, SearchInfoItem, SearchInfoList&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line">。。。</span><br><span class="line">&lt;SearchInfo&gt;</span><br><span class="line">	&lt;SearchInfoTitle&gt;热门搜索</span><br><span class="line">	&lt;SearchInfoSwitch&gt;换一批&lt;<span class="regexp">/SearchInfoSwitch&gt;</span></span><br><span class="line"><span class="regexp">	&lt;/</span>SearchInfoTitle&gt;</span><br><span class="line">	&lt;SearchInfoList&gt;</span><br><span class="line">		&lt;SearchInfoItem&gt;教育&lt;<span class="regexp">/SearchInfoItem&gt;</span></span><br><span class="line"><span class="regexp">		&lt;SearchInfoItem&gt;教育&lt;/</span>SearchInfoItem&gt;</span><br><span class="line">		&lt;SearchInfoItem&gt;教育&lt;<span class="regexp">/SearchInfoItem&gt;</span></span><br><span class="line"><span class="regexp">		&lt;SearchInfoItem&gt;教育&lt;/</span>SearchInfoItem&gt;</span><br><span class="line">		&lt;SearchInfoItem&gt;教育&lt;<span class="regexp">/SearchInfoItem&gt;</span></span><br><span class="line"><span class="regexp">		&lt;SearchInfoItem&gt;教育&lt;/</span>SearchInfoItem&gt;</span><br><span class="line">    &lt;<span class="regexp">/SearchInfoList&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>SearchInfo&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfoList=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	overflow:hidden;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-6-聚焦显示失焦隐藏"><a href="#3-6-聚焦显示失焦隐藏" class="headerlink" title="3.6 聚焦显示失焦隐藏"></a>3.6 聚焦显示失焦隐藏</h4><p>我们在<code>src/common/header/index.js</code>中声明一个方法，getListArea，接受一个参数，参数是真就返回列表，参数为假就不返回列表，然后在之前SearchInfo标签处添加该方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getListArea=<span class="function">(<span class="params">show</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(show)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;SearchInfo&gt;</span><br><span class="line">                &lt;SearchInfoTitle&gt;热门搜索</span><br><span class="line">                &lt;SearchInfoSwitch&gt;换一批&lt;<span class="regexp">/SearchInfoSwitch&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>SearchInfoTitle&gt;</span><br><span class="line">                &lt;SearchInfoList&gt;</span><br><span class="line">                    &lt;SearchInfoItem&gt;教育&lt;<span class="regexp">/SearchInfoItem&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;SearchInfoItem&gt;教育&lt;/</span>SearchInfoItem&gt;</span><br><span class="line">                    &lt;SearchInfoItem&gt;教育&lt;<span class="regexp">/SearchInfoItem&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;SearchInfoItem&gt;教育&lt;/</span>SearchInfoItem&gt;</span><br><span class="line">                    &lt;SearchInfoItem&gt;教育&lt;<span class="regexp">/SearchInfoItem&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;SearchInfoItem&gt;教育&lt;/</span>SearchInfoItem&gt;</span><br><span class="line">                &lt;<span class="regexp">/SearchInfoList&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>SearchInfo&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">。。。</span><br><span class="line">				&lt;SearchWrapper&gt;</span><br><span class="line">				    	&lt;CSSTransition</span><br><span class="line">							。。。</span><br><span class="line">					    &lt;<span class="regexp">/CSSTransition&gt;</span></span><br><span class="line"><span class="regexp">					    &lt;i className=&#123;props.focused ? 'focused iconfont':'iconfont'&#125;&gt;&amp;#xe6dd;&lt;/i</span>&gt;</span><br><span class="line">				    	&#123;getListArea(props.focused)&#125;</span><br><span class="line">				    &lt;<span class="regexp">/SearchWrapper&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样热门搜索框就做好了。</p>
<h4 id="3-7-再次换一批"><a href="#3-7-再次换一批" class="headerlink" title="3.7 再次换一批"></a>3.7 再次换一批</h4><p>header会越来约庞大，如果还用无状态组件的话会特别麻烦，需要将它换成一个常规的Component组件，继承自component，在render函数中直接返回就可以;</p>
<p>这里面也没有props这个参数了，需要将它们全部转为this.props；</p>
<p>同时需要将getListArea方法，添加到累内部，在调用的地方换为this.getListArea</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...</span><br></pre></td></tr></table></figure>
<p>当我们第一次聚焦input框的时候，会发送ajax请求，获取热门搜索关键字，再次聚焦的时候不会发送请求，而是直接使用之前的关键字。</p>
<p>所以在header的reducer中不仅要保存focus的数据，还要保存热门关键字数组list，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	focused:<span class="literal">false</span>，</span><br><span class="line">	list:[]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>而发送ajax请求，我们统一放在redux-thunk中去处理，首先安装redux-thunk</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install redux-thunk</span><br></pre></td></tr></table></figure>
<p>它应该在创建store时被使用，我们是在<code>src/index.js</code>中创建的store，在里面引入并使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, compose , applyMiddleware&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> composeEnhancers = <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;</span><br><span class="line"><span class="keyword">const</span> store=createStore(reducer,composeEnhancers(</span><br><span class="line">		applyMiddleware(thunk)</span><br><span class="line">	));</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<p>然后就可以在action中做异步操作了，来到<code>src/common/header/index.js</code>文件，在mapDispatchToProps方法中派发一个action，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		handleInputFocus()&#123;</span><br><span class="line">			dispatch(actionCreators.getList());</span><br><span class="line">			dispatch(actionCreators.searchFocus());</span><br><span class="line">		&#125;,</span><br><span class="line">		handleInputBlur()&#123;</span><br><span class="line">			dispatch(actionCreators.searchBlur());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并且在actionCreators.js文件中添加一个函数，之前时返回一个对象，现在不返回对象了而是返回一个函数，在这个函数中发出一个一步请求，这就可以使用一个第三方模块axios了，首先安装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getList=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">		axios.get(<span class="string">'api/headerList.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;<span class="comment">//成功</span></span><br><span class="line"></span><br><span class="line">		&#125;).catch(<span class="function"><span class="params">()</span>=&gt;</span>&#123;<span class="comment">//失败</span></span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">"error"</span>);</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这时很明显不会获取到数据，因为我们没有这个后台接口，这时我们可以利用create-react来模拟数据，首先在public目录下创建一个文件夹api，在里面创建一个问价headList.json，在里面随意添加几个文字，这时在浏览器中输入localhost:3000/api/headerList.json，就可以访问你写入的内容了。通过这个特性我们可以写一些假数据</p>
<p>在json文件中添加：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">'success'</span>:ture,</span><br><span class="line">	<span class="string">"data"</span>:[<span class="string">"行距杯2018征文"</span>,<span class="string">"区块链"</span>,<span class="string">"小程序"</span>,<span class="string">"vue"</span>,<span class="string">"毕业"</span>,<span class="string">"PHP"</span>,<span class="string">"故事"</span>,<span class="string">"flutter"</span>,<span class="string">"理财"</span>,<span class="string">"美食"</span>,<span class="string">"投稿"</span>,<span class="string">"手帐"</span>,<span class="string">"书法"</span>,<span class="string">"PPT"</span>,<span class="string">"穿搭"</span>,<span class="string">"打碗碗花"</span>,<span class="string">"简书"</span>,<span class="string">"姥姥的澎湖湾"</span>,<span class="string">"设计"</span>,<span class="string">"创业"</span>,<span class="string">"交友"</span>,<span class="string">"籽盐"</span>,<span class="string">"教育"</span>,<span class="string">"思维导图"</span>,<span class="string">"疯哥哥"</span>,<span class="string">"梅西"</span>,<span class="string">"时间管理"</span>,<span class="string">"golang"</span>,<span class="string">"连载"</span>,<span class="string">"自律"</span>,<span class="string">"职场"</span>,<span class="string">"考研"</span>,<span class="string">"慢世人"</span>,<span class="string">"悦欣"</span>,<span class="string">"一纸vr"</span>,<span class="string">"spring"</span>,<span class="string">"eos"</span>,<span class="string">"足球"</span>,<span class="string">"程序员"</span>,<span class="string">"林露含"</span>,<span class="string">"彩铅"</span>,<span class="string">"金融"</span>,<span class="string">"木风杂谈"</span>,<span class="string">"日更"</span>,<span class="string">"成长"</span>,<span class="string">"外婆是方言"</span>,<span class="string">"docker"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这时我们就能在请求成功之后派发action了，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">axios.get(&apos;api/headerList.json&apos;).then((res)=&gt;&#123;//成功</span><br><span class="line">	const data=res.data;</span><br><span class="line">	const action=&#123;</span><br><span class="line">        type:&apos;change_list&apos;,</span><br><span class="line">        data:data.data</span><br><span class="line">	&#125;</span><br><span class="line">	dispatch(action);</span><br><span class="line">&#125;).catch(()=&gt;&#123;//失败</span><br><span class="line">    console.log(&quot;error&quot;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>由于请求本身就是在actionCreators.js文件中的，所以可以这么改：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> changeList=<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    type:constants.CHANGE_LIST,</span><br><span class="line">    data</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">axios.get(<span class="string">'api/headerList.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;<span class="comment">//成功</span></span><br><span class="line">	<span class="keyword">const</span> data=res.data;</span><br><span class="line">	dispatch(changeList(data));</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">()</span>=&gt;</span>&#123;<span class="comment">//失败</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"error"</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>接下来就可以去<code>src/common/header/store/reducer.js</code>中继续写代码了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(action.type===constants.CHANGE_LIST)&#123;</span><br><span class="line">		<span class="keyword">return</span> state.set(<span class="string">'list'</span>,action.data);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>注意这么写肯定是有问题的，因为我们在defaultState是一个immutable对象，里面的list也是一个immutable对象，而action.data是一个普通的js数组，可定会出错的。解决方法很简单，只需要在actionCreators.js中将data变成一个immutable对象就可以了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;fromJS&#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</span><br><span class="line"><span class="keyword">const</span> changeList=<span class="function">(<span class="params">data</span>)=&gt;</span>(&#123;</span><br><span class="line">    type: constants.CHANGE_LIST,</span><br><span class="line">    data: fromJS(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后就可以在<code>src/common/header/index.js</code>中取数据了</p>
<p>在mapStateToProps方法中补充list属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		focused:state.get(<span class="string">'header'</span>).get(<span class="string">'focused'</span>),</span><br><span class="line">		list:state.getIn([<span class="string">'header'</span>,<span class="string">'list'</span>])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后修改getListArea，首先将参数去掉直接在方法内部调用this.props.focused，然后将SearchInfoList内部写一个循环表达式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">getListArea()&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">this</span>.props.focused)&#123;</span><br><span class="line">	    	<span class="keyword">return</span> (</span><br><span class="line">		        &lt;SearchInfo&gt;</span><br><span class="line">		            &lt;SearchInfoTitle&gt;热门搜索</span><br><span class="line">		            &lt;SearchInfoSwitch&gt;换一批&lt;<span class="regexp">/SearchInfoSwitch&gt;</span></span><br><span class="line"><span class="regexp">		            &lt;/</span>SearchInfoTitle&gt;</span><br><span class="line">		            &lt;SearchInfoList&gt;</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">this</span>.props.list.map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">                            	<span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">SearchInfoItem</span> <span class="attr">key</span>=<span class="string">&#123;item&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">SearchInfoItem</span>&gt;</span></span></span><br><span class="line">                        	&#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">		            &lt;<span class="regexp">/SearchInfoList&gt;</span></span><br><span class="line"><span class="regexp">		        &lt;/</span>SearchInfo&gt;</span><br><span class="line">	        )</span><br><span class="line">	    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&#123; <span class="keyword">this</span>.getListArea() &#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-8-简化代码"><a href="#3-8-简化代码" class="headerlink" title="3.8 简化代码"></a>3.8 简化代码</h4><p>（1）</p>
<p>这时我们的<code>src/common/header/store/actionCreators.js</code>中大部分内容需要暴漏出去，但是像changeList的方法不用暴漏出去。像这种不暴漏的方法建议要么都放在顶部要么都放在底部；</p>
<p>（2）</p>
<p>在<code>src/common/header/index.js</code>中，导出都用this.props.list或this.props.focused，其实可以精简一下，在getListArea方法中添加入戏内容，这样就无需每次都使用this.props.XXX了，就可以直接使用focused和list了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getListArea()&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;focused,list&#125;=<span class="keyword">this</span>.props;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同理在render方法中我们可以使用，来简化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">render()&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;focused,handlerInputFocused,handlerInputBlur&#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）</p>
<p>在<code>src/common/header/store/reducer.js</code>文件中，大量的使用了if语句，可以使用switch语句来做替换</p>
<h4 id="3-9-实现换一批功能"><a href="#3-9-实现换一批功能" class="headerlink" title="3.9 实现换一批功能"></a>3.9 实现换一批功能</h4><h6 id="3-9-1给提示框分页"><a href="#3-9-1给提示框分页" class="headerlink" title="3.9.1给提示框分页"></a>3.9.1给提示框分页</h6><p>我们热门索搜提示显示了所有的内容，而简书官网每次只显示十个内容。我们先在<code>src/common/header/store/reducer.js</code>文件中给defaultStatus添加page和totalPage两个属性，表示当前页码和总页数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	focused:<span class="literal">false</span>,</span><br><span class="line">	list:[],</span><br><span class="line">	page:<span class="number">1</span>,</span><br><span class="line">	totalPage:<span class="number">1</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后在<code>src/common/header/store/actionCreators.js</code>文件中给changeList方法，补充totalPage属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> changeList=<span class="function">(<span class="params">data</span>)=&gt;</span>(&#123;</span><br><span class="line">    type: constants.CHANGE_LIST,</span><br><span class="line">    data: fromJS(data),</span><br><span class="line">    totalPage:<span class="built_in">Math</span>.ceil(data.length/<span class="number">10</span>),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样当取完列表项数据时，就可以知道总页数了；action会被派发给reducer，需要在<code>src/common/header/store/reducer.js</code>中对CHANGE_LIST方法不仅哟啊改变list，而且还要改变totalPage内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line">		<span class="keyword">case</span> constants.SEARCH_FOCUS:</span><br><span class="line">			<span class="keyword">return</span> state.set(<span class="string">'focused'</span>,<span class="literal">true</span>);</span><br><span class="line">		<span class="keyword">case</span> constants.SEARCH_BLUR:</span><br><span class="line">			<span class="keyword">return</span> state.set(<span class="string">'focused'</span>,<span class="literal">false</span>);</span><br><span class="line">		<span class="keyword">case</span> constants.CHANGE_LIST:</span><br><span class="line">			<span class="keyword">return</span> state.set(<span class="string">'list'</span>,action.data).set(<span class="string">"totalPage"</span>,action.totalPage);</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>src/common/header/index.js</code>拿到page页码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		focused:state.get(<span class="string">'header'</span>).get(<span class="string">'focused'</span>),</span><br><span class="line">		list:state.getIn([<span class="string">'header'</span>,<span class="string">'list'</span>]),</span><br><span class="line">		page:state.getIn([<span class="string">'header'</span>,<span class="string">'page'</span>]),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在getListArea中使用page，来创建10个item，放置在相应位置。注意list由于是immutable对象不能直接使用下标，需要将它转化为js对象才能使用下标形式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">getListArea()&#123;</span><br><span class="line">		<span class="keyword">const</span> &#123;focused,list,page&#125;=<span class="keyword">this</span>.props;</span><br><span class="line">		<span class="keyword">const</span> newList=list.toJS();</span><br><span class="line">		<span class="keyword">const</span> pageList=[];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">let</span> i = (page<span class="number">-1</span>)*<span class="number">10</span>; i &lt;page*<span class="number">10</span>; i++) &#123;</span><br><span class="line">			pageList.push(</span><br><span class="line">				&lt;SearchInfoItem key=&#123;newList[i]&#125;&gt;&#123;newList[i]&#125;&lt;<span class="regexp">/SearchInfoItem&gt;</span></span><br><span class="line"><span class="regexp">			);</span></span><br><span class="line"><span class="regexp">		&#125;</span></span><br><span class="line"><span class="regexp">		if(focused)&#123;</span></span><br><span class="line"><span class="regexp">	    	return (</span></span><br><span class="line"><span class="regexp">		        &lt;SearchInfo&gt;</span></span><br><span class="line"><span class="regexp">		            &lt;SearchInfoTitle&gt;热门搜索</span></span><br><span class="line"><span class="regexp">		            	&lt;SearchInfoSwitch&gt;换一批&lt;/</span>SearchInfoSwitch&gt;</span><br><span class="line">		            &lt;<span class="regexp">/SearchInfoTitle&gt;</span></span><br><span class="line"><span class="regexp">		            &lt;SearchInfoList&gt;</span></span><br><span class="line"><span class="regexp">		                &#123;</span></span><br><span class="line"><span class="regexp">                            pageList</span></span><br><span class="line"><span class="regexp">                        &#125;</span></span><br><span class="line"><span class="regexp">		            &lt;/</span>SearchInfoList&gt;</span><br><span class="line">		        &lt;<span class="regexp">/SearchInfo&gt;</span></span><br><span class="line"><span class="regexp">	        )</span></span><br><span class="line"><span class="regexp">	    &#125;else&#123;</span></span><br><span class="line"><span class="regexp">	        return null;</span></span><br><span class="line"><span class="regexp">	    &#125;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br></pre></td></tr></table></figure>
<p>此时我们的热门索搜提示就展示10条内容了。</p>
<h6 id="3-9-1实现换一批换页"><a href="#3-9-1实现换一批换页" class="headerlink" title="3.9.1实现换一批换页"></a>3.9.1实现换一批换页</h6><p>此时我们点击换一批，发现提示框直接消失了；简书官网则不是这样的，只有在鼠标移出搜索框时才隐藏。所有提示框不仅仅是依赖focused来隐藏的，我们需要额外监听一个属性，鼠标是否在提示框内mouseIn，首先给<code>src/common/header/store/reducer.js</code>添加mouseIn属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=fromJS(&#123;</span><br><span class="line">	focused:<span class="literal">false</span>,</span><br><span class="line">	list:[],</span><br><span class="line">	mouseIn:<span class="literal">false</span>,</span><br><span class="line">	page:<span class="number">1</span>,</span><br><span class="line">	totalPage:<span class="number">1</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>给constants添加MOUSE_IN和MOUSE_OUT常量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> MOUSE_IN=<span class="string">"header/MOUSE_IN"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> MOUSE_OUT=<span class="string">"header/MOUSE_OUT"</span>;</span><br></pre></td></tr></table></figure>
<p>给SearchInfo添加onMouseEnter和onMouseLeave;在mapStateToProps中引入mouseIn；在mapDispatchToProps中添加handlerMouseEnter,handlerMouseLeave操作；在actionCreators中创建mouseEnter和mouseLeave事件；在reducer中处理这两个事件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;focused,list,page,handlerMouseEnter,handlerMouseLeave&#125;=<span class="keyword">this</span>.props;</span><br><span class="line">....</span><br><span class="line">&lt;SearchInfo</span><br><span class="line">	onMouseEnter=&#123;handlerMouseEnter&#125;</span><br><span class="line">	onMouseLeave=&#123;handlerMouseLeave&#125;</span><br><span class="line">&gt;</span><br><span class="line">....</span><br><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		focused:state.get(<span class="string">'header'</span>).get(<span class="string">'focused'</span>),</span><br><span class="line">		list:state.getIn([<span class="string">'header'</span>,<span class="string">'list'</span>]),</span><br><span class="line">		page:state.getIn([<span class="string">'header'</span>,<span class="string">'page'</span>]),</span><br><span class="line">		mouseIn:state.getIn([<span class="string">'header'</span>,<span class="string">'mouseIn'</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		handleInputFocus()&#123;</span><br><span class="line">			dispatch(actionCreators.getList());</span><br><span class="line">			dispatch(actionCreators.searchFocus());</span><br><span class="line">		&#125;,</span><br><span class="line">		handleInputBlur()&#123;</span><br><span class="line">			dispatch(actionCreators.searchBlur());</span><br><span class="line">		&#125;,</span><br><span class="line">		handlerMouseEnter()&#123;</span><br><span class="line">			dispatch(actionCreators.mouseEnter());</span><br><span class="line">		&#125;,</span><br><span class="line">		handlerMouseLeave()&#123;</span><br><span class="line">			dispatch(actionCreators.mouseLeave());</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mouseEnter=<span class="function"><span class="params">()</span>=&gt;</span>(&#123;</span><br><span class="line">    type:constants.MOUSE_IN</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mouseLeave=<span class="function"><span class="params">()</span>=&gt;</span>(&#123;</span><br><span class="line">    type:constants.MOUSE_OUT</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">	<span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line">		<span class="keyword">case</span> constants.SEARCH_FOCUS:</span><br><span class="line">			<span class="keyword">return</span> state.set(<span class="string">'focused'</span>,<span class="literal">true</span>);</span><br><span class="line">		<span class="keyword">case</span> constants.SEARCH_BLUR:</span><br><span class="line">			<span class="keyword">return</span> state.set(<span class="string">'focused'</span>,<span class="literal">false</span>);</span><br><span class="line">		<span class="keyword">case</span> constants.CHANGE_LIST:</span><br><span class="line">			<span class="keyword">return</span> state.set(<span class="string">'list'</span>,action.data).set(<span class="string">"totalPage"</span>,action.totalPage);</span><br><span class="line">		<span class="keyword">case</span> constants.MOUSE_IN:</span><br><span class="line">			<span class="keyword">return</span> state.set(<span class="string">'mouseIn'</span>,<span class="literal">true</span>);</span><br><span class="line">		<span class="keyword">case</span> constants.MOUSE_OUT:</span><br><span class="line">			<span class="keyword">return</span> state.set(<span class="string">'mouseIn'</span>,<span class="literal">false</span>);</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后就可以对getListArea方法，foucese的判断再添加一个mouseIn了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(focused || mouseIn)&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来就可以实现点击事件了 给SearchInfoSwitch添加点击事件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SearchInfoSwitch onClick=&#123;()=&gt;handlerChangePage(page,totalPage)&#125;&gt;换一批&lt;<span class="regexp">/SearchInfoSwitch&gt;</span></span><br></pre></td></tr></table></figure>
<p>其余略，同上</p>
<h6 id="3-9-3-给immutable对象修改多个属性"><a href="#3-9-3-给immutable对象修改多个属性" class="headerlink" title="3.9.3 给immutable对象修改多个属性"></a>3.9.3 给immutable对象修改多个属性</h6><p>如果给immutable修改多个属性，连续使用set会和长，这时可以使用merge代替</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">state.set(<span class="string">'list'</span>,action.data).set(<span class="string">"totalPage"</span>,action.totalPage);</span><br><span class="line"><span class="comment">//改为</span></span><br><span class="line">state.merge(&#123;</span><br><span class="line">    list:action.data,</span><br><span class="line">    totalPage:action.totalPage,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="3-10-实现刷新旋转按钮"><a href="#3-10-实现刷新旋转按钮" class="headerlink" title="3.10 实现刷新旋转按钮"></a>3.10 实现刷新旋转按钮</h4><h6 id="3-10-1-添加iconfont"><a href="#3-10-1-添加iconfont" class="headerlink" title="3.10.1 添加iconfont"></a>3.10.1 添加iconfont</h6><p>首先去<a href="www.iconfont.cn">iconfont</a>将spin按钮Tina 驾到购物车，然后将jianshu项目下的iconfont重新下载到本地。将iconfont.eot、</p>
<p>iconfont.svg、iconfont.ttf、iconfont.woff文件拷贝到我们的<code>src/statics/iconfont/</code>下，然后打开我们的iconfont.js文件，将我们解压缩文件中的iconfont.css文件将里面的内容复制到iconfont.js中，将<code>@font-face</code>中的内容替换掉，其他的不用变。</p>
<p>这样我们项目中的iconfont就替换成了最新的，对老的功能不会有影响。</p>
<p>打开<code>src/common/header/index.js</code>，在SearchInfoSwitch标签内部添加一个i 标签，写入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;SearchInfoSwitch onClick=&#123;()=&gt;handlerChangePage(page,totalPage)&#125;&gt;</span><br><span class="line">	&lt;i className='iconfont'&gt;&amp;#xe851;&lt;/i&gt;</span><br><span class="line">	换一批</span><br><span class="line">&lt;<span class="regexp">/SearchInfoSwitch&gt;</span></span><br></pre></td></tr></table></figure>
<p>此时看一些页面，发现改图标出现在了我们提示框的右下角，这时由于它跟上边的放大镜按钮的“靠右居下”的布局影响了，我们在<code>src/common/header/style.js</code>中可以看到SearchWrapper中所有的iconfont都是“绝对定位，居右居下”的样式修饰。我们可以把这个iconfont的样式换名为zoom，首先给放大镜的i标签中添加一个zoom属性</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;i className=&#123;focused ? 'focused iconfont zoom':'iconfont zoom'&#125;&gt;&amp;#xe6dd;&lt;/i&gt;</span><br></pre></td></tr></table></figure>
<p>然后将SearchWrapper中所有的iconfont换成zoom</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchWrapper=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float:left;</span></span><br><span class="line"><span class="string">	position:relative;</span></span><br><span class="line"><span class="string">	.zoom &#123;</span></span><br><span class="line"><span class="string">		position:absolute;</span></span><br><span class="line"><span class="string">		right:5px;</span></span><br><span class="line"><span class="string">		bottom:5px;</span></span><br><span class="line"><span class="string">		width:30px;</span></span><br><span class="line"><span class="string">		line-height:30px;</span></span><br><span class="line"><span class="string">		border-radius:15px;</span></span><br><span class="line"><span class="string">		text-align:center;</span></span><br><span class="line"><span class="string">		&amp;.focused&#123;</span></span><br><span class="line"><span class="string">			background:#777;</span></span><br><span class="line"><span class="string">			color: #fff;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>这时在看我们的刷新图标，就位于“换一批”左边了。然后我们就可以给我们的刷新图标添加一个spin的样式，在SearchInfoSwitch样式中书写改样式</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;i className='iconfont spin'&gt;&amp;#xe851;&lt;/i&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfoSwitch=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float: right;</span></span><br><span class="line"><span class="string">    font-size: 13px;</span></span><br><span class="line"><span class="string">    color: #969696;</span></span><br><span class="line"><span class="string">    background-color: transparent;</span></span><br><span class="line"><span class="string">    border-width: 0;</span></span><br><span class="line"><span class="string">    padding: 0;</span></span><br><span class="line"><span class="string">    .spin &#123;</span></span><br><span class="line"><span class="string">    	font-size:12px;</span></span><br><span class="line"><span class="string">    	margin-right:2px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h6 id="3-10-2-点击换一换实现图标旋转"><a href="#3-10-2-点击换一换实现图标旋转" class="headerlink" title="3.10.2 点击换一换实现图标旋转"></a>3.10.2 点击换一换实现图标旋转</h6><p>我们给spin样式一个transition动画，设置动画时间200ms，动画类型是ease-in，设置旋转角度，和旋转中心</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchInfoSwitch=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float: right;</span></span><br><span class="line"><span class="string">    font-size: 13px;</span></span><br><span class="line"><span class="string">    color: #969696;</span></span><br><span class="line"><span class="string">    background-color: transparent;</span></span><br><span class="line"><span class="string">    border-width: 0;</span></span><br><span class="line"><span class="string">    padding: 0;</span></span><br><span class="line"><span class="string">    .spin &#123;</span></span><br><span class="line"><span class="string">    	display:block;</span></span><br><span class="line"><span class="string">    	float:left;</span></span><br><span class="line"><span class="string">    	font-size:12px;</span></span><br><span class="line"><span class="string">    	margin-right:2px;</span></span><br><span class="line"><span class="string">    	transition:all .2s ease-in;</span></span><br><span class="line"><span class="string">    	transform:rotate(0deg);</span></span><br><span class="line"><span class="string">    	transform-origin:center,center;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>所以当换一批被点击时，只需要让i 标签rotate的值发生变化，加360度就可以了。ref属性可以获取i 标签的真实节点给它放置一个函数;当我们的SearchInfoSwitch被点击时，会触动handlerChangePage方法，我们可以把this.spinIcon也传进去，然后就可以在handlerChangePage方法获取spin对应的dom了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;SearchInfoSwitch onClick=&#123;()=&gt;handlerChangePage(page,totalPage, <span class="keyword">this</span>.spinIcon)&#125;&gt;</span><br><span class="line">	&lt;i ref=&#123;(icon)=&gt;&#123;this.spinIcon=icon&#125;&#125; className='iconfont spin'&gt;&amp;#xe851;&lt;/i&gt;</span><br><span class="line">	换一批</span><br><span class="line">&lt;<span class="regexp">/SearchInfoSwitch&gt;</span></span><br><span class="line"><span class="regexp">。。。</span></span><br><span class="line"><span class="regexp">const mapDispatchToProps=(dispatch)=&gt;&#123;</span></span><br><span class="line"><span class="regexp">	return &#123;</span></span><br><span class="line"><span class="regexp">		...</span></span><br><span class="line"><span class="regexp">		handlerChangePage(page,totalPage,spin)&#123;</span></span><br><span class="line"><span class="regexp">			spin.style.transform="rotate(360deg)";</span></span><br><span class="line"><span class="regexp">			if(page&lt;totalPage)&#123;</span></span><br><span class="line"><span class="regexp">				dispatch(actionCreators.changePage(page+1));</span></span><br><span class="line"><span class="regexp">			&#125;else&#123;</span></span><br><span class="line"><span class="regexp">				dispatch(actionCreators.changePage(1));</span></span><br><span class="line"><span class="regexp">			&#125;</span></span><br><span class="line"><span class="regexp">		&#125;,</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>这时点击换一批就有旋转效果了，不过当再次点击时就不再旋转了。有无rotate一直时360不再发生变化了。所以我们需要先看它之前的角度，然后在原油角度的基础上增加360</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">handlerChangePage(page,totalPage,spin)&#123;</span><br><span class="line">			<span class="keyword">let</span> originAngle=spin.style.transform.replace(<span class="regexp">/[^0-9]/ig</span>,<span class="string">''</span>);</span><br><span class="line">			<span class="keyword">if</span>(originAngle)&#123;</span><br><span class="line">				originAngle=<span class="built_in">parseInt</span>(originAngle,<span class="number">10</span>);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				originAngle=<span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			spin.style.transform=<span class="string">"rotate("</span> + (originAngle+<span class="number">360</span>) + <span class="string">"deg)"</span>;</span><br><span class="line">			<span class="keyword">if</span>(page&lt;totalPage)&#123;</span><br><span class="line">				dispatch(actionCreators.changePage(page+<span class="number">1</span>));</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				dispatch(actionCreators.changePage(<span class="number">1</span>));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="四、规避不必要的ajax请求"><a href="#四、规避不必要的ajax请求" class="headerlink" title="四、规避不必要的ajax请求"></a>四、规避不必要的ajax请求</h3><p>之前我们的代码，会在每次给搜索框聚焦时发送ajax请求，其实改请求获取一次就足够了。我门可以给handleInputFocus方法传递一个list的参数，当list大小为0时才发送请求</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">render()&#123;</span><br><span class="line">		<span class="keyword">const</span> &#123;focused,handleInputFocus,handleInputBlur,list&#125;=<span class="keyword">this</span>.props;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">            ...</span><br><span class="line">			onFocus=&#123;()=&gt;handleInputFocus(list)&#125;	    	</span><br><span class="line">		)</span><br><span class="line">&#125;</span><br><span class="line">。。。</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=<span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		handleInputFocus(list)&#123;</span><br><span class="line">			(list.size===<span class="number">0</span>) &amp;&amp; dispatch(actionCreators.getList());</span><br><span class="line">			dispatch(actionCreators.searchFocus());</span><br><span class="line">		&#125;,</span><br><span class="line">		。。。。</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在就解决问题了。</p>
<p>接下来我们解决一个小问题，当鼠标放在SearchInfoSwitch时变成小手的样式，给SearchInfoSwitch的样式设置一个样式cursor的样式等于pointer就可以了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/18/react实战2/" data-id="ck4jzi8qx003hrflrb8wmvh6c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-react实战1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/18/react实战1/" class="article-date">
  <time datetime="2018-10-18T14:19:18.000Z" itemprop="datePublished">2018-10-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/18/react实战1/">react实战1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="React实战-简书"><a href="#React实战-简书" class="headerlink" title="React实战-简书"></a>React实战-简书</h2><h3 id="一、安装React"><a href="#一、安装React" class="headerlink" title="一、安装React"></a>一、安装React</h3><p>创建名为<code>jiashu</code>的react-app，并且清理工程目录，仅保留index.js、index.css和App.js文件。步骤略。</p>
<h3 id="二、css样式管理"><a href="#二、css样式管理" class="headerlink" title="二、css样式管理"></a>二、css样式管理</h3><h4 id="2-1-react中css使用"><a href="#2-1-react中css使用" class="headerlink" title="2.1 react中css使用"></a>2.1 react中css使用</h4><p>在index.css文件中添加样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.dell &#123;</span><br><span class="line">	background:red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在App.js文件中，给div添加className，这时页面的div就变成了红色。</p>
<p>注意：并没有给App.js文件引入index.css，只有文件index.js中引用了index.css文件，但是我们在App.js中依然可以使用其中的样式文件。这是因为css文件一旦在一个文件被引入，那么就会全局生效，即全局任何一个文件都能使用这里面的样式。</p>
<p>但是这样容易产生混乱，不建议这么做，这时推荐使用一个第三方的css管理，名为<code>styled-compenents</code></p>
<h4 id="2-2-react中使用styled-compenents管理css"><a href="#2-2-react中使用styled-compenents管理css" class="headerlink" title="2.2 react中使用styled-compenents管理css"></a>2.2 react中使用styled-compenents管理css</h4><p>首先安装该包</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --save styled-components</span><br><span class="line"><span class="comment">//或</span></span><br><span class="line">yarn add styled-components</span><br></pre></td></tr></table></figure>
<p>然后我们给<code>index.css</code>文件改名为<code>style.js</code>，然后在index.js文件中修改对应的引用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~~ <span class="keyword">import</span> <span class="string">'./index.css'</span>; ~~</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.js'</span>;</span><br></pre></td></tr></table></figure>
<p>然后在style.js中如何创建全局样式呢，如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; injectGlobal &#125; <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line">injectGlobal<span class="string">`</span></span><br><span class="line"><span class="string">	body &#123;</span></span><br><span class="line"><span class="string">      margin: 0;</span></span><br><span class="line"><span class="string">      padding: 0;</span></span><br><span class="line"><span class="string">      font-family: sans-serif;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    .dell &#123;</span></span><br><span class="line"><span class="string">        background:red;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>
<p>这时再看页面，又能正常显示了。</p>
<p>那么如何数据跟组件一对一的样式呢，后面会有介绍。</p>
<p>由于浏览器的差异，如何做到让不同浏览器的样式统一呢？这时需要用到一个reset.css的文件</p>
<h4 id="2-3-完成浏览器样式的统一"><a href="#2-3-完成浏览器样式的统一" class="headerlink" title="2.3 完成浏览器样式的统一"></a>2.3 完成浏览器样式的统一</h4><p>不同浏览器内核中对body等标签默认样式的设置是不同的，为了代码再所有浏览器上表现是一致的，这就可以使用<a href="https://meyerweb.com/eric/tools/css/reset/" target="_blank" rel="noopener">reset.css</a>，将里面的内容，拷贝到我们的全局样式里面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; injectGlobal &#125; <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line">injectGlobal<span class="string">`</span></span><br><span class="line"><span class="string">	html, body, div, span, applet, object, iframe,</span></span><br><span class="line"><span class="string">    h1, h2, h3, h4, h5, h6, p, blockquote, pre,</span></span><br><span class="line"><span class="string">    a, abbr, acronym, address, big, cite, code,</span></span><br><span class="line"><span class="string">    del, dfn, em, img, ins, kbd, q, s, samp,</span></span><br><span class="line"><span class="string">    small, strike, strong, sub, sup, tt, var,</span></span><br><span class="line"><span class="string">    b, u, i, center,</span></span><br><span class="line"><span class="string">    dl, dt, dd, ol, ul, li,</span></span><br><span class="line"><span class="string">    fieldset, form, label, legend,</span></span><br><span class="line"><span class="string">    table, caption, tbody, tfoot, thead, tr, th, td,</span></span><br><span class="line"><span class="string">    article, aside, canvas, details, embed, </span></span><br><span class="line"><span class="string">    figure, figcaption, footer, header, hgroup, </span></span><br><span class="line"><span class="string">    menu, nav, output, ruby, section, summary,</span></span><br><span class="line"><span class="string">    time, mark, audio, video &#123;</span></span><br><span class="line"><span class="string">        margin: 0;</span></span><br><span class="line"><span class="string">        padding: 0;</span></span><br><span class="line"><span class="string">        border: 0;</span></span><br><span class="line"><span class="string">        font-size: 100%;</span></span><br><span class="line"><span class="string">        font: inherit;</span></span><br><span class="line"><span class="string">        vertical-align: baseline;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    /* HTML5 display-role reset for older browsers */</span></span><br><span class="line"><span class="string">    article, aside, details, figcaption, figure, </span></span><br><span class="line"><span class="string">    footer, header, hgroup, menu, nav, section &#123;</span></span><br><span class="line"><span class="string">        display: block;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    body &#123;</span></span><br><span class="line"><span class="string">        line-height: 1;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    ol, ul &#123;</span></span><br><span class="line"><span class="string">        list-style: none;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    blockquote, q &#123;</span></span><br><span class="line"><span class="string">        quotes: none;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    blockquote:before, blockquote:after,</span></span><br><span class="line"><span class="string">    q:before, q:after &#123;</span></span><br><span class="line"><span class="string">        content: '';</span></span><br><span class="line"><span class="string">        content: none;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    table &#123;</span></span><br><span class="line"><span class="string">        border-collapse: collapse;</span></span><br><span class="line"><span class="string">        border-spacing: 0;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>
<h3 id="三、头部区块的编写"><a href="#三、头部区块的编写" class="headerlink" title="三、头部区块的编写"></a>三、头部区块的编写</h3><p>一般头部区块，是很多页面都要公用的。</p>
<h4 id="3-1-创建header组件"><a href="#3-1-创建header组件" class="headerlink" title="3.1 创建header组件"></a>3.1 创建header组件</h4><p>首先在src目录下创建一个文件夹common，在common文件夹中再创建一个header的文件夹，然后再header文件夹中创建index.js文件，这个就是header的组件。接下来我们来定义这个组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React , &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Header</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">            	header</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Header;</span></span><br></pre></td></tr></table></figure>
<p>然后再<code>src/App.js</code>文件中引入Header组件，并使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'./common/header/index.js'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            &lt;Header /&gt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<h4 id="3-2创建header样式"><a href="#3-2创建header样式" class="headerlink" title="3.2创建header样式"></a>3.2创建header样式</h4><p>在<code>src/common/header/</code>文件夹下，创建一个<code>style.js</code>的样式文件，在里面编写Header自己用的样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HeaderWrapper=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	height:56px;</span></span><br><span class="line"><span class="string">	background:red;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>这样就可以在Header组件(<code>src\common\header\index.js</code>)中，引入该样式并使用了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React , &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;HeaderWrapper&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Header</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            &lt;HeaderWrapper&gt;</span><br><span class="line">            	header</span><br><span class="line">            &lt;<span class="regexp">/HeaderWrapper&gt;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Header;</span></span><br></pre></td></tr></table></figure>
<p>这时header的简易样式就出来了。</p>
<p>查看简书官网可以看到header有58px高，并且有个1px的边框，可以这么修改</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">height:<span class="number">58</span>px;</span><br><span class="line">border-bottom:1px soid #f0f0f0;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-展示logo"><a href="#3-3-展示logo" class="headerlink" title="3.3 展示logo"></a>3.3 展示logo</h4><p>首先去简书官网，将左上角的logo下载到我们项目的<code>src/state/</code>目录下，命名为<code>logo.png</code>。</p>
<p>接下来我们在<code>src/common/header/style.js</code>中定义一个Logo的组件，由于点击该组件可以进行条状，所以该组件是一个a标签</p>
<p>注意在属性url的不能这么写<code>background:url(&#39;../../statics/logo.png&#39;)</code>因为webpack打包时会当成字符串，而因该使用引用的方式引用该图片，然后使用<code>${}</code>形式进行使用;</p>
<p>图片有点大，还要注意给图片设置大小<code>background-size</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logoPic <span class="keyword">from</span> <span class="string">'../../common/statics/logo.png'</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Logo=styled.a<span class="string">`</span></span><br><span class="line"><span class="string">	position: absolute;</span></span><br><span class="line"><span class="string">	top: 0;</span></span><br><span class="line"><span class="string">	left: 0;</span></span><br><span class="line"><span class="string">	display:block;</span></span><br><span class="line"><span class="string">	width: 100px;</span></span><br><span class="line"><span class="string">	height: 58px;</span></span><br><span class="line"><span class="string">	background:url(<span class="subst">$&#123;logoPic&#125;</span>);</span></span><br><span class="line"><span class="string">	background-size:contain;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>然后就可以在<code>/src/common/header/index.js</code>文件中使用它了，a标签是一个链接，如何让点击时回到首页呢？可以直接给Logo设置<code>href=&quot;/&quot;</code>属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React , &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HeaderWrapper , Logo&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Header</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">			&lt;HeaderWrapper&gt;</span><br><span class="line">				&lt;Logo href=<span class="string">'/'</span> /&gt;</span><br><span class="line">			&lt;<span class="regexp">/HeaderWrapper&gt;</span></span><br><span class="line"><span class="regexp">        )   </span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Header;</span></span><br></pre></td></tr></table></figure>
<p>当然也可以在style.js中设置href属性，可以这么写style</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Logo=styled.a.attrs(&#123;</span><br><span class="line">    href:<span class="string">'/'</span></span><br><span class="line">&#125;)<span class="string">`</span></span><br><span class="line"><span class="string">	position: absolute;</span></span><br><span class="line"><span class="string">	top: 0;</span></span><br><span class="line"><span class="string">	left: 0;</span></span><br><span class="line"><span class="string">	display:block;</span></span><br><span class="line"><span class="string">	width: 100px;</span></span><br><span class="line"><span class="string">	height: 58px;</span></span><br><span class="line"><span class="string">	background:url(<span class="subst">$&#123;logoPic&#125;</span>);</span></span><br><span class="line"><span class="string">	background-size:contain;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>然后我们编写header的中间组件</p>
<h4 id="3-4-编写header中间部分Nav"><a href="#3-4-编写header中间部分Nav" class="headerlink" title="3.4 编写header中间部分Nav"></a>3.4 编写header中间部分Nav</h4><p>可以现在<code>/src/common/header/index.js</code>文件中添加一个新组件Nav，再编写</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React , &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HeaderWrapper , Logo, Nav&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Header</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">			&lt;HeaderWrapper&gt;</span><br><span class="line">				&lt;Logo href=<span class="string">'/'</span> /&gt;</span><br><span class="line">            	&lt;Nav /&gt;</span><br><span class="line">			&lt;<span class="regexp">/HeaderWrapper&gt;</span></span><br><span class="line"><span class="regexp">        )   </span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Header;</span></span><br></pre></td></tr></table></figure>
<p>然后在<code>src/common/header/style.js</code>中定义一个Nav的组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Nav=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	width:960px;</span></span><br><span class="line"><span class="string">	height:100%;</span></span><br><span class="line"><span class="string">	margin:0px;</span></span><br><span class="line"><span class="string">	background:green;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-5-填充Nav"><a href="#3-5-填充Nav" class="headerlink" title="3.5 填充Nav"></a>3.5 填充Nav</h4><p>这样就能看到我们的中间了，接下来我们往Nav中添加东西，添加4个NavItem，为了给它们添加浮动，给它们添加样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeaderWrapper , Logo , Nav ,NavItem&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line">...</span><br><span class="line">&lt;Nav&gt;</span><br><span class="line">    &lt;NavItem className=<span class="string">'left'</span>&gt;首页&lt;<span class="regexp">/NavItem&gt;</span></span><br><span class="line"><span class="regexp">    &lt;NavItem className='left'&gt;下载App&lt;/</span>NavItem&gt;</span><br><span class="line">    &lt;NavItem className=<span class="string">'right'</span>&gt;登陆&lt;<span class="regexp">/NavItem&gt;</span></span><br><span class="line"><span class="regexp">    &lt;NavItem className='right'&gt;Aa&lt;/</span>NavItem&gt;</span><br><span class="line">&lt;<span class="regexp">/Nav&gt;</span></span><br></pre></td></tr></table></figure>
<p>接下来我们就能在<code>src/common/header/style.js</code>中定义一个NavItem的组件了，其中<code>&amp;.left</code>表示NavItem组件有left属性的话，就执行向左浮动；</p>
<p>同时它们也有一些共有的属性如line-height、padding、font-size等；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> NavItem=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	line-height:58px;</span></span><br><span class="line"><span class="string">	padding:0 15px;</span></span><br><span class="line"><span class="string">	font-size:17px;</span></span><br><span class="line"><span class="string">    &amp;.left&#123;</span></span><br><span class="line"><span class="string">        float:left;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">	&amp;.right&#123;</span></span><br><span class="line"><span class="string">        float:right;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>同时也可以给文字指定颜色，比如让首页为红色，其它设为黑色，右侧文字黑色浅一些：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;NavItem className=<span class="string">'left active'</span>&gt;首页&lt;<span class="regexp">/NavItem&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> NavItem=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	line-height:58px;</span></span><br><span class="line"><span class="string">	padding:0 15px;</span></span><br><span class="line"><span class="string">	font-size:17px;</span></span><br><span class="line"><span class="string">	color:#333;</span></span><br><span class="line"><span class="string">    &amp;.left&#123;</span></span><br><span class="line"><span class="string">        float:left;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">	&amp;.right&#123;</span></span><br><span class="line"><span class="string">        float:right;</span></span><br><span class="line"><span class="string">		color:#969696;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &amp;.active&#123;</span></span><br><span class="line"><span class="string">		color:#ea6f5a;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-6-编写NavSearch组件"><a href="#3-6-编写NavSearch组件" class="headerlink" title="3.6 编写NavSearch组件"></a>3.6 编写NavSearch组件</h4><p>再Nav中添加NavSearch组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeaderWrapper , Logo , Nav ,NavItem, NavSearch&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line">...</span><br><span class="line">&lt;Nav&gt;</span><br><span class="line">    &lt;NavItem className=<span class="string">'left'</span>&gt;首页&lt;<span class="regexp">/NavItem&gt;</span></span><br><span class="line"><span class="regexp">    &lt;NavItem className='left'&gt;下载App&lt;/</span>NavItem&gt;</span><br><span class="line">    &lt;NavItem className=<span class="string">'right'</span>&gt;登陆&lt;<span class="regexp">/NavItem&gt;</span></span><br><span class="line"><span class="regexp">    &lt;NavItem className='right'&gt;Aa&lt;/</span>NavItem&gt;</span><br><span class="line">	&lt;NavSearch&gt;<span class="xml"><span class="tag">&lt;/<span class="name">NavSearch</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/Nav&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在<code>src/common/header/style.js</code>中定义一个NavSearch的组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> NavSearch=styled.input.attrs(&#123;</span><br><span class="line">	placeholder:<span class="string">'搜索'</span></span><br><span class="line">&#125;)<span class="string">`</span></span><br><span class="line"><span class="string">	width:160px;</span></span><br><span class="line"><span class="string">	height:38px;</span></span><br><span class="line"><span class="string">	padding:0 20px;</span></span><br><span class="line"><span class="string">	box-sizing:border-box;</span></span><br><span class="line"><span class="string">	border:none;</span></span><br><span class="line"><span class="string">	outline:none;</span></span><br><span class="line"><span class="string">	margin-top:9px;</span></span><br><span class="line"><span class="string">	margin-left:20px;</span></span><br><span class="line"><span class="string">	border-radius:19px;</span></span><br><span class="line"><span class="string">	background:#eee;</span></span><br><span class="line"><span class="string">	font-size:14px;</span></span><br><span class="line"><span class="string">	&amp;::placeholder&#123;</span></span><br><span class="line"><span class="string">		color:#999;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>其中<code>box-sizing:border-box;</code>    表示input框不拉伸；<code>&amp;::placeholder</code>表示框内文字颜色；</p>
<h4 id="3-7-写注册组件"><a href="#3-7-写注册组件" class="headerlink" title="3.7 写注册组件"></a>3.7 写注册组件</h4><p>首先引入Addition，仔里面添加两个Button然后编写style，通过给Button设置className来自定义属性，相应的再style中可以使用<code>&amp;.XXX</code>来编写对应的样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeaderWrapper , Logo , Nav ,NavItem, NavSearch,Addition,Button&#125; <span class="keyword">from</span> <span class="string">'./style.js'</span>;</span><br><span class="line">...</span><br><span class="line">&lt;Nav&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;<span class="regexp">/Nav&gt;</span></span><br><span class="line"><span class="regexp">&lt;Addition&gt;</span></span><br><span class="line"><span class="regexp">	&lt;Button className='writting'&gt;写文章&lt;/</span>Button&gt;</span><br><span class="line">	&lt;Button className=<span class="string">'reg'</span>&gt;注册&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Addition&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Addition=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	position:absolute;</span></span><br><span class="line"><span class="string">	right:0;</span></span><br><span class="line"><span class="string">	top:0;</span></span><br><span class="line"><span class="string">	height:56px;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Button=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float:right;</span></span><br><span class="line"><span class="string">	margin-top:9px;</span></span><br><span class="line"><span class="string">	margin-right:20px;</span></span><br><span class="line"><span class="string">	padding:0 20px;</span></span><br><span class="line"><span class="string">	line-height:38px;</span></span><br><span class="line"><span class="string">	border-radius:19px;</span></span><br><span class="line"><span class="string">	border:1px solid #ec6149;</span></span><br><span class="line"><span class="string">	font-size:14px;</span></span><br><span class="line"><span class="string">	&amp;.reg&#123;</span></span><br><span class="line"><span class="string">		color:#ec6149;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">	&amp;.writting&#123;</span></span><br><span class="line"><span class="string">		color:#fff;</span></span><br><span class="line"><span class="string">		background:#ec6149;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-8-使用iconfont"><a href="#3-8-使用iconfont" class="headerlink" title="3.8 使用iconfont"></a>3.8 使用iconfont</h4><p>首先进入<a href="iconfont.cn">iconfont.cn</a>下载几个iconfont图标，放在<code>src/statics/iconfont/</code>文件夹下，包括下面五个文件：</p>
<ul>
<li>iconfont.css</li>
<li>iconfont.eot</li>
<li>iconfont.svg</li>
<li>iconfont.ttf</li>
<li>iconfont.woff</li>
</ul>
<p>然后打开iconfont.css文件，在里面将iconfont开头内容，改为添加相对引用的，并且可以删除下面没用的内容</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//before</span><br><span class="line"><span class="keyword">@font-face</span> &#123;<span class="attribute">font-family</span>: <span class="string">"iconfont"</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'iconfont.eot?t=1536939256958'</span>); <span class="comment">/* IE9*/</span></span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'iconfont.eot?t=1536939256958#iefix'</span>) <span class="built_in">format</span>(<span class="string">'embedded-opentype'</span>), <span class="comment">/* IE6-IE8 */</span></span><br><span class="line">  <span class="built_in">url</span>(<span class="string">'iconfont.ttf?t=1536939256958'</span>) <span class="built_in">format</span>(<span class="string">'truetype'</span>), <span class="comment">/* chrome, firefox, opera, Safari, Android, iOS 4.2+*/</span></span><br><span class="line">  <span class="built_in">url</span>(<span class="string">'iconfont.svg?t=1536939256958#iconfont'</span>) <span class="built_in">format</span>(<span class="string">'svg'</span>); <span class="comment">/* iOS 4.1- */</span></span><br><span class="line">&#125;</span><br><span class="line">//after</span><br><span class="line"><span class="keyword">@font-face</span> &#123;<span class="attribute">font-family</span>: <span class="string">"iconfont"</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'./iconfont.eot?t=1536939256958'</span>); <span class="comment">/* IE9*/</span></span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'./iconfont.eot?t=1536939256958#iefix'</span>) <span class="built_in">format</span>(<span class="string">'embedded-opentype'</span>), <span class="comment">/* IE6-IE8 */</span></span><br><span class="line">  <span class="built_in">url</span>(<span class="string">'./iconfont.ttf?t=1536939256958'</span>) <span class="built_in">format</span>(<span class="string">'truetype'</span>), <span class="comment">/* chrome, firefox, opera, Safari, Android, iOS 4.2+*/</span></span><br><span class="line">  <span class="built_in">url</span>(<span class="string">'./iconfont.svg?t=1536939256958#iconfont'</span>) <span class="built_in">format</span>(<span class="string">'svg'</span>); <span class="comment">/* iOS 4.1- */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>iconfont我们倾向于将它们全局使用</p>
<p>首先我们将iconfont.css文件改名为iconfont.js，并且引入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; injectGlobal &#125; <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br></pre></td></tr></table></figure>
<p>然后就可以将里面的内容引入全局语法，如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; injectGlobal &#125; <span class="keyword">from</span> <span class="string">'styled-components'</span>;</span><br><span class="line"></span><br><span class="line">injectGlobal<span class="string">`</span></span><br><span class="line"><span class="string">  @font-face &#123;font-family: "iconfont";</span></span><br><span class="line"><span class="string">    src: url('./iconfont.eot?t=1536939256958'); /* IE9*/</span></span><br><span class="line"><span class="string">    src: url('./iconfont.eot?t=1536939256958#iefix') format('embedded-opentype'), /* IE6-IE8 */</span></span><br><span class="line"><span class="string">    url('data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAW0AAsAAAAACEAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFY8hEjPY21hcAAAAYAAAABeAAABnLRjHYpnbHlmAAAB4AAAAdIAAAIA2xiyuGhlYWQAAAO0AAAALwAAADYSoy/taGhlYQAAA+QAAAAcAAAAJAfeA4VobXR4AAAEAAAAAA4AAAAQEAAAAGxvY2EAAAQQAAAACgAAAAoBSgCEbWF4cAAABBwAAAAeAAAAIAESAFluYW1lAAAEPAAAAUUAAAJtPlT+fXBvc3QAAAWEAAAAMAAAAEHS0b6peJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkYWCcwMDKwMHUyXSGgYGhH0IzvmYwYuRgYGBiYGVmwAoC0lxTGBye8T27y9zwv4EhhrmBoQEozAiSAwDusgzOeJztkEEOgDAIBAdbTWOML/Fo+iBPfrpXvlGBevARLhkCmw0HgBlIxmFkkBvBdZkr4SfW8DPV9mI1ge5atfX+nUISiRJXxZOy8GuLfr5b8q8NYq4D/7e2AdMDWkcVrgAAeJw1jk1PE1EUhs+ZO/ejfsw47W3HkrY6HWamk0g7zrRTg7VIQg1SExsSiAsVo1GwwkpXJGyElf4G2PAPuurKVBP30BUr/oihtYWQnMWb532S94AKMB6TAQHgoMMsVAAs27O4jVGKuJ7NOKFxFObRrtnMLrq16gJW7SI3NUzLTBTGT1AZfFoenbU+ov5+6QtlCuVdPAuaXx+htViud98+na9slPL3Z5xgOCQw8nHhjmunRr9p7tvfShz469qttvOK5rLpXOgUAECZ/NQnf8gypMECcJpYK6OnIS+gGcZ1MxPGVc+ZoCbWJ0hDZWh75PTw6ERVT44aO5VzY65oXPw76BHSO9jvqWrvorLTuKoPT4lz79ywHyS/q739a+Vyc0z2CIG78GKyKZnnMq5hAetNNAsYNaehjOgWdbzMU56ZKtfW9GLXK+MVMzmTmbCOcZU839rcO2YJdkMm1B/bfis/31CEcjs9Gggpdul6J/gw50c8tbrpddwEvSkT/pofdbIWTeorrYdb1dfbss91KXBDrLC8V/YES6UYZVbJ0JS8yqWh4DMhdks/V4O2KYXIHHe9RZPJJKUzS370OWi1dYMVsy+jN78e94XUOb7jEuA/i1FlEwAAeJxjYGRgYADiF3ZLN8bz23xl4GZhAIHrB7/+QND/d7AwMHsAuRwMTCBRAHx7DUcAeJxjYGRgYG7438AQw8IAAkCSkQEVsAAARwoCbXicY2FgYGBBwgAAsAARAAAAAAAAAEoAhAEAAAB4nGNgZGBgYGHwBWIQYAJiLiBkYPgP5jMAABCXAWwAAHicZY9NTsMwEIVf+gekEqqoYIfkBWIBKP0Rq25YVGr3XXTfpk6bKokjx63UA3AejsAJOALcgDvwSCebNpbH37x5Y08A3OAHHo7fLfeRPVwyO3INF7gXrlN/EG6QX4SbaONVuEX9TdjHM6bCbXRheYPXuGL2hHdhDx18CNdwjU/hOvUv4Qb5W7iJO/wKt9Dx6sI+5l5XuI1HL/bHVi+cXqnlQcWhySKTOb+CmV7vkoWt0uqca1vEJlODoF9JU51pW91T7NdD5yIVWZOqCas6SYzKrdnq0AUb5/JRrxeJHoQm5Vhj/rbGAo5xBYUlDowxQhhkiMro6DtVZvSvsUPCXntWPc3ndFsU1P9zhQEC9M9cU7qy0nk6T4E9XxtSdXQrbsuelDSRXs1JErJCXta2VELqATZlV44RelzRiT8oZ0j/AAlabsgAAAB4nGNgYoAALgbsgIWRiZGZkYWRlYHJMZErLTEvPSUxKzMvnbUiM7Uqk4EBAFR3Bwg=') format('woff'),</span></span><br><span class="line"><span class="string">    url('./iconfont.ttf?t=1536939256958') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+*/</span></span><br><span class="line"><span class="string">    url('./iconfont.svg?t=1536939256958#iconfont') format('svg'); /* iOS 4.1- */</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  .iconfont &#123;</span></span><br><span class="line"><span class="string">    font-family:"iconfont" !important;</span></span><br><span class="line"><span class="string">    font-size:16px;</span></span><br><span class="line"><span class="string">    font-style:normal;</span></span><br><span class="line"><span class="string">    -webkit-font-smoothing: antialiased;</span></span><br><span class="line"><span class="string">    -moz-osx-font-smoothing: grayscale;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>
<p> 现在这个样式文件还没有全局生效，要生效该怎么做呢？</p>
<p>我们在<code>src/index.js</code>文件中引入该样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./statics/iconfont/iconfont.js'</span>;</span><br></pre></td></tr></table></figure>
<p>这时我们看页面控制台没有报错，就说明引用成功，接下来我们就可以使用它了。</p>
<p>进入<code>src/common/header/index.js</code>文件，用iconfont标签插入到相应的组件即可，可以通过i标签引入。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">render()&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">			&lt;HeaderWrapper&gt;</span><br><span class="line">				&lt;Logo href=<span class="string">'/'</span>/&gt;</span><br><span class="line">				&lt;Nav&gt;</span><br><span class="line">				    &lt;NavItem className=<span class="string">'left active'</span>&gt;首页&lt;<span class="regexp">/NavItem&gt;</span></span><br><span class="line"><span class="regexp">				    &lt;NavItem className='left'&gt;下载App&lt;/</span>NavItem&gt;</span><br><span class="line">				    &lt;NavItem className=<span class="string">'right'</span>&gt;登陆&lt;<span class="regexp">/NavItem&gt;</span></span><br><span class="line"><span class="regexp">				    &lt;NavItem className='right'&gt;</span></span><br><span class="line"><span class="regexp">				    	&lt;i className='iconfont'&gt;&amp;#xe636;&lt;/i</span>&gt;</span><br><span class="line">				    &lt;<span class="regexp">/NavItem&gt;</span></span><br><span class="line"><span class="regexp">				    &lt;NavSearch&gt;&lt;/</span>NavSearch&gt;</span><br><span class="line">				    &lt;i className='iconfont'&gt;&amp;#xe6dd;&lt;/i&gt;</span><br><span class="line">				&lt;<span class="regexp">/Nav&gt;</span></span><br><span class="line"><span class="regexp">				&lt;Addition&gt;</span></span><br><span class="line"><span class="regexp">					&lt;Button className='writting'&gt;</span></span><br><span class="line"><span class="regexp">						&lt;i className='iconfont'&gt;&amp;#xe60e;&lt;/i</span>&gt;</span><br><span class="line">						写文章</span><br><span class="line">					&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">					&lt;Button className='reg'&gt;注册&lt;/</span>Button&gt;</span><br><span class="line">				&lt;<span class="regexp">/Addition&gt;</span></span><br><span class="line"><span class="regexp">			&lt;/</span>HeaderWrapper&gt;</span><br><span class="line">        )   </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>此时我们的页面就展示出来了iconfont元素了。</p>
<p>接下来对搜索地方进行优化，创建一个SeachWrapper样式，将NavSearch和搜索标签包起来，并且在<code>src/common/header/style.js</code>中定义该样式，如何给里面的iconfont添加样式呢？只需要使用<code>.iconfont{}</code>即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SearchWrapper=styled.div<span class="string">`</span></span><br><span class="line"><span class="string">	float:left;</span></span><br><span class="line"><span class="string">	position:relative;</span></span><br><span class="line"><span class="string">	.iconfont &#123;</span></span><br><span class="line"><span class="string">		position:absolute;</span></span><br><span class="line"><span class="string">		right:5px;</span></span><br><span class="line"><span class="string">		bottom:5px;</span></span><br><span class="line"><span class="string">		width:30px;</span></span><br><span class="line"><span class="string">		line-height:30px;</span></span><br><span class="line"><span class="string">		border-radius:15px;</span></span><br><span class="line"><span class="string">		text-align:center;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>
<p>这里给iconfont搜索按钮添加了圆角框，是为了以后动画服务。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/10/18/react实战1/" data-id="ck4jzi8pi002xrflrpbyeopkp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-redux中间件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/12/redux中间件/" class="article-date">
  <time datetime="2018-09-12T15:44:33.000Z" itemprop="datePublished">2018-09-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/12/redux中间件/">redux中间件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Redux中间件"><a href="#Redux中间件" class="headerlink" title="Redux中间件"></a>Redux中间件</h2><h3 id="一、解决action类型太多的问题"><a href="#一、解决action类型太多的问题" class="headerlink" title="一、解决action类型太多的问题"></a>一、解决action类型太多的问题</h3><p>在之前的例子中，我们在TodoList文件中创建了多种action，并且在reducer文件中对多种action做了区分处理。如果action的数量变得多了以后，就很容易出现错误并且不好调试。如何解决这个问题呢？</p>
<p>我们可以在store下创建一个actionType.js的文件。在里面将不同的action定义成常量，这样就可以在其他文件中直接使用了，又不容易出现错误</p>
<p>actionType.js文件内容可以如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_INPUT_VALUE=<span class="string">"change_input_value"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_TODO_ITEM=<span class="string">"add_todo_item"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DELETE_TODO_ITEM=<span class="string">"delete_todo_item"</span>;</span><br></pre></td></tr></table></figure>
<p>然后在TodoList中引入这三个常量即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CHANGE_INPUT_VALUE,ADD_TODO_ITEM,DELETE_TODO_ITEM&#125; <span class="keyword">from</span> <span class="string">'./actionType.js'</span>;</span><br><span class="line">...</span><br><span class="line">	handleInputChange(event)&#123;</span><br><span class="line">		<span class="keyword">const</span> action=&#123;</span><br><span class="line">			type:CHANGE_INPUT_VALUE,</span><br><span class="line">			value:event.target.value,</span><br><span class="line">		&#125;;</span><br><span class="line">		store.dispatch(action);</span><br><span class="line">		&#125;</span><br><span class="line">	  </span><br><span class="line">	  <span class="comment">//当感知到数据发生变化时，就回去新的state数据</span></span><br><span class="line">	  handleStoreChange(event)&#123;</span><br><span class="line">	  	<span class="keyword">this</span>.setState(store.getState());</span><br><span class="line">	  &#125;</span><br><span class="line">	  </span><br><span class="line">	  handleBtnClick(event)&#123;</span><br><span class="line">	  	<span class="keyword">const</span> action=&#123;</span><br><span class="line">			type:ADD_TODO_ITEM,</span><br><span class="line">		&#125;;</span><br><span class="line">		store.dispatch(action);</span><br><span class="line">	  &#125;</span><br><span class="line">	  </span><br><span class="line">	  handleItemDelete(index)&#123;</span><br><span class="line">	  	<span class="keyword">const</span> action=&#123;</span><br><span class="line">			type:DELETE_TODO_ITEM,</span><br><span class="line">		    index,</span><br><span class="line">		&#125;;</span><br><span class="line">		store.dispatch(action);</span><br><span class="line">	  &#125;</span><br></pre></td></tr></table></figure>
<p>同理也需要对reducer中引入这些常量。</p>
<h3 id="二、创建action创建器"><a href="#二、创建action创建器" class="headerlink" title="二、创建action创建器"></a>二、创建action创建器</h3><p>在之前的例子中，我们都是直接创建action对象，虽然方便，但是这种方式却不便于管理。我们需要一个action创建器来统一创建相应的action。</p>
<p>在store下面创建一个actionCreators.js的文件</p>
<p>输入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CHANGE_INPUT_VALUE&#125; <span class="keyword">from</span> <span class="string">'./actionType.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getInputChangeAction=<span class="function">(<span class="params">value</span>)=&gt;</span>(&#123;</span><br><span class="line">    type=CHANGE_INPUT_VALUE,</span><br><span class="line">    value,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后我们在TodoList文件中修改该action的创建方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getInputChangeAction &#125; <span class="keyword">from</span> <span class="string">'./store/actionCreators.js'</span>;</span><br><span class="line">...</span><br><span class="line">handleInputChange(event)&#123;</span><br><span class="line">		<span class="keyword">const</span> action=getInputChangeAction(event.target.value);</span><br><span class="line">		store.dispatch(action);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p>同理对其他的action做同样的处理</p>
<h3 id="三、Redux使用三原则"><a href="#三、Redux使用三原则" class="headerlink" title="三、Redux使用三原则"></a>三、Redux使用三原则</h3><ul>
<li><strong>store唯一</strong>：整个工程只有一个store</li>
<li><strong>只有store能够改变自己的内容</strong>：很多同学认为是reducer改变的store中的内容，其实不是的，reducer只是拿到了之前的数据，然后创建一个新的数据，将新的数据返回给了store；其实还是store将数据进行更新</li>
<li><strong>Reducer必须是存函数</strong>：存函数给定固定的输入就一定会有固定的输出，而且不会有任何副作用（除了返回东西不会做任何改变）。</li>
</ul>
<p>store最常用的四个方法：</p>
<ul>
<li>createStore</li>
<li>store.dispatch</li>
<li>store.getState</li>
<li>store.subscribe</li>
</ul>
<h3 id="四、拆分UI组件和容器组件"><a href="#四、拆分UI组件和容器组件" class="headerlink" title="四、拆分UI组件和容器组件"></a>四、拆分UI组件和容器组件</h3><p>在之前的例子中我们在组件TodoList中既处理UI部分也处理逻辑部分，这样会造成很多混乱，可以考虑将组件拆分成UI组件和容器组件。</p>
<h4 id="4-1编写UI组件"><a href="#4-1编写UI组件" class="headerlink" title="4.1编写UI组件"></a>4.1编写UI组件</h4><p>在UI组件中只展示UI，容器部分只处理逻辑</p>
<p>我们可以新建一个TodoListUI.js;</p>
<p>将UI编写UI部分；</p>
<p>此时该组件中的设计的逻辑部分只能通过父组件传递过来,使用this.props.XXX的方式；</p>
<p>最后将该组件输出export</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Input , Button , List&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoListUI</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">	      &lt;div style=&#123;&#123;<span class="attr">marginTop</span>:<span class="string">'10px'</span> , <span class="attr">marginLeft</span>:<span class="string">'10px'</span>&#125;&#125;&gt;</span><br><span class="line">	        &lt;div&gt;</span><br><span class="line">	        		&lt;Input </span><br><span class="line">	        			value=&#123;<span class="keyword">this</span>.props.inputValue&#125; placeholder=<span class="string">"todo info"</span> </span><br><span class="line">	        			style=&#123;&#123;<span class="attr">width</span>:<span class="string">'300px'</span>,<span class="attr">marginRight</span>:<span class="string">'10px'</span>&#125;&#125; </span><br><span class="line">	        			onChange=&#123;<span class="keyword">this</span>.props.handleInputChange&#125;/&gt;</span><br><span class="line">	        		&lt;Button type=<span class="string">"primary"</span> onClick=&#123;<span class="keyword">this</span>.props.handleBtnClick&#125;&gt;提交&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">	        	&lt;/</span>div&gt;</span><br><span class="line">	        &lt;List</span><br><span class="line">	        	  style=&#123;&#123;<span class="attr">width</span>:<span class="string">'300px'</span>,<span class="attr">marginTop</span>:<span class="string">'10px'</span>&#125;&#125;</span><br><span class="line">	          bordered</span><br><span class="line">	          dataSource=&#123;<span class="keyword">this</span>.props.list&#125;</span><br><span class="line">	          renderItem=&#123;(item,index) =&gt; <span class="function">(<span class="params">&lt;List.Item onClick=&#123;(</span>)=&gt;</span>&#123;<span class="keyword">this</span>.props.handleItemDelete(index)&#125;&#125;&gt;&#123;item&#125;&lt;<span class="regexp">/List.Item&gt;)&#125;</span></span><br><span class="line"><span class="regexp">	        /</span>&gt;</span><br><span class="line">	      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">	    );</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default TodoListUI;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-2-修改逻辑组件部分"><a href="#4-2-修改逻辑组件部分" class="headerlink" title="4.2 修改逻辑组件部分"></a>4.2 修改逻辑组件部分</h4><p>在TodoList.js文件中，引入TodoListUI，直接添加到render方法中。</p>
<p>然后将TodoListUI需要用到的一些逻辑通过属性传递过去</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'antd/dist/antd.css'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store/index'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getInputChangeAction , getAddItemAction , getDeleteItemAction &#125; <span class="keyword">from</span> <span class="string">'./store/actionCreator.js'</span>;</span><br><span class="line"><span class="keyword">import</span> TodoListUI <span class="keyword">from</span> <span class="string">'./TodoListUI'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">		<span class="keyword">super</span>(props);</span><br><span class="line">		<span class="keyword">this</span>.state=store.getState();</span><br><span class="line">		<span class="keyword">this</span>.handleInputChange.bind(<span class="keyword">this</span>);</span><br><span class="line">		<span class="keyword">this</span>.handleStoreChange=<span class="keyword">this</span>.handleStoreChange.bind(<span class="keyword">this</span>);</span><br><span class="line">		<span class="keyword">this</span>.handleBtnClick=<span class="keyword">this</span>.handleBtnClick.bind(<span class="keyword">this</span>);</span><br><span class="line">		<span class="keyword">this</span>.handleItemDelete=<span class="keyword">this</span>.handleItemDelete.bind(<span class="keyword">this</span>);</span><br><span class="line">		</span><br><span class="line">		store.subscribe(<span class="keyword">this</span>.handleStoreChange);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	  render() &#123;</span><br><span class="line">	    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">TodoListUI</span> </span></span></span><br><span class="line"><span class="xml">	    				inputValue=&#123;this.state.inputValue&#125;</span></span><br><span class="line"><span class="xml">	    				list=&#123;this.state.list&#125;</span></span><br><span class="line"><span class="xml">	    				handleInputChange=&#123;this.handleInputChange&#125;</span></span><br><span class="line"><span class="xml">	    				handleStoreChange=&#123;this.handleStoreChange&#125;</span></span><br><span class="line"><span class="xml">	    				handleBtnClick=&#123;this.handleBtnClick&#125;</span></span><br><span class="line"><span class="xml">	    				handleItemDelete=&#123;this.handleItemDelete&#125;</span></span><br><span class="line"><span class="xml">	    			/&gt;;</span></span><br><span class="line"><span class="xml">	  &#125;</span></span><br><span class="line"><span class="xml">	  </span></span><br><span class="line"><span class="xml">	  handleInputChange(event)&#123;</span></span><br><span class="line"><span class="xml">		const action=getInputChangeAction(event.target.value);</span></span><br><span class="line"><span class="xml">		store.dispatch(action);</span></span><br><span class="line"><span class="xml">		&#125;</span></span><br><span class="line"><span class="xml">	  </span></span><br><span class="line"><span class="xml">	  //当感知到数据发生变化时，就回去新的state数据</span></span><br><span class="line"><span class="xml">	  handleStoreChange(event)&#123;</span></span><br><span class="line"><span class="xml">	  	this.setState(store.getState());</span></span><br><span class="line"><span class="xml">	  &#125;</span></span><br><span class="line"><span class="xml">	  </span></span><br><span class="line"><span class="xml">	  handleBtnClick(event)&#123;</span></span><br><span class="line"><span class="xml">	  	const action=getAddItemAction();</span></span><br><span class="line"><span class="xml">		store.dispatch(action);</span></span><br><span class="line"><span class="xml">	  &#125;</span></span><br><span class="line"><span class="xml">	  </span></span><br><span class="line"><span class="xml">	  handleItemDelete(index)&#123;</span></span><br><span class="line"><span class="xml">	  	const action=getDeleteItemAction(index);</span></span><br><span class="line"><span class="xml">		store.dispatch(action);</span></span><br><span class="line"><span class="xml">	  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">export default TodoList;</span></span><br></pre></td></tr></table></figure>
<p>此时UI组件和逻辑组件就分开了，功能同样实现</p>
<h3 id="五、无状态组件"><a href="#五、无状态组件" class="headerlink" title="五、无状态组件"></a>五、无状态组件</h3><p>一个组件如果没有构造函数，就可以把它写成无状态组件，比如我们上面的TodoListUI，可以改成下面的样式</p>
<p>这时使用props就不用使用this了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Input , Button , List&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoListUI=<span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">	      &lt;div style=&#123;&#123;<span class="attr">marginTop</span>:<span class="string">'10px'</span> , <span class="attr">marginLeft</span>:<span class="string">'10px'</span>&#125;&#125;&gt;</span><br><span class="line">	        &lt;div&gt;</span><br><span class="line">	        		&lt;Input </span><br><span class="line">	        			value=&#123;props.inputValue&#125; placeholder=<span class="string">"todo info"</span> </span><br><span class="line">	        			style=&#123;&#123;<span class="attr">width</span>:<span class="string">'300px'</span>,<span class="attr">marginRight</span>:<span class="string">'10px'</span>&#125;&#125; </span><br><span class="line">	        			onChange=&#123;props.handleInputChange&#125;/&gt;</span><br><span class="line">	        		&lt;Button type=<span class="string">"primary"</span> onClick=&#123;props.handleBtnClick&#125;&gt;提交&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">	        	&lt;/</span>div&gt;</span><br><span class="line">	        &lt;List</span><br><span class="line">	        	  style=&#123;&#123;<span class="attr">width</span>:<span class="string">'300px'</span>,<span class="attr">marginTop</span>:<span class="string">'10px'</span>&#125;&#125;</span><br><span class="line">	          bordered</span><br><span class="line">	          dataSource=&#123;props.list&#125;</span><br><span class="line">	          renderItem=&#123;(item,index) =&gt; <span class="function">(<span class="params">&lt;List.Item onClick=&#123;(</span>)=&gt;</span>&#123;props.handleItemDelete(index)&#125;&#125;&gt;&#123;item&#125;&lt;<span class="regexp">/List.Item&gt;)&#125;</span></span><br><span class="line"><span class="regexp">	        /</span>&gt;</span><br><span class="line">	      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">	    );</span></span><br><span class="line"><span class="regexp">&#125;；</span></span><br><span class="line"><span class="regexp">export default TodoListUI;</span></span><br></pre></td></tr></table></figure>
<p>这时候，就完成了，无状态组件性能比较高。因为它只是一个函数，而不需要一些生命周期函数.</p>
<h3 id="六、Redux发送ajax请求"><a href="#六、Redux发送ajax请求" class="headerlink" title="六、Redux发送ajax请求"></a>六、Redux发送ajax请求</h3><p>想初始化我们的列表，首先在actionType文件中添加一个action类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> INIT_LIST=<span class="string">"init_list"</span>;</span><br></pre></td></tr></table></figure>
<p>然后在actionCreator中创建该action</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CHANGE_INPUT_VALUE,ADD_TODO_ITEM,DELETE_TODO_ITEM,INIT_LIST&#125; <span class="keyword">from</span> <span class="string">'./actionType.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getInputChangeAction=<span class="function">(<span class="params">value</span>)=&gt;</span>(&#123;</span><br><span class="line">    type:CHANGE_INPUT_VALUE,</span><br><span class="line">    value,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getAddItemAction=<span class="function"><span class="params">()</span>=&gt;</span>(&#123;</span><br><span class="line">    type:ADD_TODO_ITEM,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getDeleteItemAction=<span class="function">(<span class="params">index</span>)=&gt;</span>(&#123;</span><br><span class="line">    type:DELETE_TODO_ITEM,</span><br><span class="line">    index,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> initListAction=<span class="function">(<span class="params">data</span>)=&gt;</span>(&#123;</span><br><span class="line">    type:INIT_LIST,</span><br><span class="line">    data,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在TodoList中引入该action，并且引入axios，添加componentDidMount生命周期函数,在该函数中创建action，然后将action传递给store</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getInputChangeAction , getAddItemAction , getDeleteItemAction,initListAction &#125; <span class="keyword">from</span> <span class="string">'./store/actionCreator.js'</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>; </span><br><span class="line">...</span><br><span class="line">componentDidMount()&#123;</span><br><span class="line">	  	axios.get(<span class="string">'/list.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">	  		<span class="keyword">const</span> data=res.data;</span><br><span class="line">	  		<span class="keyword">const</span> action=initListAction(data);</span><br><span class="line">	  		store.dispatch(action);</span><br><span class="line">	  	&#125;);</span><br><span class="line">	  &#125;</span><br></pre></td></tr></table></figure>
<p>最后写reducer，在reducer中完成对数据的处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CHANGE_INPUT_VALUE,ADD_TODO_ITEM,DELETE_TODO_ITEM,INIT_LIST&#125; <span class="keyword">from</span> <span class="string">'./actionType.js'</span>;</span><br><span class="line">。。。</span><br><span class="line"><span class="keyword">if</span>(action.type===INIT_LIST)&#123;</span><br><span class="line">		<span class="keyword">const</span> newState=<span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state));</span><br><span class="line">        newState.list=action.data;</span><br><span class="line">		<span class="keyword">return</span> newState;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="七、Redux-thunk中间件发送ajax请求"><a href="#七、Redux-thunk中间件发送ajax请求" class="headerlink" title="七、Redux-thunk中间件发送ajax请求"></a>七、Redux-thunk中间件发送ajax请求</h3><p>如果把过多的异步请求或逻辑放在一个组件中，会显得组件特别臃肿。我们希望将它们移除在其它地方进行统一管理。放在哪里呢？Redux-thunk可以将它们放在action 中去处理。Redux-thunk如何使用呢？</p>
<h4 id="7-1-安装redux-thunk"><a href="#7-1-安装redux-thunk" class="headerlink" title="7.1 安装redux-thunk"></a>7.1 安装redux-thunk</h4><p>首先在github<a href="https://github.com/reduxjs/redux-thunk" target="_blank" rel="noopener">官网</a>上查看，在工程目录下输入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install --save redux-thunk</span><br><span class="line"></span><br><span class="line"><span class="comment">//或</span></span><br><span class="line">yarn add redux-thunk</span><br></pre></td></tr></table></figure>
<p>那该如何使用中间件来创建store呢？</p>
<p>首先在store/index.js文件中，引入redux的applyMiddleware，并且引入thunk</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br></pre></td></tr></table></figure>
<p>然后在createStore中使用applyMiddleware方法，将thunk放在里面里面就行了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer,</span><br><span class="line">			applyMiddleware(thunk)</span><br><span class="line">			);</span><br></pre></td></tr></table></figure>
<h4 id="7-2-redux同时使用dev-tools和thunk中间件"><a href="#7-2-redux同时使用dev-tools和thunk中间件" class="headerlink" title="7.2 redux同时使用dev-tools和thunk中间件"></a>7.2 redux同时使用dev-tools和thunk中间件</h4><p>如果想将之前的<code>window.__REDUX_DEVTOOLS_EXTENSION__ &amp;&amp; window.__REDUX_DEVTOOLS_EXTENSION__()</code>和thunk同时使用该怎么办呢？它们全都是Redux的中间件，可以去github的<a href="https://github.com/zalmoxisus/redux-devtools-extension" target="_blank" rel="noopener">REDUX_DEVTOOLS</a>    中查看使用方式</p>
<ul>
<li><p>首先声明<code>window.__REDUX_DEVTOOLS_EXTENSION__ &amp;&amp; window.__REDUX_DEVTOOLS_EXTENSION__()</code>，</p>
</li>
<li><p>然后扩展thunk</p>
</li>
<li>最后使用即可</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore , applyMiddleware , compose&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> composeEnhancers =<span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ? <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__(&#123;&#125;) : compose;</span><br><span class="line"><span class="keyword">const</span> enhancer = composeEnhancers(</span><br><span class="line">  applyMiddleware(thunk),</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer,enhancer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<p>这样我们的代码就可以既支持devtools，又支持thunk了</p>
<h4 id="7-3-使用thunk编写代码"><a href="#7-3-使用thunk编写代码" class="headerlink" title="7.3 使用thunk编写代码"></a>7.3 使用thunk编写代码</h4><p>之前我们的aciton都是一个函数，函数返回的是一个对象，如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> initListAction=<span class="function">(<span class="params">data</span>)=&gt;</span>(&#123;</span><br><span class="line">    type:INIT_LIST,</span><br><span class="line">    data,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在使用thunk之后，我们action，函数返回的也可以是一个函数</p>
<p>首先我们将TodoList的componentDidMount函数中的异步代码删除。</p>
<p>然后在actionCreators.js中,放进来，注意这里不用在引入store了，因为返回的函数自动接收了store的dispatch方法，可以直接将里面创建的action派发出去了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getTodoList=<span class="function"><span class="params">()</span>=&gt;</span>(&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>)=&gt;</span>&#123;</span><br><span class="line">    	axios.get(<span class="string">'/todolist.json'</span>).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">	  		<span class="keyword">const</span> data=res.data;</span><br><span class="line">	  		<span class="keyword">const</span> action=initListAction(data);</span><br><span class="line">	  		dispatch(action);</span><br><span class="line">	  	&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这里我们使用axios，所以需要在actionCreators.js文件中添加两个引用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br></pre></td></tr></table></figure>
<p>然后在TodoList.js组件的componentDidMount函数中创建getTodoList的action，注意需要先import</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getTodoList, getInputChangeAction , getAddItemAction , getDeleteItemAction,initListAction &#125; <span class="keyword">from</span> <span class="string">'./store/actionCreator.js'</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">componentDidMount()&#123;</span><br><span class="line">    <span class="keyword">const</span> action=getTodoList();</span><br><span class="line">    store.dispatch(action);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意这里之所以能将函数发送出去，就是因为使用了redux-thunk中间件</p>
<h3 id="八、什么是Redux的中间件"><a href="#八、什么是Redux的中间件" class="headerlink" title="八、什么是Redux的中间件"></a>八、什么是Redux的中间件</h3><p>已经使用redux中间件redux-thunk了，到底什么是中间件呢</p>
<p>redux的中间件指的是action和store之间，thunk就是对store的dispatch方法做了一个升级，之前的是只能接受一个对象，现在可以接收一个函数，当接受一个函数时先执行函数再分发</p>
<img src="/2018/09/12/redux中间件/redux-data-flow.png" title="redux-data-flow流程图">
<h3 id="九、Redux-saga中间件"><a href="#九、Redux-saga中间件" class="headerlink" title="九、Redux-saga中间件"></a>九、Redux-saga中间件</h3><p>这里再强调一下，中间件指的是action和store之间，因为只有redux才有store和action。之前我们学习的redux-thunk将异步过程封装到了action之中，这样有助于我们做自动化测试，以及异步代码拆分管理。redux-saga也是做这种异步代码拆分的工作，可以用redux-saga完全代替redux-thunk。</p>
<h4 id="9-1-安装Redux-saga"><a href="#9-1-安装Redux-saga" class="headerlink" title="9.1 安装Redux-saga"></a>9.1 安装Redux-saga</h4><p>首先进入<a href="https://github.com/redux-saga/redux-saga" target="_blank" rel="noopener">官网</a>，进行Redux-saga的安装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --save redux-saga</span><br><span class="line"><span class="comment">//或</span></span><br><span class="line">yarn add redux-saga</span><br></pre></td></tr></table></figure>
<p>然后在store/index.js组件中引入createSagaMiddleware，用于创建中间件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> createSagaMiddleware <span class="keyword">from</span> <span class="string">'redux-saga'</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// create the saga middleware</span></span><br><span class="line"><span class="keyword">const</span> sagaMiddleware = createSagaMiddleware()</span><br></pre></td></tr></table></figure>
<p>之前在redux-thunk中是通过composeEnhancers将中间件传进入，redux-saga也一样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> composeEnhancers =<span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ? <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__(&#123;&#125;) : compose;</span><br><span class="line"><span class="keyword">const</span> enhancer = composeEnhancers(</span><br><span class="line">  applyMiddleware(sagaMiddleware),</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer,enhancer);</span><br></pre></td></tr></table></figure>
<p>在store文件夹下创建一个sagas.js的文件，然后在store/index.js文件中引入该文件，并执行saga文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> todoSagas <span class="keyword">from</span> <span class="string">'./sagas'</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// then run the saga</span></span><br><span class="line">sagaMiddleware.run(todoSagas)</span><br></pre></td></tr></table></figure>
<p>sagas.js文件中写什么呢？一定要导出一个generator函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">todoSagas</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> todoSagas;</span><br></pre></td></tr></table></figure>
<h4 id="9-2-使用redux-saga"><a href="#9-2-使用redux-saga" class="headerlink" title="9.2 使用redux-saga"></a>9.2 使用redux-saga</h4><p>在actionCreator.js创建一个action,是一个函数返回一个对象.</p>
<p>首先在actionType.js中创建GET_INIT_LIST</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> GET_INIT_LIST=<span class="string">"get_init_list"</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CHANGE_INPUT_VALUE,ADD_TODO_ITEM,DELETE_TODO_ITEM,GET_INIT_LIST&#125; <span class="keyword">from</span> <span class="string">'./actionType.js'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getInitList=<span class="function"><span class="params">()</span>=&gt;</span>(&#123;</span><br><span class="line">    type:GET_INIT_LIST</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后在TodoList中使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">	<span class="keyword">const</span> action=getInitList();</span><br><span class="line">    store.dispatch(action);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时我们不仅能在reducer中接收action了，还能在sagas.js中接收了，然后将异步过程放在这里。在这里将创建的action如何发布出去呢，可以使用redux-saga中的put</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; takeEvery , put&#125; <span class="keyword">from</span> <span class="string">'redux-saga/effects'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; GET_INIT_LIST &#125; <span class="keyword">from</span> <span class="string">'./actionType'</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; initListAction &#125; <span class="keyword">from</span> <span class="string">'./store/actionCreator.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//generator函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">todoSagas</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//takeEvery：捕捉每一个XX类型的action,然后调用fetchUser这个方法</span></span><br><span class="line">    <span class="keyword">yield</span> takeEvery(GET_INIT_LIST, getInitList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">getInitList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//这里无需使用promise了</span></span><br><span class="line">    <span class="keyword">const</span> res=<span class="keyword">yield</span> axios.get(<span class="string">'/todolist.json'</span>);</span><br><span class="line">    <span class="keyword">const</span> action=initListAction(res.data);</span><br><span class="line">    <span class="keyword">yield</span> put(action);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> todoSagas;</span><br></pre></td></tr></table></figure>
<p>注意：这是在getInitList函数中如果<code>yield axios.get(&#39;/todolist.json&#39;);</code>获取成功，肯定是没问题的，但是如果获取不成功呢，ajax失败情况怎么办呢，可以使用try-catch</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">getInitList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">//这里无需使用promise了</span></span><br><span class="line">        <span class="keyword">const</span> res=<span class="keyword">yield</span> axios.get(<span class="string">'/todolist.json'</span>);</span><br><span class="line">        <span class="keyword">const</span> action=initListAction(res.data);</span><br><span class="line">        <span class="keyword">yield</span> put(action);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"网络请求失败"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>redux-thunk基本没有api，它只是让我们在action不仅仅返回对象，还能返回函数；</p>
<p>而redux-saga又很多常用的API，在大型项目中很适合</p>
<h3 id="十、React-Redux的使用"><a href="#十、React-Redux的使用" class="headerlink" title="十、React-Redux的使用"></a>十、React-Redux的使用</h3><p>React-Redux是一个第三方的模块，可以帮助我们在react中更加方便的使用redux。首先我们先将我们的工程清空，只剩一个index文件。</p>
<h4 id="10-1-安装React-Redux"><a href="#10-1-安装React-Redux" class="headerlink" title="10.1 安装React-Redux"></a>10.1 安装React-Redux</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --save react-redux</span><br><span class="line"><span class="comment">//或</span></span><br><span class="line">yarn add react-redux</span><br></pre></td></tr></table></figure>
<p>然后编写TodoList.js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">        	&lt;div&gt;</span><br><span class="line">            	&lt;div&gt;</span><br><span class="line">                    &lt;input /&gt;</span><br><span class="line">                    &lt;button&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/</span>div&gt;</span><br><span class="line">            	&lt;ul&gt;</span><br><span class="line">            		&lt;li&gt;VUE&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/u</span>l&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default TodoList;</span></span><br></pre></td></tr></table></figure>
<h4 id="10-2-创建store"><a href="#10-2-创建store" class="headerlink" title="10.2 创建store"></a>10.2 创建store</h4><p>首先创建store文件夹，并在下面创建index.js文件，在里面输入创建store（管理员）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reducer &#125; <span class="keyword">from</span> <span class="string">'./reducer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store=createStore();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
<p>并且在store目录下创建一个reducer.js（记事本），这是一个纯函数。并在里面定义一些初始值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState=&#123;</span><br><span class="line">    inputValue:<span class="string">''</span>,</span><br><span class="line">    list:[],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们redecer和store就创建好了。</p>
<h4 id="10-3-在TodoList-js中使用store中的数据"><a href="#10-3-在TodoList-js中使用store中的数据" class="headerlink" title="10.3 在TodoList.js中使用store中的数据"></a>10.3 在TodoList.js中使用store中的数据</h4><p>首先在TodoList.js中引入store;</p>
<p>并在构造函数中通过store设置setState;</p>
<p>然后在input中加入对state的引用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store/index'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state=store.getState();</span><br><span class="line">    &#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">        	&lt;div&gt;</span><br><span class="line">            	&lt;div&gt;</span><br><span class="line">                    &lt;input value=&#123;<span class="keyword">this</span>.state.inputValue&#125;/&gt;</span><br><span class="line">                    &lt;button&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/</span>div&gt;</span><br><span class="line">            	&lt;ul&gt;</span><br><span class="line">            		&lt;li&gt;VUE&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/u</span>l&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default TodoList;</span></span><br></pre></td></tr></table></figure>
<p>那我们该如何使用React-Redux呢？</p>
<h4 id="10-4-使用React-Redux"><a href="#10-4-使用React-Redux" class="headerlink" title="10.4 使用React-Redux"></a>10.4 使用React-Redux</h4><p>在index.js文件中，之前是直接渲染TodoList，现在我们引入react-redux，并且声明一个App，将TodoList传给App，最后将App传给RenderDom使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> TodoList <span class="keyword">from</span> <span class="string">'./TodoList'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App=（</span><br><span class="line">	&lt;Provider&gt;</span><br><span class="line">      &lt;TodoList /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">）；</span></span><br><span class="line"><span class="regexp">RenderDom.render(App, document.getElementById("root"));</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/RenderDom.render(&lt;TodoList /</span>&gt;, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure>
<p>这里将TodoList组件传给了Provider组件，Provider组件来自于react-redux。</p>
<p>provider组件可以做什么呢？provider可以提供链接store的能力</p>
<p>我们继续引入store，然后在provider组件中使用如下，这样Provider内的所有组件都有获取store的能力</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App=（</span><br><span class="line">	&lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;TodoList /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">）；</span></span><br></pre></td></tr></table></figure>
<p>此时TodoList组件有获取store的能力了，它怎么获取store呢？</p>
<p>此时我们在TodoList.js中就可以改变获取store的方式了，首先引入react-redux中的connnect，然后到处connect方法。connect的方法是让TodoList和store做连接</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">        	&lt;div&gt;</span><br><span class="line">            	&lt;div&gt;</span><br><span class="line">                    &lt;input value=&#123;<span class="keyword">this</span>.state.inputValue&#125;/&gt;</span><br><span class="line">                    &lt;button&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/</span>div&gt;</span><br><span class="line">            	&lt;ul&gt;</span><br><span class="line">            		&lt;li&gt;VUE&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/u</span>l&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(null,null)(TodoList);</span></span><br></pre></td></tr></table></figure>
<p>connect是怎么做连接的呢？首先我们可以创建一个mapStateToProps，然后将它放在connect的一个参数处</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将state中的数据映射给props</span></span><br><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        inputValue：state.inputValue,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,<span class="literal">null</span>)(TodoList);</span><br></pre></td></tr></table></figure>
<p>这时我们input中的value就不是等于{this.state.inputValue}了，不使用state了改为props，需要改为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input value=&#123;<span class="keyword">this</span>.props.inputValue&#125;/&gt;</span><br></pre></td></tr></table></figure>
<p>然后我们实现onChange方法，在input标签中添加该监听，并且编写一个mapDispatchToProps，将它放在connect的第二个参数处。然后</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;input value=&#123;<span class="keyword">this</span>.props.inputValue&#125; onChange=&#123;<span class="keyword">this</span>.props.changeInputValue)&#125;/&gt;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">handleInputChange(event)&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//store.dispatch 挂载到props上</span></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=(dispatch)=&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        changeInputValue(e)&#123;</span><br><span class="line">    		<span class="keyword">const</span> action=&#123;</span><br><span class="line">                type:<span class="string">'change_input_value'</span>,</span><br><span class="line">                value:e.target.value,</span><br><span class="line">            &#125;;</span><br><span class="line">			dispatch(action);</span><br><span class="line">    	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,mapDispatchToProps)(TodoList);</span><br></pre></td></tr></table></figure>
<p>然后就可以在reduce中做处理了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState=&#123;</span><br><span class="line">    inputValue:<span class="string">''</span>,</span><br><span class="line">    list:[],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state=defaultState,action)=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(action.type===<span class="string">'change_input_value'</span>)&#123;</span><br><span class="line">    	cost newState=<span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state));</span><br><span class="line">        newState.inputValue=action.value;</span><br><span class="line">        <span class="keyword">return</span> newState;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里对react-redux的使用就讲解的差不多了，</p>
<p>接下来我们给button添加一个监听，然后在mapDispatchToProps中添加这个监听函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;<span class="keyword">this</span>.props.handleClick&#125;&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">...</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapDispatchToProps=(dispatch)=&#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">        changeInputValue(e)&#123;</span></span><br><span class="line"><span class="regexp">    		const action=&#123;</span></span><br><span class="line"><span class="regexp">                type:'change_input_value',</span></span><br><span class="line"><span class="regexp">                value:e.target.value,</span></span><br><span class="line"><span class="regexp">            &#125;;</span></span><br><span class="line"><span class="regexp">			dispatch(action);</span></span><br><span class="line"><span class="regexp">    	&#125;，</span></span><br><span class="line"><span class="regexp">        handleClick(e)&#123;</span></span><br><span class="line"><span class="regexp">            /</span><span class="regexp">/...</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">	&#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>然后在做action类型的处理即可，不再重复。</p>
<p>同理对于列表，可以这么处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="keyword">this</span>.props.list.map(<span class="function">(<span class="params">item,index</span>)=&gt;</span>(&#123;<span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>&#125;));</span><br><span class="line">	&#125;</span><br><span class="line">&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">...</span></span><br><span class="line"><span class="regexp">const mapStateToProps=(state)=&gt;&#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">        inputValue：state.inputValue,</span></span><br><span class="line"><span class="regexp">        list:state.list,</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<p>这是代码中出现太多的this.props.XXX，其实可以精简一下，在render函数中使用结构赋值，就可以在直接使用相应的函数了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">render()&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;inputValue,list,changeInputValue,handleClick&#125; =<span class="keyword">this</span>.props;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时的TodoList就是一个UI组件，可以改为无状态组件，因为无状态组件性能比较高，可以直接写成函数的形式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TodoList=<span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;inputValue,list,changeInputValue,handleClick&#125; =props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        	&lt;div&gt;</span><br><span class="line">            	&lt;div&gt;</span><br><span class="line">                    &lt;input value=&#123;inputValue&#125; onChange=&#123;changeInputValue&#125;/&gt;</span><br><span class="line">                    &lt;button onClick=&#123;handleClick&#125;&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            	&lt;/</span>div&gt;</span><br><span class="line">            	&lt;ul&gt;</span><br><span class="line">            		&#123;list.map(<span class="function">(<span class="params">item,index</span>)=&gt;</span>(&#123;<span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>&#125;));&#125;</span><br><span class="line">            	&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mapStateToProps=<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        inputValue：state.inputValue,</span><br><span class="line">        list:state.list,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps=(dispatch)=&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        changeInputValue(e)&#123;</span><br><span class="line">    		<span class="keyword">const</span> action=&#123;</span><br><span class="line">                type:<span class="string">'change_input_value'</span>,</span><br><span class="line">                value:e.target.value,</span><br><span class="line">            &#125;;</span><br><span class="line">			dispatch(action);</span><br><span class="line">    	&#125;，</span><br><span class="line">        handleClick(e)&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps,mapDispatchToProps)(TodoList);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/12/redux中间件/" data-id="ck4jzi8px003crflrt8kdetwi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GIS/">GIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublime/">sublime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webgl/">webgl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/GIS/" style="font-size: 11.67px;">GIS</a> <a href="/tags/Gradle/" style="font-size: 10px;">Gradle</a> <a href="/tags/JavaScript/" style="font-size: 16.67px;">JavaScript</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/React/" style="font-size: 18.33px;">React</a> <a href="/tags/SpringBoot/" style="font-size: 11.67px;">SpringBoot</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/java/" style="font-size: 13.33px;">java</a> <a href="/tags/linux/" style="font-size: 11.67px;">linux</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/sublime/" style="font-size: 10px;">sublime</a> <a href="/tags/tomcat/" style="font-size: 11.67px;">tomcat</a> <a href="/tags/webgl/" style="font-size: 15px;">webgl</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/12/24/webgl2基础/">webgl2基础</a>
          </li>
        
          <li>
            <a href="/2019/12/24/low-graphics-mode解决方法/">low-graphics mode解决方法</a>
          </li>
        
          <li>
            <a href="/2019/12/24/Ubuntu固定ip和软件愿/">Ubuntu固定ip和软件愿</a>
          </li>
        
          <li>
            <a href="/2019/12/24/浏览器跨域/">浏览器跨域</a>
          </li>
        
          <li>
            <a href="/2019/12/24/git-rebase/">git rebase</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 杨亚辉<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>